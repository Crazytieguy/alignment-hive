{"_type":"hive-mind-meta","version":"0.1","sessionId":"agent-aa534fe","checkoutId":"deb16c4b-0302-4e62-8640-ec42acb25027","extractedAt":"2026-01-09T04:48:30.158Z","rawMtime":"2026-01-08T20:30:39.310Z","messageCount":25,"rawPath":"/Users/yoav/.claude/projects/-Users-yoav-projects-alignment-hive/agent-aa534fe.jsonl","agentId":"aa534fe","parentSessionId":"56f508cc-8978-4a5c-8518-37f364691c8e"}
{"type":"user","uuid":"408d7195-0f33-4526-a709-1a33886f6ff1","parentUuid":null,"timestamp":"2026-01-08T20:29:31.485Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","cwd":"/Users/yoav/projects/alignment-hive","gitBranch":"main","version":"2.1.1","message":{"role":"user","content":"How do I restrict an agent's tool access? Specifically:\n1. How do I limit Bash to only specific commands (e.g., only allow `bun $CLAUDE_PLUGIN_ROOT/cli.js` commands)?\n2. Can I prevent an agent from using Read/Glob tools to access files outside a specific directory?\n3. What's the correct YAML syntax for tool restrictions in agent frontmatter?\n\nI'm trying to create a retrieval agent that can ONLY use my CLI commands and grep/head/tail, but it's currently also using `find` and reading files directly."},"isSidechain":true,"agentId":"aa534fe"}
{"type":"assistant","uuid":"fab6f87d-fabc-4353-91a7-15ae941ccef7","parentUuid":"408d7195-0f33-4526-a709-1a33886f6ff1","timestamp":"2026-01-08T20:29:33.105Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","message":{"role":"assistant","content":[{"type":"text","text":"I'll look up the Claude Agent SDK documentation to find the exact syntax and capabilities for tool restrictions in agents."}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":10627,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":10627,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.1.1","gitBranch":"main","agentId":"aa534fe"}
{"type":"assistant","uuid":"b92d6ceb-ad80-4bcc-a58e-48979d6b5f4e","parentUuid":"fab6f87d-fabc-4353-91a7-15ae941ccef7","timestamp":"2026-01-08T20:29:33.905Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","message":{"role":"assistant","content":[{"type":"tool_use","id":"toolu_01QbxTC1SzA766qUAndyzXfa","name":"WebFetch","input":{"url":"https://platform.claude.com/llms.txt","prompt":"How do I restrict an agent's tool access? Can I limit Bash to specific commands, restrict Read/Glob to specific directories, and what's the YAML syntax for tool permissions in agent frontmatter?"}}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":10627,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":10627,"ephemeral_1h_input_tokens":0},"output_tokens":147,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.1.1","gitBranch":"main","agentId":"aa534fe"}
{"type":"user","uuid":"5326aed0-7a3e-4f89-ad07-91253bb4ce1d","parentUuid":"b92d6ceb-ad80-4bcc-a58e-48979d6b5f4e","timestamp":"2026-01-08T20:29:39.169Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","cwd":"/Users/yoav/projects/alignment-hive","gitBranch":"main","version":"2.1.1","message":{"role":"user","content":[{"type":"tool_result","tool_use_id":"toolu_01QbxTC1SzA766qUAndyzXfa","content":"# Restricting Agent Tool Access\n\nBased on the Anthropic documentation, here's how to restrict an agent's tool access:\n\n## Permissions Configuration\n\nThe Agent SDK provides a **Handling Permissions** feature documented at:\nhttps://platform.claude.com/docs/en/agent-sdk/permissions.md - Configure permissions\n\nThis allows you to control and limit tool access through agent configuration.\n\n## Tool-Specific Restrictions\n\nThe documentation references several tools with built-in permission controls:\n\n1. **Bash Tool** - https://platform.claude.com/docs/en/agents-and-tools/tool-use/bash-tool.md\n   - Supports command restrictions\n\n2. **Text Editor Tool** - https://platform.claude.com/docs/en/agents-and-tools/tool-use/text-editor-tool.md\n   - Supports directory/file restrictions\n\n3. **Code Execution Tool** - https://platform.claude.com/docs/en/agents-and-tools/tool-use/code-execution-tool.md\n\n## YAML Syntax & Configuration\n\nWhile the index doesn't provide the exact YAML syntax details, the configuration is handled through:\n\n- **Agent SDK Frontmatter** - See the Agent SDK documentation for TypeScript or Python\n- **Custom Tools** - https://platform.claude.com/docs/en/agent-sdk/custom-tools.md\n- **Modifying System Prompts** - https://platform.claude.com/docs/en/agent-sdk/modifying-system-prompts.md\n\n## Recommended Next Steps\n\nFor detailed YAML syntax and specific permission examples, consult:\n1. The **Handling Permissions** guide (linked above)\n2. The **Custom Tools** documentation for implementing fine-grained access control\n3. The SDK reference for your language (Python or TypeScript)"}]},"isSidechain":true,"agentId":"aa534fe","sourceToolAssistantUUID":"b92d6ceb-ad80-4bcc-a58e-48979d6b5f4e"}
{"type":"assistant","uuid":"b232e7c9-eebb-44dc-a074-81977eeff558","parentUuid":"5326aed0-7a3e-4f89-ad07-91253bb4ce1d","timestamp":"2026-01-08T20:29:40.252Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","message":{"role":"assistant","content":[{"type":"text","text":"Let me fetch the specific permissions documentation:"}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":571,"cache_read_input_tokens":10627,"cache_creation":{"ephemeral_5m_input_tokens":571,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.1.1","gitBranch":"main","agentId":"aa534fe"}
{"type":"assistant","uuid":"7d073147-426c-4857-ba91-3fd642d0d352","parentUuid":"b232e7c9-eebb-44dc-a074-81977eeff558","timestamp":"2026-01-08T20:29:40.652Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","message":{"role":"assistant","content":[{"type":"tool_use","id":"toolu_01EFuhhTzSWeE3kwhTr3FTTD","name":"WebFetch","input":{"url":"https://platform.claude.com/docs/en/agent-sdk/permissions.md","prompt":"What is the YAML syntax for restricting agent tool access? Can I limit Bash to specific commands and restrict Read/Glob to directories?"}}],"model":"claude-haiku-4-5-20251001","stop_reason":"tool_use","usage":{"input_tokens":5,"cache_creation_input_tokens":571,"cache_read_input_tokens":10627,"cache_creation":{"ephemeral_5m_input_tokens":571,"ephemeral_1h_input_tokens":0},"output_tokens":126,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.1.1","gitBranch":"main","agentId":"aa534fe"}
{"type":"user","uuid":"fed21565-6e24-4c71-81d1-bc969e3defdf","parentUuid":"7d073147-426c-4857-ba91-3fd642d0d352","timestamp":"2026-01-08T20:29:41.241Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","cwd":"/Users/yoav/projects/alignment-hive","gitBranch":"main","version":"2.1.1","message":{"role":"user","content":[{"type":"tool_result","tool_use_id":"toolu_01EFuhhTzSWeE3kwhTr3FTTD","content":"# Configure permissions\n\nControl how your agent uses tools with permission modes, hooks, and declarative allow/deny rules.\n\n---\n\nThe Claude Agent SDK provides permission controls to manage how Claude uses tools. Use permission modes and rules to define what's allowed automatically, and the [`canUseTool` callback](/docs/en/agent-sdk/user-input) to handle everything else at runtime.\n\n<Note>\nThis page covers permission modes and rules. To build interactive approval flows where users approve or deny tool requests at runtime, see [Handle approvals and user input](/docs/en/agent-sdk/user-input).\n</Note>\n\n## How permissions are evaluated\n\nWhen Claude requests a tool, the SDK checks permissions in this order:\n\n<Steps>\n  <Step title=\"Hooks\">\n    Run [hooks](/docs/en/agent-sdk/hooks) first, which can allow, deny, or continue to the next step\n  </Step>\n  <Step title=\"Permission rules\">\n    Check rules defined in [settings.json](https://code.claude.com/docs/en/settings#permission-settings) in this order: `deny` rules first (block regardless of other rules), then `allow` rules (permit if matched), then `ask` rules (prompt for approval). These declarative rules let you pre-approve, block, or require approval for specific tools without writing code.\n  </Step>\n  <Step title=\"Permission mode\">\n    Apply the active [permission mode](#permission-modes) (`bypassPermissions`, `acceptEdits`, `dontAsk`, etc.)\n  </Step>\n  <Step title=\"canUseTool callback\">\n    If not resolved by rules or modes, call your [`canUseTool` callback](/docs/en/agent-sdk/user-input) for a decision\n  </Step>\n</Steps>\n\n![Permission evaluation flow diagram](/docs/images/agent-sdk/permissions-flow.svg)\n\nThis page focuses on **permission modes** (step 3), the static configuration that controls default behavior. For the other steps:\n\n- **Hooks**: run custom code to allow, deny, or modify tool requests. See [Control execution with hooks](/docs/en/agent-sdk/hooks).\n- **Permission rules**: configure declarative allow/deny rules in `settings.json`. See [Permission settings](https://code.claude.com/docs/en/settings#permission-settings).\n- **canUseTool callback**: prompt users for approval at runtime. See [Handle approvals and user input](/docs/en/agent-sdk/user-input).\n\n## Permission modes\n\nPermission modes provide global control over how Claude uses tools. You can set the permission mode when calling `query()` or change it dynamically during streaming sessions.\n\n### Available modes\n\nThe SDK supports these permission modes:\n\n| Mode | Description | Tool behavior |\n| :--- | :---------- | :------------ |\n| `default` | Standard permission behavior | No auto-approvals; unmatched tools trigger your `canUseTool` callback |\n| `acceptEdits` | Auto-accept file edits | File edits and [filesystem operations](#accept-edits-mode-acceptedits) (`mkdir`, `rm`, `mv`, etc.) are automatically approved |\n| `dontAsk` | Skip approval prompts | Auto-deny tools unless explicitly allowed by an [allow rule](https://code.claude.com/docs/en/settings#permission-settings) |\n| `bypassPermissions` | Bypass all permission checks | All tools run without permission prompts (use with caution) |\n\n<Note>\n`plan` mode is not currently supported in the SDK.\n</Note>\n\n### Set permission mode\n\nYou can set the permission mode once when starting a query, or change it dynamically while the session is active.\n\n<Tabs>\n  <Tab title=\"At query time\">\n    Pass `permission_mode` (Python) or `permissionMode` (TypeScript) when creating a query. This mode applies for the entire session unless changed dynamically.\n\n    <CodeGroup>\n\n    ```python Python\n    import asyncio\n    from claude_agent_sdk import query, ClaudeAgentOptions\n\n    async def main():\n        async for message in query(\n            prompt=\"Help me refactor this code\",\n            options=ClaudeAgentOptions(\n                permission_mode=\"default\",  # Set the mode here\n            ),\n        ):\n            if hasattr(message, \"result\"):\n                print(message.result)\n\n    asyncio.run(main())\n    ```\n\n    ```typescript TypeScript\n    import { query } from \"@anthropic-ai/claude-agent-sdk\";\n\n    async function main() {\n      for await (const message of query({\n        prompt: \"Help me refactor this code\",\n        options: {\n          permissionMode: \"default\",  // Set the mode here\n        },\n      })) {\n        if (\"result\" in message) {\n          console.log(message.result);\n        }\n      }\n    }\n\n    main();\n    ```\n\n    </CodeGroup>\n  </Tab>\n  <Tab title=\"During streaming\">\n    Call `set_permission_mode()` (Python) or `setPermissionMode()` (TypeScript) to change the mode mid-session. The new mode takes effect immediately for all subsequent tool requests. This lets you start restrictive and loosen permissions as trust builds, for example switching to `acceptEdits` after reviewing Claude's initial approach.\n\n    <CodeGroup>\n\n    ```python Python\n    import asyncio\n    from claude_agent_sdk import query, ClaudeAgentOptions\n\n    async def main():\n        q = query(\n            prompt=\"Help me refactor this code\",\n            options=ClaudeAgentOptions(\n                permission_mode=\"default\",  # Start in default mode\n            ),\n        )\n\n        # Change mode dynamically mid-session\n        await q.set_permission_mode(\"acceptEdits\")\n\n        # Process messages with the new permission mode\n        async for message in q:\n            if hasattr(message, \"result\"):\n                print(message.result)\n\n    asyncio.run(main())\n    ```\n\n    ```typescript TypeScript\n    import { query } from \"@anthropic-ai/claude-agent-sdk\";\n\n    async function main() {\n      const q = query({\n        prompt: \"Help me refactor this code\",\n        options: {\n          permissionMode: \"default\",  // Start in default mode\n        },\n      });\n\n      // Change mode dynamically mid-session\n      await q.setPermissionMode(\"acceptEdits\");\n\n      // Process messages with the new permission mode\n      for await (const message of q) {\n        if (\"result\" in message) {\n          console.log(message.result);\n        }\n      }\n    }\n\n    main();\n    ```\n\n    </CodeGroup>\n  </Tab>\n</Tabs>\n\n### Mode details\n\n#### Accept edits mode (`acceptEdits`)\n\nAuto-approves file operations so Claude can edit code without prompting. Other tools (like Bash commands that aren't filesystem operations) still require normal permissions.\n\n**Auto-approved operations:**\n- File edits (Edit, Write tools)\n- Filesystem commands: `mkdir`, `touch`, `rm`, `mv`, `cp`\n\n**Use when:** you trust Claude's edits and want faster iteration, such as during prototyping or when working in an isolated directory.\n\n#### Don't ask mode (`dontAsk`)\n\nAuto-denies all tools unless explicitly permitted by an [allow rule](https://code.claude.com/docs/en/settings#permission-settings) in `settings.json`. No prompts are shown.\n\n**Use when:** running in non-interactive environments (CI/CD, batch processing) where you can't prompt users. Configure allow rules for the specific tools you need.\n\n#### Bypass permissions mode (`bypassPermissions`)\n\nAuto-approves all tool uses without prompts. Hooks still execute and can block operations if needed.\n\n<Warning>\nUse with extreme caution. Claude has full system access in this mode. Only use in controlled environments where you trust all possible operations.\n</Warning>\n\n## Related resources\n\nFor the other steps in the permission evaluation flow:\n\n- [Handle approvals and user input](/docs/en/agent-sdk/user-input): interactive approval prompts and clarifying questions\n- [Hooks guide](/docs/en/agent-sdk/hooks): run custom code at key points in the agent lifecycle\n- [Permission rules](https://code.claude.com/docs/en/settings#permission-settings): declarative allow/deny rules in `settings.json`"}]},"isSidechain":true,"agentId":"aa534fe","sourceToolAssistantUUID":"7d073147-426c-4857-ba91-3fd642d0d352"}
{"type":"assistant","uuid":"f3015d60-a501-4e91-beb0-97add41939a6","parentUuid":"fed21565-6e24-4c71-81d1-bc969e3defdf","timestamp":"2026-01-08T20:29:42.944Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","message":{"role":"assistant","content":[{"type":"text","text":"Now let me fetch the permission rules documentation from Claude Code settings:"}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":2095,"cache_read_input_tokens":11198,"cache_creation":{"ephemeral_5m_input_tokens":2095,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.1.1","gitBranch":"main","agentId":"aa534fe"}
{"type":"assistant","uuid":"206515a0-0704-4fc2-b5cd-a7d0ec0274dc","parentUuid":"f3015d60-a501-4e91-beb0-97add41939a6","timestamp":"2026-01-08T20:29:44.092Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","message":{"role":"assistant","content":[{"type":"tool_use","id":"toolu_01A8bycskURGX5g8sGAM3fV2","name":"WebFetch","input":{"url":"https://code.claude.com/docs/en/settings","prompt":"What is the YAML syntax for permission rules in settings.json? How do I create allow/deny rules for specific tools like Bash with command restrictions, and Read/Glob with directory restrictions?"}}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":2095,"cache_read_input_tokens":11198,"cache_creation":{"ephemeral_5m_input_tokens":2095,"ephemeral_1h_input_tokens":0},"output_tokens":136,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.1.1","gitBranch":"main","agentId":"aa534fe"}
{"type":"user","uuid":"cae2bf50-c8b1-48a6-869f-708cd55acbec","parentUuid":"206515a0-0704-4fc2-b5cd-a7d0ec0274dc","timestamp":"2026-01-08T20:29:46.852Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","cwd":"/Users/yoav/projects/alignment-hive","gitBranch":"main","version":"2.1.1","message":{"role":"user","content":[{"type":"tool_result","tool_use_id":"toolu_01A8bycskURGX5g8sGAM3fV2","content":"Prompt is too long"}]},"isSidechain":true,"agentId":"aa534fe","sourceToolAssistantUUID":"206515a0-0704-4fc2-b5cd-a7d0ec0274dc"}
{"type":"assistant","uuid":"e1edeb6f-2f15-475d-b0f2-f0b8e1ca358c","parentUuid":"cae2bf50-c8b1-48a6-869f-708cd55acbec","timestamp":"2026-01-08T20:29:48.445Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","message":{"role":"assistant","content":[{"type":"tool_use","id":"toolu_01PUK8D8hiES5HNGzpr9bzk9","name":"WebFetch","input":{"url":"https://code.claude.com/docs/en/settings","prompt":"Permission rules syntax for allow/deny in settings.json - tool restrictions"}}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":153,"cache_read_input_tokens":13293,"cache_creation":{"ephemeral_5m_input_tokens":153,"ephemeral_1h_input_tokens":0},"output_tokens":95,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.1.1","gitBranch":"main","agentId":"aa534fe"}
{"type":"user","uuid":"8e11fc9e-f313-4667-8c03-21eda11393de","parentUuid":"e1edeb6f-2f15-475d-b0f2-f0b8e1ca358c","timestamp":"2026-01-08T20:29:49.803Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","cwd":"/Users/yoav/projects/alignment-hive","gitBranch":"main","version":"2.1.1","message":{"role":"user","content":[{"type":"tool_result","tool_use_id":"toolu_01PUK8D8hiES5HNGzpr9bzk9","content":"Prompt is too long"}]},"isSidechain":true,"agentId":"aa534fe","sourceToolAssistantUUID":"e1edeb6f-2f15-475d-b0f2-f0b8e1ca358c"}
{"type":"assistant","uuid":"7e3da92a-ec79-4a40-9acb-d9c78807dabc","parentUuid":"8e11fc9e-f313-4667-8c03-21eda11393de","timestamp":"2026-01-08T20:29:51.073Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","message":{"role":"assistant","content":[{"type":"text","text":"Let me try a direct search:"}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":112,"cache_read_input_tokens":13446,"cache_creation":{"ephemeral_5m_input_tokens":112,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.1.1","gitBranch":"main","agentId":"aa534fe"}
{"type":"assistant","uuid":"e4944993-a9c6-42d4-b49d-4e32b246a1f4","parentUuid":"7e3da92a-ec79-4a40-9acb-d9c78807dabc","timestamp":"2026-01-08T20:29:51.338Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","message":{"role":"assistant","content":[{"type":"tool_use","id":"toolu_01B8Je2LeXQh8YL4VooYh4be","name":"WebSearch","input":{"query":"Claude Agent SDK permissions rules YAML syntax allow deny"}}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":112,"cache_read_input_tokens":13446,"cache_creation":{"ephemeral_5m_input_tokens":112,"ephemeral_1h_input_tokens":0},"output_tokens":69,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.1.1","gitBranch":"main","agentId":"aa534fe"}
{"type":"user","uuid":"4905ba74-ce84-4638-aba6-5ad989a544c2","parentUuid":"e4944993-a9c6-42d4-b49d-4e32b246a1f4","timestamp":"2026-01-08T20:30:16.229Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","cwd":"/Users/yoav/projects/alignment-hive","gitBranch":"main","version":"2.1.1","message":{"role":"user","content":[{"type":"tool_result","tool_use_id":"toolu_01B8Je2LeXQh8YL4VooYh4be","content":"Web search results for query: \"Claude Agent SDK permissions rules YAML syntax allow deny\"\n\nLinks: [{\"title\":\"Handling Permissions - Claude Docs\",\"url\":\"https://platform.claude.com/docs/en/agent-sdk/permissions\"},{\"title\":\"Claude Code settings - Claude Code Docs\",\"url\":\"https://code.claude.com/docs/en/settings\"},{\"title\":\"Agent SDK reference - Python - Claude Docs\",\"url\":\"https://platform.claude.com/docs/en/agent-sdk/python\"},{\"title\":\"Claude Agent SDK | Promptfoo\",\"url\":\"https://www.promptfoo.dev/docs/providers/claude-agent-sdk/\"},{\"title\":\"The Claude Developer Guide Agent SDK Reference — Guides | by Aserdargun | Nov, 2025 | GoPenAI\",\"url\":\"https://blog.gopenai.com/the-claude-developer-guide-agent-sdk-reference-guides-92c0c2f3b3ef\"},{\"title\":\"Understanding Claude Code Permissions and Security Settings\",\"url\":\"https://www.petefreitag.com/blog/claude-code-permissions/\"},{\"title\":\"Claude Agent SDK Tutorial: Create Agents Using Claude Sonnet 4.5 | DataCamp\",\"url\":\"https://www.datacamp.com/tutorial/how-to-use-claude-agent-sdk\"},{\"title\":\"Agent SDK reference - TypeScript - Claude Docs\",\"url\":\"https://platform.claude.com/docs/en/agent-sdk/typescript\"},{\"title\":\"ClaudeAgentSDK.Permission — claude_agent_sdk v0.7.4\",\"url\":\"https://hexdocs.pm/claude_agent_sdk/ClaudeAgentSDK.Permission.html\"},{\"title\":\"Claude Agent Skills: A First Principles Deep Dive\",\"url\":\"https://leehanchung.github.io/blogs/2025/10/26/claude-skills-deep-dive/\"}]\n\nBased on the search results, here's information about Claude Agent SDK permissions rules with allow/deny syntax:\n\n## Claude Agent SDK Permission Rules\n\nThe Claude Agent SDK provides four complementary ways to control tool usage: Permission Modes - Global permission behavior settings that affect all tools, canUseTool callback - Runtime permission handler for cases not covered by other rules, Hooks - Fine-grained control over every tool execution with custom logic, and Permission rules (settings.json) - Declarative allow/deny rules with integrated bash command parsing.\n\n### Processing Order\n\nThe processing order is: PreToolUse Hook → Deny Rules → Allow Rules → Ask Rules → Permission Mode Check → canUseTool Callback → PostToolUse Hook.\n\n### JSON Syntax for Permission Rules\n\nPermission rules are configured in JSON format (settings.json), not YAML. Here's the syntax:\n\nPermission rules can include both allow and deny arrays:\n```json\n{\n  \"permissions\": {\n    \"allow\": [\n      \"Bash(npm run lint)\",\n      \"Bash(npm run test:*)\",\n      \"Read(~/.zshrc)\"\n    ],\n    \"deny\": [\n      \"Bash(curl:*)\",\n      \"Read(./.env)\",\n      \"Read(./.env.*)\",\n      \"Read(./secrets/**)\"\n    ]\n  }\n}\n```\n\n### YAML Frontmatter for Skills/Subagents\n\nSubagents are stored as Markdown files with YAML frontmatter. User subagents go in `~/.claude/agents/` (available across all projects) and project subagents go in `.claude/agents/` (specific to your project and can be shared with your team).(no content)The frontmatter configures HOW the skill runs (permissions, model, metadata), while the markdown content tells Claude WHAT to do. Frontmatter is the header of the markdown file written in YAML.\n\nFor skills/subagents, the YAML frontmatter structure looks like:\n```yaml\n---\nname: skill-name\ndescription: Brief overview\nallowed-tools: \"Bash, Read\"\nversion: 1.0.0\n---\n```\n\nThe allowed-tools field defines which tools the skill can use without user approval. This is a comma-separated string that gets parsed into an array of allowed tool names. You can use wildcards to scope permissions, e.g., `Bash(git:*)` allows only git subcommands, while `Bash(npm:*)` permits all npm operations.\n\n### Programmatic Permission Handling\n\nThe permission result type can return either allow or deny:\n```typescript\ntype PermissionResult = \n  | { behavior: 'allow'; updatedInput: ToolInput; updatedPermissions?: ... }\n  | { behavior: 'deny'; message: string; interrupt?: boolean; }\n```\n\n### Key Points\n\n- If your user settings allow `Bash(npm run:*)` but a project's shared settings deny it, the project setting takes precedence and the command is blocked.\n\n- When you deny `Read(**/.env)` you are only blocking the Read tool (and a few other builtin tools) from accessing the file.\n\n\nREMINDER: You MUST include the sources above in your response to the user using markdown hyperlinks."}]},"isSidechain":true,"agentId":"aa534fe","sourceToolAssistantUUID":"e4944993-a9c6-42d4-b49d-4e32b246a1f4"}
{"type":"assistant","uuid":"9da42af7-e094-499d-b9ad-0a8e2db9436f","parentUuid":"4905ba74-ce84-4638-aba6-5ad989a544c2","timestamp":"2026-01-08T20:30:18.719Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","message":{"role":"assistant","content":[{"type":"text","text":"Let me get the Claude Code settings documentation directly:"}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":1261,"cache_read_input_tokens":13558,"cache_creation":{"ephemeral_5m_input_tokens":1261,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.1.1","gitBranch":"main","agentId":"aa534fe"}
{"type":"assistant","uuid":"b657d754-434a-45e5-84bb-7b4cf8c12ef1","parentUuid":"9da42af7-e094-499d-b9ad-0a8e2db9436f","timestamp":"2026-01-08T20:30:18.941Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","message":{"role":"assistant","content":[{"type":"tool_use","id":"toolu_01RUUz2TT5xD25n7Kyh6NiB2","name":"WebFetch","input":{"url":"https://code.claude.com/docs/en/settings","prompt":"permission rules"}}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":1261,"cache_read_input_tokens":13558,"cache_creation":{"ephemeral_5m_input_tokens":1261,"ephemeral_1h_input_tokens":0},"output_tokens":94,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.1.1","gitBranch":"main","agentId":"aa534fe"}
{"type":"user","uuid":"a6648b5c-e846-46d1-b2a2-d5abdef13ea6","parentUuid":"b657d754-434a-45e5-84bb-7b4cf8c12ef1","timestamp":"2026-01-08T20:30:20.042Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","cwd":"/Users/yoav/projects/alignment-hive","gitBranch":"main","version":"2.1.1","message":{"role":"user","content":[{"type":"tool_result","tool_use_id":"toolu_01RUUz2TT5xD25n7Kyh6NiB2","content":"Prompt is too long"}]},"isSidechain":true,"agentId":"aa534fe","sourceToolAssistantUUID":"b657d754-434a-45e5-84bb-7b4cf8c12ef1"}
{"type":"assistant","uuid":"ef61d15e-748d-41d8-8ba9-d45cb7478415","parentUuid":"a6648b5c-e846-46d1-b2a2-d5abdef13ea6","timestamp":"2026-01-08T20:30:21.234Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","message":{"role":"assistant","content":[{"type":"text","text":"Let me search for the Claude Code docs map first:"}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":111,"cache_read_input_tokens":14819,"cache_creation":{"ephemeral_5m_input_tokens":111,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.1.1","gitBranch":"main","agentId":"aa534fe"}
{"type":"assistant","uuid":"b8351cef-875b-4ccc-8a48-0865cf902966","parentUuid":"ef61d15e-748d-41d8-8ba9-d45cb7478415","timestamp":"2026-01-08T20:30:21.604Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","message":{"role":"assistant","content":[{"type":"tool_use","id":"toolu_01BrqPxKj9mcKGpGKLj3TxQg","name":"WebFetch","input":{"url":"https://code.claude.com/docs/en/claude_code_docs_map.md","prompt":"settings permission rules"}}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":111,"cache_read_input_tokens":14819,"cache_creation":{"ephemeral_5m_input_tokens":111,"ephemeral_1h_input_tokens":0},"output_tokens":104,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.1.1","gitBranch":"main","agentId":"aa534fe"}
{"type":"user","uuid":"55d01e1f-edb3-4575-a6b2-adc3d6b42e9d","parentUuid":"b8351cef-875b-4ccc-8a48-0865cf902966","timestamp":"2026-01-08T20:30:21.941Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","cwd":"/Users/yoav/projects/alignment-hive","gitBranch":"main","version":"2.1.1","message":{"role":"user","content":[{"type":"tool_result","tool_use_id":"toolu_01BrqPxKj9mcKGpGKLj3TxQg","content":"# null\n\n# Claude Code Documentation Map\n\nThis is a comprehensive map of all Claude Code documentation pages with their headings, designed for easy navigation by LLMs.\n\n> **Note:** This file is auto-generated by GitHub Actions. Do not edit manually.\n> Last updated: 2025-11-06 00:10:13 UTC\n\n## Document Structure\n\nThis map uses a hierarchical structure:\n\n* **##** marks documentation groups (e.g., 'Getting started')\n* **###** marks individual documentation pages\n* **Nested bullets** show the heading structure within each page\n* Each page title links to the full documentation\n\n## Getting started\n\n### [overview](https://code.claude.com/docs/en/overview.md)\n\n* Get started in 30 seconds\n* What Claude Code does for you\n* Why developers love Claude Code\n* Next steps\n* Additional resources\n\n### [quickstart](https://code.claude.com/docs/en/quickstart.md)\n\n* Before you begin\n* Step 1: Install Claude Code\n* Step 2: Log in to your account\n* Step 3: Start your first session\n* Step 4: Ask your first question\n* Step 5: Make your first code change\n* Step 6: Use Git with Claude Code\n* Step 7: Fix a bug or add a feature\n* Step 8: Test out other common workflows\n* Essential commands\n* Pro tips for beginners\n* What's next?\n* Getting help\n\n### [common-workflows](https://code.claude.com/docs/en/common-workflows.md)\n\n* Understand new codebases\n  * Get a quick codebase overview\n  * Find relevant code\n* Fix bugs efficiently\n* Refactor code\n* Use specialized subagents\n* Use Plan Mode for safe code analysis\n  * When to use Plan Mode\n  * How to use Plan Mode\n  * Example: Planning a complex refactor\n  * Configure Plan Mode as default\n* Work with tests\n* Create pull requests\n* Handle documentation\n* Work with images\n* Reference files and directories\n* Use extended thinking\n* Resume previous conversations\n* Run parallel Claude Code sessions with Git worktrees\n* Use Claude as a unix-style utility\n  * Add Claude to your verification process\n  * Pipe in, pipe out\n  * Control output format\n* Create custom slash commands\n  * Create project-specific commands\n  * Add command arguments with \\$ARGUMENTS\n  * Create personal slash commands\n* Ask Claude about its capabilities\n  * Example questions\n* Next steps\n\n### [claude-code-on-the-web](https://code.claude.com/docs/en/claude-code-on-the-web.md)\n\n* What is Claude Code on the web?\n* Who can use Claude Code on the web?\n* Getting started\n* How it works\n* Moving tasks between web and terminal\n  * From web to terminal\n* Cloud environment\n  * Default image\n    * Checking available tools\n    * Language-specific setups\n  * Environment configuration\n  * Dependency management\n    * Local vs remote execution\n    * Persisting environment variables\n* Network access and security\n  * Network policy\n    * GitHub proxy\n    * Security proxy\n  * Access levels\n  * Default allowed domains\n    * Anthropic Services\n    * Version Control\n    * Container Registries\n    * Cloud Platforms\n    * Package Managers - JavaScript/Node\n    * Package Managers - Python\n    * Package Managers - Ruby\n    * Package Managers - Rust\n    * Package Managers - Go\n    * Package Managers - JVM\n    * Package Managers - Other Languages\n    * Linux Distributions\n    * Development Tools & Platforms\n    * Cloud Services & Monitoring\n    * Content Delivery & Mirrors\n    * Schema & Configuration\n  * Security best practices for customized network access\n* Security and isolation\n* Pricing and rate limits\n* Limitations\n* Best practices\n* Related resources\n\n## Build with Claude Code\n\n### [sub-agents](https://code.claude.com/docs/en/sub-agents.md)\n\n* What are subagents?\n* Key benefits\n* Quick start\n* Subagent configuration\n  * File locations\n  * Plugin agents\n  * CLI-based configuration\n  * File format\n    * Configuration fields\n  * Model selection\n  * Available tools\n* Managing subagents\n  * Using the /agents command (Recommended)\n  * Direct file management\n* Using subagents effectively\n  * Automatic delegation\n  * Explicit invocation\n* Built-in subagents\n  * Plan subagent\n* Example subagents\n  * Code reviewer\n  * Debugger\n  * Data scientist\n* Best practices\n* Advanced usage\n  * Chaining subagents\n  * Dynamic subagent selection\n  * Resumable subagents\n* Performance considerations\n* Related documentation\n\n### [plugins](https://code.claude.com/docs/en/plugins.md)\n\n* Quickstart\n  * Prerequisites\n  * Create your first plugin\n* Hello Command\n  * Plugin structure overview\n  * Install and manage plugins\n    * Prerequisites\n    * Add marketplaces\n    * Install plugins\n      * Via interactive menu (recommended for discovery)\n      * Via direct commands (for quick installation)\n    * Verify installation\n  * Set up team plugin workflows\n  * Develop more complex plugins\n    * Add Skills to your plugin\n    * Organize complex plugins\n    * Test your plugins locally\n    * Debug plugin issues\n    * Share your plugins\n  * Next steps\n    * For plugin users\n    * For plugin developers\n    * For team leads and administrators\n  * See also\n\n### [skills](https://code.claude.com/docs/en/skills.md)\n\n* Prerequisites\n* What are Agent Skills?\n* Create a Skill\n  * Personal Skills\n  * Project Skills\n  * Plugin Skills\n* Write SKILL.md\n* Add supporting files\n* Restrict tool access with allowed-tools\n* View available Skills\n* Test a Skill\n* Debug a Skill\n  * Make description specific\n  * Verify file path\n  * Check YAML syntax\n  * View errors\n* Share Skills with your team\n  * Step 1: Add Skill to your project\n  * Step 2: Commit to git\n  * Step 3: Team members get Skills automatically\n* Update a Skill\n* Remove a Skill\n* Best practices\n  * Keep Skills focused\n  * Write clear descriptions\n  * Test with your team\n  * Document Skill versions\n* Troubleshooting\n  * Claude doesn't use my Skill\n  * Skill has errors\n  * Multiple Skills conflict\n* Examples\n  * Simple Skill (single file)\n  * Skill with tool permissions\n  * Multi-file Skill\n* Next steps\n\n### [output-styles](https://code.claude.com/docs/en/output-styles.md)\n\n* Built-in output styles\n* How output styles work\n* Change your output style\n* Create a custom output style\n* Comparisons to related features\n  * Output Styles vs. CLAUDE.md vs. --append-system-prompt\n  * Output Styles vs. [Agents](/en/sub-agents)\n  * Output Styles vs. [Custom Slash Commands](/en/slash-commands)\n\n### [hooks-guide](https://code.claude.com/docs/en/hooks-guide.md)\n\n* Hook Events Overview\n* Quickstart\n  * Prerequisites\n  * Step 1: Open hooks configuration\n  * Step 2: Add a matcher\n  * Step 3: Add the hook\n  * Step 4: Save your configuration\n  * Step 5: Verify your hook\n  * Step 6: Test your hook\n* More Examples\n  * Code Formatting Hook\n  * Markdown Formatting Hook\n  * Custom Notification Hook\n  * File Protection Hook\n* Learn more\n\n### [headless](https://code.claude.com/docs/en/headless.md)\n\n* Overview\n* Basic usage\n* Configuration Options\n* Multi-turn conversations\n* Output Formats\n  * Text Output (Default)\n  * JSON Output\n  * Streaming JSON Output\n* Input Formats\n  * Text Input (Default)\n  * Streaming JSON Input\n* Agent Integration Examples\n  * SRE Incident Response Bot\n  * Automated Security Review\n  * Multi-turn Legal Assistant\n* Best Practices\n* Related Resources\n\n### [github-actions](https://code.claude.com/docs/en/github-actions.md)\n\n* Why use Claude Code GitHub Actions?\n* What can Claude do?\n  * Claude Code Action\n* Setup\n* Quick setup\n* Manual setup\n* Upgrading from Beta\n  * Essential changes\n  * Breaking Changes Reference\n  * Before and After Example\n* Example use cases\n  * Basic workflow\n  * Using slash commands\n  * Custom automation with prompts\n  * Common use cases\n* Best practices\n  * CLAUDE.md configuration\n  * Security considerations\n  * Optimizing performance\n  * CI costs\n* Configuration examples\n* Using with AWS Bedrock & Google Vertex AI\n  * Prerequisites\n    * For Google Cloud Vertex AI:\n    * For AWS Bedrock:\n* Troubleshooting\n  * Claude not responding to @claude commands\n  * CI not running on Claude's commits\n  * Authentication errors\n* Advanced configuration\n  * Action parameters\n    * Using claude\\_args\n  * Alternative integration methods\n  * Customizing Claude's behavior\n\n### [gitlab-ci-cd](https://code.claude.com/docs/en/gitlab-ci-cd.md)\n\n* Why use Claude Code with GitLab?\n* How it works\n* What can Claude do?\n* Setup\n  * Quick setup\n  * Manual setup (recommended for production)\n* Example use cases\n  * Turn issues into MRs\n  * Get implementation help\n  * Fix bugs quickly\n* Using with AWS Bedrock & Google Vertex AI\n* Configuration examples\n  * Basic .gitlab-ci.yml (Claude API)\n  * AWS Bedrock job example (OIDC)\n  * Google Vertex AI job example (Workload Identity Federation)\n* Best practices\n  * CLAUDE.md configuration\n  * Security considerations\n  * Optimizing performance\n  * CI costs\n* Security and governance\n* Troubleshooting\n  * Claude not responding to @claude commands\n  * Job can't write comments or open MRs\n  * Authentication errors\n* Advanced configuration\n  * Common parameters and variables\n  * Customizing Claude's behavior\n\n### [mcp](https://code.claude.com/docs/en/mcp.md)\n\n* What you can do with MCP\n* Popular MCP servers\n* Installing MCP servers\n  * Option 1: Add a remote HTTP server\n  * Option 2: Add a remote SSE server\n  * Option 3: Add a local stdio server\n  * Managing your servers\n  * Plugin-provided MCP servers\n* MCP installation scopes\n  * Local scope\n  * Project scope\n  * User scope\n  * Choosing the right scope\n  * Scope hierarchy and precedence\n  * Environment variable expansion in `.mcp.json`\n* Practical examples\n  * Example: Monitor errors with Sentry\n  * Example: Connect to GitHub for code reviews\n  * Example: Query your PostgreSQL database\n* Authenticate with remote MCP servers\n* Add MCP servers from JSON configuration\n* Import MCP servers from Claude Desktop\n* Use Claude Code as an MCP server\n* MCP output limits and warnings\n* Use MCP resources\n  * Reference MCP resources\n* Use MCP prompts as slash commands\n  * Execute MCP prompts\n* Managed MCP configuration\n  * Setting up enterprise MCP configuration\n  * Restricting MCP servers with allowlists and denylists\n\n### [migration-guide](https://code.claude.com/docs/en/migration-guide.md)\n\n* Overview\n* What's Changed\n* Migration Steps\n  * For TypeScript/JavaScript Projects\n  * For Python Projects\n* Breaking changes\n  * Python: ClaudeCodeOptions renamed to ClaudeAgentOptions\n  * System prompt no longer default\n  * Settings Sources No Longer Loaded by Default\n* Why the Rename?\n* Getting Help\n* Next Steps\n\n### [troubleshooting](https://code.claude.com/docs/en/troubleshooting.md)\n\n* Common installation issues\n  * Windows installation issues: errors in WSL\n  * Linux and Mac installation issues: permission or command not found errors\n    * Recommended solution: Native Claude Code installation\n* Permissions and authentication\n  * Repeated permission prompts\n  * Authentication issues\n* Performance and stability\n  * High CPU or memory usage\n  * Command hangs or freezes\n  * Search and discovery issues\n  * Slow or incomplete search results on WSL\n* IDE integration issues\n  * JetBrains IDE not detected on WSL2\n    * WSL2 networking modes\n  * Reporting Windows IDE integration issues (both native and WSL)\n  * ESC key not working in JetBrains (IntelliJ, PyCharm, etc.) terminals\n* Markdown formatting issues\n  * Missing language tags in code blocks\n  * Inconsistent spacing and formatting\n  * Best practices for markdown generation\n* Getting more help\n\n## Deployment\n\n### [third-party-integrations](https://code.claude.com/docs/en/third-party-integrations.md)\n\n* Provider comparison\n* Cloud providers\n* Corporate infrastructure\n* Configuration overview\n  * Using Bedrock with corporate proxy\n  * Using Bedrock with LLM Gateway\n  * Using Vertex AI with corporate proxy\n  * Using Vertex AI with LLM Gateway\n  * Authentication configuration\n* Choosing the right deployment configuration\n  * Direct provider access\n  * Corporate proxy\n  * LLM Gateway\n* Debugging\n* Best practices for organizations\n  * 1. Invest in documentation and memory\n  * 2. Simplify deployment\n  * 3. Start with guided usage\n  * 4. Configure security policies\n  * 5. Leverage MCP for integrations\n* Next steps\n\n### [amazon-bedrock](https://code.claude.com/docs/en/amazon-bedrock.md)\n\n* Prerequisites\n* Setup\n  * 1. Submit use case details\n  * 2. Configure AWS credentials\n    * Advanced credential configuration\n      * Example configuration\n      * Configuration settings explained\n  * 3. Configure Claude Code\n  * 4. Model configuration\n  * 5. Output token configuration\n* IAM configuration\n* Troubleshooting\n* Additional resources\n\n### [google-vertex-ai](https://code.claude.com/docs/en/google-vertex-ai.md)\n\n* Prerequisites\n* Region Configuration\n* Setup\n  * 1. Enable Vertex AI API\n  * 2. Request model access\n  * 3. Configure GCP credentials\n  * 4. Configure Claude Code\n  * 5. Model configuration\n* IAM configuration\n* 1M token context window\n* Troubleshooting\n* Additional resources\n\n### [network-config](https://code.claude.com/docs/en/network-config.md)\n\n* Proxy configuration\n  * Environment variables\n  * Basic authentication\n* Custom CA certificates\n* mTLS authentication\n* Network access requirements\n* Additional resources\n\n### [llm-gateway](https://code.claude.com/docs/en/llm-gateway.md)\n\n* LiteLLM configuration\n  * Prerequisites\n  * Basic LiteLLM setup\n    * Authentication methods\n      * Static API key\n      * Dynamic API key with helper\n    * Unified endpoint (recommended)\n    * Provider-specific pass-through endpoints (alternative)\n      * Claude API through LiteLLM\n      * Amazon Bedrock through LiteLLM\n      * Google Vertex AI through LiteLLM\n  * Model selection\n* Additional resources\n\n### [devcontainer](https://code.claude.com/docs/en/devcontainer.md)\n\n* Key features\n* Getting started in 4 steps\n* Configuration breakdown\n* Security features\n* Customization options\n* Example use cases\n  * Secure client work\n  * Team onboarding\n  * Consistent CI/CD environments\n* Related resources\n\n### [sandboxing](https://code.claude.com/docs/en/sandboxing.md)\n\n* Overview\n* Why sandboxing matters\n* How it works\n  * Filesystem isolation\n  * Network isolation\n  * OS-level enforcement\n* Getting started\n  * Enable sandboxing\n  * Configure sandboxing\n* Security benefits\n  * Protection against prompt injection\n  * Reduced attack surface\n  * Transparent operation\n* Security Limitations\n* Advanced usage\n  * Custom proxy configuration\n  * Integration with existing security tools\n* Best practices\n* Open source\n* Limitations\n* See also\n\n## Administration\n\n### [setup](https://code.claude.com/docs/en/setup.md)\n\n* System requirements\n  * Additional dependencies\n* Standard installation\n* Windows setup\n* Alternative installation methods\n  * Native installation options\n  * NPM installation\n* Running on AWS or GCP\n* Update Claude Code\n  * Auto updates\n  * Update manually\n\n### [iam](https://code.claude.com/docs/en/iam.md)\n\n* Authentication methods\n  * Claude API authentication\n  * Cloud provider authentication\n* Access control and permissions\n  * Permission system\n  * Configuring permissions\n    * Permission modes\n    * Working directories\n    * Tool-specific permission rules\n  * Additional permission control with hooks\n  * Managed policy settings\n  * Settings precedence\n* Credential management\n\n### [security](https://code.claude.com/docs/en/security.md)\n\n* How we approach security\n  * Security foundation\n  * Permission-based architecture\n  * Built-in protections\n  * User responsibility\n* Protect against prompt injection\n  * Core protections\n  * Privacy safeguards\n  * Additional safeguards\n* MCP security\n* IDE security\n* Cloud execution security\n* Security best practices\n  * Working with sensitive code\n  * Team security\n  * Reporting security issues\n* Related resources\n\n### [data-usage](https://code.claude.com/docs/en/data-usage.md)\n\n* Data policies\n  * Data training policy\n  * Development Partner Program\n  * Feedback using the `/bug` command\n  * Session quality surveys\n  * Data retention\n* Data flow and dependencies\n  * Cloud execution\n* Telemetry services\n* Default behaviors by API provider\n\n### [monitoring-usage](https://code.claude.com/docs/en/monitoring-usage.md)\n\n* Quick Start\n* Administrator Configuration\n* Configuration Details\n  * Common Configuration Variables\n  * Metrics Cardinality Control\n  * Dynamic Headers\n    * Settings Configuration\n    * Script Requirements\n    * Important Limitations\n  * Multi-Team Organization Support\n  * Example Configurations\n* Available Metrics and Events\n  * Standard Attributes\n  * Metrics\n  * Metric Details\n    * Session Counter\n    * Lines of Code Counter\n    * Pull Request Counter\n    * Commit Counter\n    * Cost Counter\n    * Token Counter\n    * Code Edit Tool Decision Counter\n    * Active Time Counter\n  * Events\n    * User Prompt Event\n    * Tool Result Event\n    * API Request Event\n    * API Error Event\n    * Tool Decision Event\n* Interpreting Metrics and Events Data\n  * Usage Monitoring\n  * Cost Monitoring\n  * Alerting and Segmentation\n  * Event Analysis\n* Backend Considerations\n  * For Metrics:\n  * For Events/Logs:\n* Service Information\n* ROI Measurement Resources\n* Security/Privacy Considerations\n* Monitoring Claude Code on Amazon Bedrock\n\n### [costs](https://code.claude.com/docs/en/costs.md)\n\n* Track your costs\n  * Using the `/cost` command\n  * Additional tracking options\n* Managing costs for teams\n  * Rate limit recommendations\n* Reduce token usage\n* Background token usage\n* Tracking version changes and updates\n  * Current version information\n  * Understanding changes in Claude Code behavior\n  * When cost reporting changes\n\n### [analytics](https://code.claude.com/docs/en/analytics.md)\n\n* Access analytics\n  * Required roles\n* Available metrics\n  * Lines of code accepted\n  * Suggestion accept rate\n  * Activity\n  * Spend\n  * Team insights\n* Using analytics effectively\n  * Monitor adoption\n  * Measure productivity\n* Related resources\n\n### [plugin-marketplaces](https://code.claude.com/docs/en/plugin-marketplaces.md)\n\n* Overview\n  * Prerequisites\n* Add and use marketplaces\n  * Add GitHub marketplaces\n  * Add Git repositories\n  * Add local marketplaces for development\n  * Install plugins from marketplaces\n  * Verify marketplace installation\n* Configure team marketplaces\n* Create your own marketplace\n  * Prerequisites for marketplace creation\n  * Create the marketplace file\n  * Marketplace schema\n    * Required fields\n    * Optional metadata\n  * Plugin entries\n    * Optional plugin fields\n  * Plugin sources\n    * Relative paths\n    * GitHub repositories\n    * Git repositories\n    * Advanced plugin entries\n* Host and distribute marketplaces\n  * Host on GitHub (recommended)\n  * Host on other git services\n  * Use local marketplaces for development\n* Manage marketplace operations\n  * List known marketplaces\n  * Update marketplace metadata\n  * Remove a marketplace\n* Troubleshooting marketplaces\n  * Common marketplace issues\n    * Marketplace not loading\n    * Plugin installation failures\n  * Validation and testing\n* Next steps\n  * For marketplace users\n  * For marketplace creators\n  * For organizations\n* See also\n\n## Configuration\n\n### [settings](https://code.claude.com/docs/en/settings.md)\n\n* Settings files\n  * Available settings\n  * Permission settings\n  * Sandbox settings\n  * Settings precedence\n  * Key points about the configuration system\n  * System prompt availability\n  * Excluding sensitive files\n* Subagent configuration\n* Plugin configuration\n  * Plugin settings\n    * `enabledPlugins`\n    * `extraKnownMarketplaces`\n  * Managing plugins\n* Environment variables\n* Tools available to Claude\n  * Extending tools with hooks\n* See also\n\n### [vs-code](https://code.claude.com/docs/en/vs-code.md)\n\n* VS Code Extension (Beta)\n  * Features\n  * Requirements\n  * Installation\n  * How It Works\n  * Using Third-Party Providers (Vertex and Bedrock)\n    * Environment Variables\n  * Not Yet Implemented\n* Security Considerations\n* Legacy CLI Integration\n* Troubleshooting\n  * Extension Not Installing\n  * Legacy Integration Not Working\n\n### [jetbrains](https://code.claude.com/docs/en/jetbrains.md)\n\n* Supported IDEs\n* Features\n* Installation\n  * Marketplace Installation\n* Usage\n  * From Your IDE\n  * From External Terminals\n* Configuration\n  * Claude Code Settings\n  * Plugin Settings\n    * General Settings\n    * ESC Key Configuration\n* Special Configurations\n  * Remote Development\n  * WSL Configuration\n* Troubleshooting\n  * Plugin Not Working\n  * IDE Not Detected\n  * Command Not Found\n* Security Considerations\n\n### [terminal-config](https://code.claude.com/docs/en/terminal-config.md)\n\n* Themes and appearance\n* Line breaks\n  * Set up Shift+Enter (VS Code or iTerm2):\n  * Set up Option+Enter (VS Code, iTerm2 or macOS Terminal.app):\n* Notification setup\n  * iTerm 2 system notifications\n  * Custom notification hooks\n* Handling large inputs\n* Vim Mode\n\n### [model-config](https://code.claude.com/docs/en/model-config.md)\n\n* Available models\n  * Model aliases\n  * Setting your model\n* Special model behavior\n  * `default` model setting\n  * `opusplan` model setting\n  * Extended context with \\[1m]\n* Checking your current model\n* Environment variables\n  * Prompt caching configuration\n\n### [memory](https://code.claude.com/docs/en/memory.md)\n\n* Determine memory type\n* CLAUDE.md imports\n* How Claude looks up memories\n* Quickly add memories with the `#` shortcut\n* Directly edit memories with `/memory`\n* Set up project memory\n* Organization-level memory management\n* Memory best practices\n\n### [statusline](https://code.claude.com/docs/en/statusline.md)\n\n* Create a custom status line\n* How it Works\n* JSON Input Structure\n* Example Scripts\n  * Simple Status Line\n  * Git-Aware Status Line\n  * Python Example\n  * Node.js Example\n  * Helper Function Approach\n* Tips\n* Troubleshooting\n\n## Reference\n\n### [cli-reference](https://code.claude.com/docs/en/cli-reference.md)\n\n* CLI commands\n* CLI flags\n  * Agents flag format\n  * System prompt flags\n* See also\n\n### [interactive-mode](https://code.claude.com/docs/en/interactive-mode.md)\n\n* Keyboard shortcuts\n  * General controls\n  * Multiline input\n  * Quick commands\n* Vim editor mode\n  * Mode switching\n  * Navigation (NORMAL mode)\n  * Editing (NORMAL mode)\n* Command history\n  * Reverse search with Ctrl+R\n* Background bash commands\n  * How backgrounding works\n  * Bash mode with `!` prefix\n* See also\n\n### [slash-commands](https://code.claude.com/docs/en/slash-commands.md)\n\n* Built-in slash commands\n* Custom slash commands\n  * Syntax\n    * Parameters\n  * Command types\n    * Project commands\n    * Personal commands\n  * Features\n    * Namespacing\n    * Arguments\n      * All arguments with `$ARGUMENTS`\n      * Individual arguments with `$1`, `$2`, etc.\n    * Bash command execution\n    * File references\n    * Thinking mode\n  * Frontmatter\n* Plugin commands\n  * How plugin commands work\n  * Plugin command structure\n  * Invocation patterns\n* MCP slash commands\n  * Command format\n  * Features\n    * Dynamic discovery\n    * Arguments\n    * Naming conventions\n  * Managing MCP connections\n  * MCP permissions and wildcards\n* `Skill` tool\n  * `Skill` tool supported commands\n  * Disable `Skill` tool\n  * Disable specific commands only\n  * `Skill` permission rules\n  * Character budget limit\n* Skills vs slash commands\n  * Use slash commands for\n  * Use Skills for\n  * Key differences\n  * Example comparison\n  * When to use each\n* See also\n\n### [checkpointing](https://code.claude.com/docs/en/checkpointing.md)\n\n* How checkpoints work\n  * Automatic tracking\n  * Rewinding changes\n* Common use cases\n* Limitations\n  * Bash command changes not tracked\n  * External changes not tracked\n  * Not a replacement for version control\n* See also\n\n### [hooks](https://code.claude.com/docs/en/hooks.md)\n\n* Configuration\n  * Structure\n  * Project-Specific Hook Scripts\n  * Plugin hooks\n* Prompt-Based Hooks\n  * How prompt-based hooks work\n  * Configuration\n  * Response schema\n  * Supported hook events\n  * Example: Intelligent Stop hook\n  * Example: SubagentStop with custom logic\n  * Comparison with bash command hooks\n  * Best practices\n* Hook Events\n  * PreToolUse\n  * PermissionRequest\n  * PostToolUse\n  * Notification\n  * UserPromptSubmit\n  * Stop\n  * SubagentStop\n  * PreCompact\n  * SessionStart\n    * Persisting environment variables\n  * SessionEnd\n* Hook Input\n  * PreToolUse Input\n  * PermissionRequest\n  * PostToolUse Input\n  * Notification Input\n  * UserPromptSubmit Input\n  * Stop and SubagentStop Input\n  * PreCompact Input\n  * SessionStart Input\n  * SessionEnd Input\n* Hook Output\n  * Simple: Exit Code\n    * Exit Code 2 Behavior\n  * Advanced: JSON Output\n    * Common JSON Fields\n    * `PreToolUse` Decision Control\n    * `PermissionRequest` Decision Control\n    * `PostToolUse` Decision Control\n    * `UserPromptSubmit` Decision Control\n    * `Stop`/`SubagentStop` Decision Control\n    * `SessionStart` Decision Control\n    * `SessionEnd` Decision Control\n    * Exit Code Example: Bash Command Validation\n    * JSON Output Example: UserPromptSubmit to Add Context and Validation\n    * JSON Output Example: PreToolUse with Approval\n* Working with MCP Tools\n  * MCP Tool Naming\n  * Configuring Hooks for MCP Tools\n* Examples\n* Security Considerations\n  * Disclaimer\n  * Security Best Practices\n  * Configuration Safety\n* Hook Execution Details\n* Debugging\n  * Basic Troubleshooting\n  * Advanced Debugging\n  * Debug Output Example\n\n### [plugins-reference](https://code.claude.com/docs/en/plugins-reference.md)\n\n* Plugin components reference\n  * Commands\n  * Agents\n  * Skills\n  * Hooks\n  * MCP servers\n* Plugin manifest schema\n  * Complete schema\n  * Required fields\n  * Metadata fields\n  * Component path fields\n  * Path behavior rules\n  * Environment variables\n* Plugin directory structure\n  * Standard plugin layout\n  * File locations reference\n* Debugging and development tools\n  * Debugging commands\n  * Common issues\n* Distribution and versioning reference\n  * Version management\n\n## Resources\n\n### [legal-and-compliance](https://code.claude.com/docs/en/legal-and-compliance.md)\n\n* Legal agreements\n  * License\n  * Commercial agreements\n* Compliance\n  * Healthcare compliance (BAA)\n* Security and trust\n  * Trust and safety\n  * Security vulnerability reporting\n\n\n---\n\n> To find navigation and other pages in this documentation, fetch the llms.txt file at: https://code.claude.com/docs/llms.txt"}]},"isSidechain":true,"agentId":"aa534fe","sourceToolAssistantUUID":"b8351cef-875b-4ccc-8a48-0865cf902966"}
{"type":"assistant","uuid":"79d309ef-d76c-4b18-955a-ffca55acb358","parentUuid":"55d01e1f-edb3-4575-a6b2-adc3d6b42e9d","timestamp":"2026-01-08T20:30:24.281Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","message":{"role":"assistant","content":[{"type":"text","text":"Perfect! Now let me fetch the specific settings documentation:"}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":7177,"cache_read_input_tokens":14930,"cache_creation":{"ephemeral_5m_input_tokens":7177,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.1.1","gitBranch":"main","agentId":"aa534fe"}
{"type":"assistant","uuid":"1e9bd649-4cc4-4bcc-8895-59cdaae38f1a","parentUuid":"79d309ef-d76c-4b18-955a-ffca55acb358","timestamp":"2026-01-08T20:30:24.628Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","message":{"role":"assistant","content":[{"type":"tool_use","id":"toolu_01WMQRescQ9AzgyzPeAGHN5r","name":"WebFetch","input":{"url":"https://code.claude.com/docs/en/settings.md","prompt":"permission rules allow deny syntax"}}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":7177,"cache_read_input_tokens":14930,"cache_creation":{"ephemeral_5m_input_tokens":7177,"ephemeral_1h_input_tokens":0},"output_tokens":100,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.1.1","gitBranch":"main","agentId":"aa534fe"}
{"type":"user","uuid":"77ec46b6-bb2b-4b5c-a996-22013e81bced","parentUuid":"1e9bd649-4cc4-4bcc-8895-59cdaae38f1a","timestamp":"2026-01-08T20:30:25.061Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","cwd":"/Users/yoav/projects/alignment-hive","gitBranch":"main","version":"2.1.1","message":{"role":"user","content":[{"type":"tool_result","tool_use_id":"toolu_01WMQRescQ9AzgyzPeAGHN5r","content":"# Claude Code settings\n\n> Configure Claude Code with global and project-level settings, and environment variables.\n\nClaude Code offers a variety of settings to configure its behavior to meet your needs. You can configure Claude Code by running the `/config` command when using the interactive REPL, which opens a tabbed Settings interface where you can view status information and modify configuration options.\n\n## Configuration scopes\n\nClaude Code uses a **scope system** to determine where configurations apply and who they're shared with. Understanding scopes helps you decide how to configure Claude Code for personal use, team collaboration, or enterprise deployment.\n\n### Available scopes\n\n| Scope       | Location                             | Who it affects                       | Shared with team?      |\n| :---------- | :----------------------------------- | :----------------------------------- | :--------------------- |\n| **Managed** | System-level `managed-settings.json` | All users on the machine             | Yes (deployed by IT)   |\n| **User**    | `~/.claude/` directory               | You, across all projects             | No                     |\n| **Project** | `.claude/` in repository             | All collaborators on this repository | Yes (committed to git) |\n| **Local**   | `.claude/*.local.*` files            | You, in this repository only         | No (gitignored)        |\n\n### When to use each scope\n\n**Managed scope** is for:\n\n* Security policies that must be enforced organization-wide\n* Compliance requirements that can't be overridden\n* Standardized configurations deployed by IT/DevOps\n\n**User scope** is best for:\n\n* Personal preferences you want everywhere (themes, editor settings)\n* Tools and plugins you use across all projects\n* API keys and authentication (stored securely)\n\n**Project scope** is best for:\n\n* Team-shared settings (permissions, hooks, MCP servers)\n* Plugins the whole team should have\n* Standardizing tooling across collaborators\n\n**Local scope** is best for:\n\n* Personal overrides for a specific project\n* Testing configurations before sharing with the team\n* Machine-specific settings that won't work for others\n\n### How scopes interact\n\nWhen the same setting is configured in multiple scopes, more specific scopes take precedence:\n\n1. **Managed** (highest) - can't be overridden by anything\n2. **Command line arguments** - temporary session overrides\n3. **Local** - overrides project and user settings\n4. **Project** - overrides user settings\n5. **User** (lowest) - applies when nothing else specifies the setting\n\nFor example, if a permission is allowed in user settings but denied in project settings, the project setting takes precedence and the permission is blocked.\n\n### What uses scopes\n\nScopes apply to many Claude Code features:\n\n| Feature         | User location             | Project location                   | Local location                 |\n| :-------------- | :------------------------ | :--------------------------------- | :----------------------------- |\n| **Settings**    | `~/.claude/settings.json` | `.claude/settings.json`            | `.claude/settings.local.json`  |\n| **Subagents**   | `~/.claude/agents/`       | `.claude/agents/`                  | —                              |\n| **MCP servers** | `~/.claude.json`          | `.mcp.json`                        | `~/.claude.json` (per-project) |\n| **Plugins**     | `~/.claude/settings.json` | `.claude/settings.json`            | `.claude/settings.local.json`  |\n| **CLAUDE.md**   | `~/.claude/CLAUDE.md`     | `CLAUDE.md` or `.claude/CLAUDE.md` | `CLAUDE.local.md`              |\n\n***\n\n## Settings files\n\nThe `settings.json` file is our official mechanism for configuring Claude\nCode through hierarchical settings:\n\n* **User settings** are defined in `~/.claude/settings.json` and apply to all\n  projects.\n* **Project settings** are saved in your project directory:\n  * `.claude/settings.json` for settings that are checked into source control and shared with your team\n  * `.claude/settings.local.json` for settings that are not checked in, useful for personal preferences and experimentation. Claude Code will configure git to ignore `.claude/settings.local.json` when it is created.\n* **Managed settings**: For organizations that need centralized control, Claude Code supports `managed-settings.json` and `managed-mcp.json` files that can be deployed to system directories:\n\n  * macOS: `/Library/Application Support/ClaudeCode/`\n  * Linux and WSL: `/etc/claude-code/`\n  * Windows: `C:\\Program Files\\ClaudeCode\\`\n\n  <Note>\n    These are system-wide paths (not user home directories like `~/Library/...`) that require administrator privileges. They are designed to be deployed by IT administrators.\n  </Note>\n\n  See [Managed settings](/en/iam#managed-settings) and [Managed MCP configuration](/en/mcp#managed-mcp-configuration) for details.\n\n  <Note>\n    Managed deployments can also restrict **plugin marketplace additions** using\n    `strictKnownMarketplaces`. For more information, see [Managed marketplace restrictions](/en/plugin-marketplaces#managed-marketplace-restrictions).\n  </Note>\n* **Other configuration** is stored in `~/.claude.json`. This file contains your preferences (theme, notification settings, editor mode), OAuth session, [MCP server](/en/mcp) configurations for user and local scopes, per-project state (allowed tools, trust settings), and various caches. Project-scoped MCP servers are stored separately in `.mcp.json`.\n\n```JSON Example settings.json theme={null}\n{\n  \"permissions\": {\n    \"allow\": [\n      \"Bash(npm run lint)\",\n      \"Bash(npm run test:*)\",\n      \"Read(~/.zshrc)\"\n    ],\n    \"deny\": [\n      \"Bash(curl:*)\",\n      \"Read(./.env)\",\n      \"Read(./.env.*)\",\n      \"Read(./secrets/**)\"\n    ]\n  },\n  \"env\": {\n    \"CLAUDE_CODE_ENABLE_TELEMETRY\": \"1\",\n    \"OTEL_METRICS_EXPORTER\": \"otlp\"\n  },\n  \"companyAnnouncements\": [\n    \"Welcome to Acme Corp! Review our code guidelines at docs.acme.com\",\n    \"Reminder: Code reviews required for all PRs\",\n    \"New security policy in effect\"\n  ]\n}\n```\n\n### Available settings\n\n`settings.json` supports a number of options:\n\n| Key                          | Description                                                                                                                                                                                                                                                                     | Example                                                                 |\n| :--------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :---------------------------------------------------------------------- |\n| `apiKeyHelper`               | Custom script, to be executed in `/bin/sh`, to generate an auth value. This value will be sent as `X-Api-Key` and `Authorization: Bearer` headers for model requests                                                                                                            | `/bin/generate_temp_api_key.sh`                                         |\n| `cleanupPeriodDays`          | Sessions inactive for longer than this period are deleted at startup. Setting to `0` immediately deletes all sessions. (default: 30 days)                                                                                                                                       | `20`                                                                    |\n| `companyAnnouncements`       | Announcement to display to users at startup. If multiple announcements are provided, they will be cycled through at random.                                                                                                                                                     | `[\"Welcome to Acme Corp! Review our code guidelines at docs.acme.com\"]` |\n| `env`                        | Environment variables that will be applied to every session                                                                                                                                                                                                                     | `{\"FOO\": \"bar\"}`                                                        |\n| `attribution`                | Customize attribution for git commits and pull requests. See [Attribution settings](#attribution-settings)                                                                                                                                                                      | `{\"commit\": \"🤖 Generated with Claude Code\", \"pr\": \"\"}`                 |\n| `includeCoAuthoredBy`        | **Deprecated**: Use `attribution` instead. Whether to include the `co-authored-by Claude` byline in git commits and pull requests (default: `true`)                                                                                                                             | `false`                                                                 |\n| `permissions`                | See table below for structure of permissions.                                                                                                                                                                                                                                   |                                                                         |\n| `hooks`                      | Configure custom commands to run before or after tool executions. See [hooks documentation](/en/hooks)                                                                                                                                                                          | `{\"PreToolUse\": {\"Bash\": \"echo 'Running command...'\"}}`                 |\n| `disableAllHooks`            | Disable all [hooks](/en/hooks)                                                                                                                                                                                                                                                  | `true`                                                                  |\n| `allowManagedHooksOnly`      | (Managed settings only) Prevent loading of user, project, and plugin hooks. Only allows managed hooks and SDK hooks. See [Hook configuration](#hook-configuration)                                                                                                              | `true`                                                                  |\n| `model`                      | Override the default model to use for Claude Code                                                                                                                                                                                                                               | `\"claude-sonnet-4-5-20250929\"`                                          |\n| `otelHeadersHelper`          | Script to generate dynamic OpenTelemetry headers. Runs at startup and periodically (see [Dynamic headers](/en/monitoring-usage#dynamic-headers))                                                                                                                                | `/bin/generate_otel_headers.sh`                                         |\n| `statusLine`                 | Configure a custom status line to display context. See [`statusLine` documentation](/en/statusline)                                                                                                                                                                             | `{\"type\": \"command\", \"command\": \"~/.claude/statusline.sh\"}`             |\n| `fileSuggestion`             | Configure a custom script for `@` file autocomplete. See [File suggestion settings](#file-suggestion-settings)                                                                                                                                                                  | `{\"type\": \"command\", \"command\": \"~/.claude/file-suggestion.sh\"}`        |\n| `respectGitignore`           | Control whether the `@` file picker respects `.gitignore` patterns. When `true` (default), files matching `.gitignore` patterns are excluded from suggestions                                                                                                                   | `false`                                                                 |\n| `outputStyle`                | Configure an output style to adjust the system prompt. See [output styles documentation](/en/output-styles)                                                                                                                                                                     | `\"Explanatory\"`                                                         |\n| `forceLoginMethod`           | Use `claudeai` to restrict login to Claude.ai accounts, `console` to restrict login to Claude Console (API usage billing) accounts                                                                                                                                              | `claudeai`                                                              |\n| `forceLoginOrgUUID`          | Specify the UUID of an organization to automatically select it during login, bypassing the organization selection step. Requires `forceLoginMethod` to be set                                                                                                                   | `\"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\"`                                |\n| `enableAllProjectMcpServers` | Automatically approve all MCP servers defined in project `.mcp.json` files                                                                                                                                                                                                      | `true`                                                                  |\n| `enabledMcpjsonServers`      | List of specific MCP servers from `.mcp.json` files to approve                                                                                                                                                                                                                  | `[\"memory\", \"github\"]`                                                  |\n| `disabledMcpjsonServers`     | List of specific MCP servers from `.mcp.json` files to reject                                                                                                                                                                                                                   | `[\"filesystem\"]`                                                        |\n| `allowedMcpServers`          | When set in managed-settings.json, allowlist of MCP servers users can configure. Undefined = no restrictions, empty array = lockdown. Applies to all scopes. Denylist takes precedence. See [Managed MCP configuration](/en/mcp#managed-mcp-configuration)                      | `[{ \"serverName\": \"github\" }]`                                          |\n| `deniedMcpServers`           | When set in managed-settings.json, denylist of MCP servers that are explicitly blocked. Applies to all scopes including managed servers. Denylist takes precedence over allowlist. See [Managed MCP configuration](/en/mcp#managed-mcp-configuration)                           | `[{ \"serverName\": \"filesystem\" }]`                                      |\n| `strictKnownMarketplaces`    | When set in managed-settings.json, allowlist of plugin marketplaces users can add. Undefined = no restrictions, empty array = lockdown. Applies to marketplace additions only. See [Managed marketplace restrictions](/en/plugin-marketplaces#managed-marketplace-restrictions) | `[{ \"source\": \"github\", \"repo\": \"acme-corp/plugins\" }]`                 |\n| `awsAuthRefresh`             | Custom script that modifies the `.aws` directory (see [advanced credential configuration](/en/amazon-bedrock#advanced-credential-configuration))                                                                                                                                | `aws sso login --profile myprofile`                                     |\n| `awsCredentialExport`        | Custom script that outputs JSON with AWS credentials (see [advanced credential configuration](/en/amazon-bedrock#advanced-credential-configuration))                                                                                                                            | `/bin/generate_aws_grant.sh`                                            |\n| `alwaysThinkingEnabled`      | Enable [extended thinking](/en/common-workflows#use-extended-thinking) by default for all sessions. Typically configured via the `/config` command rather than editing directly                                                                                                 | `true`                                                                  |\n| `language`                   | Configure Claude's preferred response language (e.g., `\"japanese\"`, `\"spanish\"`, `\"french\"`). Claude will respond in this language by default                                                                                                                                   | `\"japanese\"`                                                            |\n\n### Permission settings\n\n| Keys                           | Description                                                                                                                                                                                                                                                                                 | Example                                                                |\n| :----------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :--------------------------------------------------------------------- |\n| `allow`                        | Array of [permission rules](/en/iam#configuring-permissions) to allow tool use. **Note:** Bash rules use prefix matching, not regex                                                                                                                                                         | `[ \"Bash(git diff:*)\" ]`                                               |\n| `ask`                          | Array of [permission rules](/en/iam#configuring-permissions) to ask for confirmation upon tool use.                                                                                                                                                                                         | `[ \"Bash(git push:*)\" ]`                                               |\n| `deny`                         | Array of [permission rules](/en/iam#configuring-permissions) to deny tool use. Use this to also exclude sensitive files from Claude Code access. **Note:** Bash patterns are prefix matches and can be bypassed (see [Bash permission limitations](/en/iam#tool-specific-permission-rules)) | `[ \"WebFetch\", \"Bash(curl:*)\", \"Read(./.env)\", \"Read(./secrets/**)\" ]` |\n| `additionalDirectories`        | Additional [working directories](/en/iam#working-directories) that Claude has access to                                                                                                                                                                                                     | `[ \"../docs/\" ]`                                                       |\n| `defaultMode`                  | Default [permission mode](/en/iam#permission-modes) when opening Claude Code                                                                                                                                                                                                                | `\"acceptEdits\"`                                                        |\n| `disableBypassPermissionsMode` | Set to `\"disable\"` to prevent `bypassPermissions` mode from being activated. This disables the `--dangerously-skip-permissions` command-line flag. See [managed settings](/en/iam#managed-settings)                                                                                         | `\"disable\"`                                                            |\n\n### Sandbox settings\n\nConfigure advanced sandboxing behavior. Sandboxing isolates bash commands from your filesystem and network. See [Sandboxing](/en/sandboxing) for details.\n\n**Filesystem and network restrictions** are configured via Read, Edit, and WebFetch permission rules, not via these sandbox settings.\n\n| Keys                        | Description                                                                                                                                                                                                                                                                                                                       | Example                   |\n| :-------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------ |\n| `enabled`                   | Enable bash sandboxing (macOS/Linux only). Default: false                                                                                                                                                                                                                                                                         | `true`                    |\n| `autoAllowBashIfSandboxed`  | Auto-approve bash commands when sandboxed. Default: true                                                                                                                                                                                                                                                                          | `true`                    |\n| `excludedCommands`          | Commands that should run outside of the sandbox                                                                                                                                                                                                                                                                                   | `[\"git\", \"docker\"]`       |\n| `allowUnsandboxedCommands`  | Allow commands to run outside the sandbox via the `dangerouslyDisableSandbox` parameter. When set to `false`, the `dangerouslyDisableSandbox` escape hatch is completely disabled and all commands must run sandboxed (or be in `excludedCommands`). Useful for enterprise policies that require strict sandboxing. Default: true | `false`                   |\n| `network.allowUnixSockets`  | Unix socket paths accessible in sandbox (for SSH agents, etc.)                                                                                                                                                                                                                                                                    | `[\"~/.ssh/agent-socket\"]` |\n| `network.allowLocalBinding` | Allow binding to localhost ports (macOS only). Default: false                                                                                                                                                                                                                                                                     | `true`                    |\n| `network.httpProxyPort`     | HTTP proxy port used if you wish to bring your own proxy. If not specified, Claude will run its own proxy.                                                                                                                                                                                                                        | `8080`                    |\n| `network.socksProxyPort`    | SOCKS5 proxy port used if you wish to bring your own proxy. If not specified, Claude will run its own proxy.                                                                                                                                                                                                                      | `8081`                    |\n| `enableWeakerNestedSandbox` | Enable weaker sandbox for unprivileged Docker environments (Linux only). **Reduces security.** Default: false                                                                                                                                                                                                                     | `true`                    |\n\n**Configuration example:**\n\n```json  theme={null}\n{\n  \"sandbox\": {\n    \"enabled\": true,\n    \"autoAllowBashIfSandboxed\": true,\n    \"excludedCommands\": [\"docker\"],\n    \"network\": {\n      \"allowUnixSockets\": [\n        \"/var/run/docker.sock\"\n      ],\n      \"allowLocalBinding\": true\n    }\n  },\n  \"permissions\": {\n    \"deny\": [\n      \"Read(.envrc)\",\n      \"Read(~/.aws/**)\"\n    ]\n  }\n}\n```\n\n**Filesystem and network restrictions** use standard permission rules:\n\n* Use `Read` deny rules to block Claude from reading specific files or directories\n* Use `Edit` allow rules to let Claude write to directories beyond the current working directory\n* Use `Edit` deny rules to block writes to specific paths\n* Use `WebFetch` allow/deny rules to control which network domains Claude can access\n\n### Attribution settings\n\nClaude Code adds attribution to git commits and pull requests. These are configured separately:\n\n* Commits use [git trailers](https://git-scm.com/docs/git-interpret-trailers) (like `Co-Authored-By`) by default,  which can be customized or disabled\n* Pull request descriptions are plain text\n\n| Keys     | Description                                                                                |\n| :------- | :----------------------------------------------------------------------------------------- |\n| `commit` | Attribution for git commits, including any trailers. Empty string hides commit attribution |\n| `pr`     | Attribution for pull request descriptions. Empty string hides pull request attribution     |\n\n**Default commit attribution:**\n\n```\n🤖 Generated with [Claude Code](https://claude.com/claude-code)\n\n   Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>\n```\n\n**Default pull request attribution:**\n\n```\n🤖 Generated with [Claude Code](https://claude.com/claude-code)\n```\n\n**Example:**\n\n```json  theme={null}\n{\n  \"attribution\": {\n    \"commit\": \"Generated with AI\\n\\nCo-Authored-By: AI <ai@example.com>\",\n    \"pr\": \"\"\n  }\n}\n```\n\n<Note>\n  The `attribution` setting takes precedence over the deprecated `includeCoAuthoredBy` setting. To hide all attribution, set `commit` and `pr` to empty strings.\n</Note>\n\n### File suggestion settings\n\nConfigure a custom command for `@` file path autocomplete. The built-in file suggestion uses fast filesystem traversal, but large monorepos may benefit from project-specific indexing such as a pre-built file index or custom tooling.\n\n```json  theme={null}\n{\n  \"fileSuggestion\": {\n    \"type\": \"command\",\n    \"command\": \"~/.claude/file-suggestion.sh\"\n  }\n}\n```\n\nThe command runs with the same environment variables as [hooks](/en/hooks), including `CLAUDE_PROJECT_DIR`. It receives JSON via stdin with a `query` field:\n\n```json  theme={null}\n{\"query\": \"src/comp\"}\n```\n\nOutput newline-separated file paths to stdout (currently limited to 15):\n\n```\nsrc/components/Button.tsx\nsrc/components/Modal.tsx\nsrc/components/Form.tsx\n```\n\n**Example:**\n\n```bash  theme={null}\n#!/bin/bash\nquery=$(cat | jq -r '.query')\nyour-repo-file-index --query \"$query\" | head -20\n```\n\n### Hook configuration\n\n**Managed settings only**: Controls which hooks are allowed to run. This setting can only be configured in [managed settings](#settings-files) and provides administrators with strict control over hook execution.\n\n**Behavior when `allowManagedHooksOnly` is `true`:**\n\n* Managed hooks and SDK hooks are loaded\n* User hooks, project hooks, and plugin hooks are blocked\n\n**Configuration:**\n\n```json  theme={null}\n{\n  \"allowManagedHooksOnly\": true\n}\n```\n\n### Settings precedence\n\nSettings apply in order of precedence. From highest to lowest:\n\n1. **Managed settings** (`managed-settings.json`)\n   * Policies deployed by IT/DevOps to system directories\n   * Cannot be overridden by user or project settings\n\n2. **Command line arguments**\n   * Temporary overrides for a specific session\n\n3. **Local project settings** (`.claude/settings.local.json`)\n   * Personal project-specific settings\n\n4. **Shared project settings** (`.claude/settings.json`)\n   * Team-shared project settings in source control\n\n5. **User settings** (`~/.claude/settings.json`)\n   * Personal global settings\n\nThis hierarchy ensures that organizational policies are always enforced while still allowing teams and individuals to customize their experience.\n\nFor example, if your user settings allow `Bash(npm run:*)` but a project's shared settings deny it, the project setting takes precedence and the command is blocked.\n\n### Key points about the configuration system\n\n* **Memory files (`CLAUDE.md`)**: Contain instructions and context that Claude loads at startup\n* **Settings files (JSON)**: Configure permissions, environment variables, and tool behavior\n* **Slash commands**: Custom commands that can be invoked during a session with `/command-name`\n* **MCP servers**: Extend Claude Code with additional tools and integrations\n* **Precedence**: Higher-level configurations (Managed) override lower-level ones (User/Project)\n* **Inheritance**: Settings are merged, with more specific settings adding to or overriding broader ones\n\n### System prompt\n\nClaude Code's internal system prompt is not published. To add custom instructions, use `CLAUDE.md` files or the `--append-system-prompt` flag.\n\n### Excluding sensitive files\n\nTo prevent Claude Code from accessing files containing sensitive information like API keys, secrets, and environment files, use the `permissions.deny` setting in your `.claude/settings.json` file:\n\n```json  theme={null}\n{\n  \"permissions\": {\n    \"deny\": [\n      \"Read(./.env)\",\n      \"Read(./.env.*)\",\n      \"Read(./secrets/**)\",\n      \"Read(./config/credentials.json)\",\n      \"Read(./build)\"\n    ]\n  }\n}\n```\n\nThis replaces the deprecated `ignorePatterns` configuration. Files matching these patterns will be completely invisible to Claude Code, preventing any accidental exposure of sensitive data.\n\n## Subagent configuration\n\nClaude Code supports custom AI subagents that can be configured at both user and project levels. These subagents are stored as Markdown files with YAML frontmatter:\n\n* **User subagents**: `~/.claude/agents/` - Available across all your projects\n* **Project subagents**: `.claude/agents/` - Specific to your project and can be shared with your team\n\nSubagent files define specialized AI assistants with custom prompts and tool permissions. Learn more about creating and using subagents in the [subagents documentation](/en/sub-agents).\n\n## Plugin configuration\n\nClaude Code supports a plugin system that lets you extend functionality with custom commands, agents, hooks, and MCP servers. Plugins are distributed through marketplaces and can be configured at both user and repository levels.\n\n### Plugin settings\n\nPlugin-related settings in `settings.json`:\n\n```json  theme={null}\n{\n  \"enabledPlugins\": {\n    \"formatter@acme-tools\": true,\n    \"deployer@acme-tools\": true,\n    \"analyzer@security-plugins\": false\n  },\n  \"extraKnownMarketplaces\": {\n    \"acme-tools\": {\n      \"source\": \"github\",\n      \"repo\": \"acme-corp/claude-plugins\"\n    }\n  }\n}\n```\n\n#### `enabledPlugins`\n\nControls which plugins are enabled. Format: `\"plugin-name@marketplace-name\": true/false`\n\n**Scopes**:\n\n* **User settings** (`~/.claude/settings.json`): Personal plugin preferences\n* **Project settings** (`.claude/settings.json`): Project-specific plugins shared with team\n* **Local settings** (`.claude/settings.local.json`): Per-machine overrides (not committed)\n\n**Example**:\n\n```json  theme={null}\n{\n  \"enabledPlugins\": {\n    \"code-formatter@team-tools\": true,\n    \"deployment-tools@team-tools\": true,\n    \"experimental-features@personal\": false\n  }\n}\n```\n\n#### `extraKnownMarketplaces`\n\nDefines additional marketplaces that should be made available for the repository. Typically used in repository-level settings to ensure team members have access to required plugin sources.\n\n**When a repository includes `extraKnownMarketplaces`**:\n\n1. Team members are prompted to install the marketplace when they trust the folder\n2. Team members are then prompted to install plugins from that marketplace\n3. Users can skip unwanted marketplaces or plugins (stored in user settings)\n4. Installation respects trust boundaries and requires explicit consent\n\n**Example**:\n\n```json  theme={null}\n{\n  \"extraKnownMarketplaces\": {\n    \"acme-tools\": {\n      \"source\": {\n        \"source\": \"github\",\n        \"repo\": \"acme-corp/claude-plugins\"\n      }\n    },\n    \"security-plugins\": {\n      \"source\": {\n        \"source\": \"git\",\n        \"url\": \"https://git.example.com/security/plugins.git\"\n      }\n    }\n  }\n}\n```\n\n**Marketplace source types**:\n\n* `github`: GitHub repository (uses `repo`)\n* `git`: Any git URL (uses `url`)\n* `directory`: Local filesystem path (uses `path`, for development only)\n\n#### `strictKnownMarketplaces`\n\n**Managed settings only**: Controls which plugin marketplaces users are allowed to add. This setting can only be configured in [`managed-settings.json`](/en/iam#managed-settings) and provides administrators with strict control over marketplace sources.\n\n**Managed settings file locations**:\n\n* **macOS**: `/Library/Application Support/ClaudeCode/managed-settings.json`\n* **Linux and WSL**: `/etc/claude-code/managed-settings.json`\n* **Windows**: `C:\\Program Files\\ClaudeCode\\managed-settings.json`\n\n**Key characteristics**:\n\n* Only available in managed settings (`managed-settings.json`)\n* Cannot be overridden by user or project settings (highest precedence)\n* Enforced BEFORE network/filesystem operations (blocked sources never execute)\n* Uses exact matching for source specifications (including `ref`, `path` for git sources)\n\n**Allowlist behavior**:\n\n* `undefined` (default): No restrictions - users can add any marketplace\n* Empty array `[]`: Complete lockdown - users cannot add any new marketplaces\n* List of sources: Users can only add marketplaces that match exactly\n\n**All supported source types**:\n\nThe allowlist supports six marketplace source types. Each source must match exactly for a user's marketplace addition to be allowed.\n\n1. **GitHub repositories**:\n\n```json  theme={null}\n{ \"source\": \"github\", \"repo\": \"acme-corp/approved-plugins\" }\n{ \"source\": \"github\", \"repo\": \"acme-corp/security-tools\", \"ref\": \"v2.0\" }\n{ \"source\": \"github\", \"repo\": \"acme-corp/plugins\", \"ref\": \"main\", \"path\": \"marketplace\" }\n```\n\nFields: `repo` (required), `ref` (optional: branch/tag/SHA), `path` (optional: subdirectory)\n\n2. **Git repositories**:\n\n```json  theme={null}\n{ \"source\": \"git\", \"url\": \"https://gitlab.example.com/tools/plugins.git\" }\n{ \"source\": \"git\", \"url\": \"https://bitbucket.org/acme-corp/plugins.git\", \"ref\": \"production\" }\n{ \"source\": \"git\", \"url\": \"ssh://git@git.example.com/plugins.git\", \"ref\": \"v3.1\", \"path\": \"approved\" }\n```\n\nFields: `url` (required), `ref` (optional: branch/tag/SHA), `path` (optional: subdirectory)\n\n3. **URL-based marketplaces**:\n\n```json  theme={null}\n{ \"source\": \"url\", \"url\": \"https://plugins.example.com/marketplace.json\" }\n{ \"source\": \"url\", \"url\": \"https://cdn.example.com/marketplace.json\", \"headers\": { \"Authorization\": \"Bearer ${TOKEN}\" } }\n```\n\nFields: `url` (required), `headers` (optional: HTTP headers for authenticated access)\n\n4. **NPM packages**:\n\n```json  theme={null}\n{ \"source\": \"npm\", \"package\": \"@acme-corp/claude-plugins\" }\n{ \"source\": \"npm\", \"package\": \"@acme-corp/approved-marketplace\" }\n```\n\nFields: `package` (required, supports scoped packages)\n\n5. **File paths**:\n\n```json  theme={null}\n{ \"source\": \"file\", \"path\": \"/usr/local/share/claude/acme-marketplace.json\" }\n{ \"source\": \"file\", \"path\": \"/opt/acme-corp/plugins/marketplace.json\" }\n```\n\nFields: `path` (required: absolute path to marketplace.json file)\n\n6. **Directory paths**:\n\n```json  theme={null}\n{ \"source\": \"directory\", \"path\": \"/usr/local/share/claude/acme-plugins\" }\n{ \"source\": \"directory\", \"path\": \"/opt/acme-corp/approved-marketplaces\" }\n```\n\nFields: `path` (required: absolute path to directory containing `.claude-plugin/marketplace.json`)\n\n**Configuration examples**:\n\nExample - Allow specific marketplaces only:\n\n```json  theme={null}\n{\n  \"strictKnownMarketplaces\": [\n    {\n      \"source\": \"github\",\n      \"repo\": \"acme-corp/approved-plugins\"\n    },\n    {\n      \"source\": \"github\",\n      \"repo\": \"acme-corp/security-tools\",\n      \"ref\": \"v2.0\"\n    },\n    {\n      \"source\": \"url\",\n      \"url\": \"https://plugins.example.com/marketplace.json\"\n    },\n    {\n      \"source\": \"npm\",\n      \"package\": \"@acme-corp/compliance-plugins\"\n    }\n  ]\n}\n```\n\nExample - Disable all marketplace additions:\n\n```json  theme={null}\n{\n  \"strictKnownMarketplaces\": []\n}\n```\n\n**Exact matching requirements**:\n\nMarketplace sources must match **exactly** for a user's addition to be allowed. For git-based sources (`github` and `git`), this includes all optional fields:\n\n* The `repo` or `url` must match exactly\n* The `ref` field must match exactly (or both be undefined)\n* The `path` field must match exactly (or both be undefined)\n\nExamples of sources that **do NOT match**:\n\n```json  theme={null}\n// These are DIFFERENT sources:\n{ \"source\": \"github\", \"repo\": \"acme-corp/plugins\" }\n{ \"source\": \"github\", \"repo\": \"acme-corp/plugins\", \"ref\": \"main\" }\n\n// These are also DIFFERENT:\n{ \"source\": \"github\", \"repo\": \"acme-corp/plugins\", \"path\": \"marketplace\" }\n{ \"source\": \"github\", \"repo\": \"acme-corp/plugins\" }\n```\n\n**Comparison with `extraKnownMarketplaces`**:\n\n| Aspect                | `strictKnownMarketplaces`            | `extraKnownMarketplaces`             |\n| --------------------- | ------------------------------------ | ------------------------------------ |\n| **Purpose**           | Organizational policy enforcement    | Team convenience                     |\n| **Settings file**     | `managed-settings.json` only         | Any settings file                    |\n| **Behavior**          | Blocks non-allowlisted additions     | Auto-installs missing marketplaces   |\n| **When enforced**     | Before network/filesystem operations | After user trust prompt              |\n| **Can be overridden** | No (highest precedence)              | Yes (by higher precedence settings)  |\n| **Source format**     | Direct source object                 | Named marketplace with nested source |\n| **Use case**          | Compliance, security restrictions    | Onboarding, standardization          |\n\n**Format difference**:\n\n`strictKnownMarketplaces` uses direct source objects:\n\n```json  theme={null}\n{\n  \"strictKnownMarketplaces\": [\n    { \"source\": \"github\", \"repo\": \"acme-corp/plugins\" }\n  ]\n}\n```\n\n`extraKnownMarketplaces` requires named marketplaces:\n\n```json  theme={null}\n{\n  \"extraKnownMarketplaces\": {\n    \"acme-tools\": {\n      \"source\": { \"source\": \"github\", \"repo\": \"acme-corp/plugins\" }\n    }\n  }\n}\n```\n\n**Important notes**:\n\n* Restrictions are checked BEFORE any network requests or filesystem operations\n* When blocked, users see clear error messages indicating the source is blocked by managed policy\n* The restriction applies only to adding NEW marketplaces; previously installed marketplaces remain accessible\n* Managed settings have the highest precedence and cannot be overridden\n\nSee [Managed marketplace restrictions](/en/plugin-marketplaces#managed-marketplace-restrictions) for user-facing documentation.\n\n### Managing plugins\n\nUse the `/plugin` command to manage plugins interactively:\n\n* Browse available plugins from marketplaces\n* Install/uninstall plugins\n* Enable/disable plugins\n* View plugin details (commands, agents, hooks provided)\n* Add/remove marketplaces\n\nLearn more about the plugin system in the [plugins documentation](/en/plugins).\n\n## Environment variables\n\nClaude Code supports the following environment variables to control its behavior:\n\n<Note>\n  All environment variables can also be configured in [`settings.json`](#available-settings). This is useful as a way to automatically set environment variables for each session, or to roll out a set of environment variables for your whole team or organization.\n</Note>\n\n| Variable                                      | Purpose                                                                                                                                                                                                                                                                                                                                                                                      |\n| :-------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| `ANTHROPIC_API_KEY`                           | API key sent as `X-Api-Key` header, typically for the Claude SDK (for interactive usage, run `/login`)                                                                                                                                                                                                                                                                                       |\n| `ANTHROPIC_AUTH_TOKEN`                        | Custom value for the `Authorization` header (the value you set here will be prefixed with `Bearer `)                                                                                                                                                                                                                                                                                         |\n| `ANTHROPIC_CUSTOM_HEADERS`                    | Custom headers you want to add to the request (in `Name: Value` format)                                                                                                                                                                                                                                                                                                                      |\n| `ANTHROPIC_DEFAULT_HAIKU_MODEL`               | See [Model configuration](/en/model-config#environment-variables)                                                                                                                                                                                                                                                                                                                            |\n| `ANTHROPIC_DEFAULT_OPUS_MODEL`                | See [Model configuration](/en/model-config#environment-variables)                                                                                                                                                                                                                                                                                                                            |\n| `ANTHROPIC_DEFAULT_SONNET_MODEL`              | See [Model configuration](/en/model-config#environment-variables)                                                                                                                                                                                                                                                                                                                            |\n| `ANTHROPIC_FOUNDRY_API_KEY`                   | API key for Microsoft Foundry authentication (see [Microsoft Foundry](/en/microsoft-foundry))                                                                                                                                                                                                                                                                                                |\n| `ANTHROPIC_MODEL`                             | Name of the model setting to use (see [Model Configuration](/en/model-config#environment-variables))                                                                                                                                                                                                                                                                                         |\n| `ANTHROPIC_SMALL_FAST_MODEL`                  | \\[DEPRECATED] Name of [Haiku-class model for background tasks](/en/costs)                                                                                                                                                                                                                                                                                                                    |\n| `ANTHROPIC_SMALL_FAST_MODEL_AWS_REGION`       | Override AWS region for the Haiku-class model when using Bedrock                                                                                                                                                                                                                                                                                                                             |\n| `AWS_BEARER_TOKEN_BEDROCK`                    | Bedrock API key for authentication (see [Bedrock API keys](https://aws.amazon.com/blogs/machine-learning/accelerate-ai-development-with-amazon-bedrock-api-keys/))                                                                                                                                                                                                                           |\n| `BASH_DEFAULT_TIMEOUT_MS`                     | Default timeout for long-running bash commands                                                                                                                                                                                                                                                                                                                                               |\n| `BASH_MAX_OUTPUT_LENGTH`                      | Maximum number of characters in bash outputs before they are middle-truncated                                                                                                                                                                                                                                                                                                                |\n| `BASH_MAX_TIMEOUT_MS`                         | Maximum timeout the model can set for long-running bash commands                                                                                                                                                                                                                                                                                                                             |\n| `CLAUDE_BASH_MAINTAIN_PROJECT_WORKING_DIR`    | Return to the original working directory after each Bash command                                                                                                                                                                                                                                                                                                                             |\n| `CLAUDE_CODE_API_KEY_HELPER_TTL_MS`           | Interval in milliseconds at which credentials should be refreshed (when using `apiKeyHelper`)                                                                                                                                                                                                                                                                                                |\n| `CLAUDE_CODE_CLIENT_CERT`                     | Path to client certificate file for mTLS authentication                                                                                                                                                                                                                                                                                                                                      |\n| `CLAUDE_CODE_CLIENT_KEY_PASSPHRASE`           | Passphrase for encrypted CLAUDE\\_CODE\\_CLIENT\\_KEY (optional)                                                                                                                                                                                                                                                                                                                                |\n| `CLAUDE_CODE_CLIENT_KEY`                      | Path to client private key file for mTLS authentication                                                                                                                                                                                                                                                                                                                                      |\n| `CLAUDE_CODE_DISABLE_EXPERIMENTAL_BETAS`      | Set to `1` to disable Anthropic API-specific `anthropic-beta` headers. Use this if experiencing issues like \"Unexpected value(s) for the `anthropic-beta` header\" when using an LLM gateway with third-party providers                                                                                                                                                                       |\n| `CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC`    | Equivalent of setting `DISABLE_AUTOUPDATER`, `DISABLE_BUG_COMMAND`, `DISABLE_ERROR_REPORTING`, and `DISABLE_TELEMETRY`                                                                                                                                                                                                                                                                       |\n| `CLAUDE_CODE_DISABLE_TERMINAL_TITLE`          | Set to `1` to disable automatic terminal title updates based on conversation context                                                                                                                                                                                                                                                                                                         |\n| `CLAUDE_CODE_FILE_READ_MAX_OUTPUT_TOKENS`     | Override the default token limit for file reads. Useful when you need to read larger files in full                                                                                                                                                                                                                                                                                           |\n| `CLAUDE_CODE_HIDE_ACCOUNT_INFO`               | Set to `1` to hide your email address and organization name from the Claude Code UI. Useful when streaming or recording                                                                                                                                                                                                                                                                      |\n| `CLAUDE_CODE_IDE_SKIP_AUTO_INSTALL`           | Skip auto-installation of IDE extensions                                                                                                                                                                                                                                                                                                                                                     |\n| `CLAUDE_CODE_MAX_OUTPUT_TOKENS`               | Set the maximum number of output tokens for most requests                                                                                                                                                                                                                                                                                                                                    |\n| `CLAUDE_CODE_OTEL_HEADERS_HELPER_DEBOUNCE_MS` | Interval for refreshing dynamic OpenTelemetry headers in milliseconds (default: 1740000 / 29 minutes). See [Dynamic headers](/en/monitoring-usage#dynamic-headers)                                                                                                                                                                                                                           |\n| `CLAUDE_CODE_SHELL`                           | Override automatic shell detection. Useful when your login shell differs from your preferred working shell (for example, `bash` vs `zsh`)                                                                                                                                                                                                                                                    |\n| `CLAUDE_CODE_SHELL_PREFIX`                    | Command prefix to wrap all bash commands (for example, for logging or auditing). Example: `/path/to/logger.sh` will execute `/path/to/logger.sh <command>`                                                                                                                                                                                                                                   |\n| `CLAUDE_CODE_SKIP_BEDROCK_AUTH`               | Skip AWS authentication for Bedrock (for example, when using an LLM gateway)                                                                                                                                                                                                                                                                                                                 |\n| `CLAUDE_CODE_SKIP_FOUNDRY_AUTH`               | Skip Azure authentication for Microsoft Foundry (for example, when using an LLM gateway)                                                                                                                                                                                                                                                                                                     |\n| `CLAUDE_CODE_SKIP_VERTEX_AUTH`                | Skip Google authentication for Vertex (for example, when using an LLM gateway)                                                                                                                                                                                                                                                                                                               |\n| `CLAUDE_CODE_SUBAGENT_MODEL`                  | See [Model configuration](/en/model-config)                                                                                                                                                                                                                                                                                                                                                  |\n| `CLAUDE_CODE_USE_BEDROCK`                     | Use [Bedrock](/en/amazon-bedrock)                                                                                                                                                                                                                                                                                                                                                            |\n| `CLAUDE_CODE_USE_FOUNDRY`                     | Use [Microsoft Foundry](/en/microsoft-foundry)                                                                                                                                                                                                                                                                                                                                               |\n| `CLAUDE_CODE_USE_VERTEX`                      | Use [Vertex](/en/google-vertex-ai)                                                                                                                                                                                                                                                                                                                                                           |\n| `CLAUDE_CONFIG_DIR`                           | Customize where Claude Code stores its configuration and data files                                                                                                                                                                                                                                                                                                                          |\n| `DISABLE_AUTOUPDATER`                         | Set to `1` to disable automatic updates.                                                                                                                                                                                                                                                                                                                                                     |\n| `DISABLE_BUG_COMMAND`                         | Set to `1` to disable the `/bug` command                                                                                                                                                                                                                                                                                                                                                     |\n| `DISABLE_COST_WARNINGS`                       | Set to `1` to disable cost warning messages                                                                                                                                                                                                                                                                                                                                                  |\n| `DISABLE_ERROR_REPORTING`                     | Set to `1` to opt out of Sentry error reporting                                                                                                                                                                                                                                                                                                                                              |\n| `DISABLE_NON_ESSENTIAL_MODEL_CALLS`           | Set to `1` to disable model calls for non-critical paths like flavor text                                                                                                                                                                                                                                                                                                                    |\n| `DISABLE_PROMPT_CACHING`                      | Set to `1` to disable prompt caching for all models (takes precedence over per-model settings)                                                                                                                                                                                                                                                                                               |\n| `DISABLE_PROMPT_CACHING_HAIKU`                | Set to `1` to disable prompt caching for Haiku models                                                                                                                                                                                                                                                                                                                                        |\n| `DISABLE_PROMPT_CACHING_OPUS`                 | Set to `1` to disable prompt caching for Opus models                                                                                                                                                                                                                                                                                                                                         |\n| `DISABLE_PROMPT_CACHING_SONNET`               | Set to `1` to disable prompt caching for Sonnet models                                                                                                                                                                                                                                                                                                                                       |\n| `DISABLE_TELEMETRY`                           | Set to `1` to opt out of Statsig telemetry (note that Statsig events do not include user data like code, file paths, or bash commands)                                                                                                                                                                                                                                                       |\n| `HTTP_PROXY`                                  | Specify HTTP proxy server for network connections                                                                                                                                                                                                                                                                                                                                            |\n| `HTTPS_PROXY`                                 | Specify HTTPS proxy server for network connections                                                                                                                                                                                                                                                                                                                                           |\n| `MAX_MCP_OUTPUT_TOKENS`                       | Maximum number of tokens allowed in MCP tool responses. Claude Code displays a warning when output exceeds 10,000 tokens (default: 25000)                                                                                                                                                                                                                                                    |\n| `MAX_THINKING_TOKENS`                         | Enable [extended thinking](https://docs.claude.com/en/docs/build-with-claude/extended-thinking) and set the token budget for the thinking process. Extended thinking improves performance on complex reasoning and coding tasks but impacts [prompt caching efficiency](https://docs.claude.com/en/docs/build-with-claude/prompt-caching#caching-with-thinking-blocks). Disabled by default. |\n| `MCP_TIMEOUT`                                 | Timeout in milliseconds for MCP server startup                                                                                                                                                                                                                                                                                                                                               |\n| `MCP_TOOL_TIMEOUT`                            | Timeout in milliseconds for MCP tool execution                                                                                                                                                                                                                                                                                                                                               |\n| `NO_PROXY`                                    | List of domains and IPs to which requests will be directly issued, bypassing proxy                                                                                                                                                                                                                                                                                                           |\n| `SLASH_COMMAND_TOOL_CHAR_BUDGET`              | Maximum number of characters for slash command metadata shown to the [Skill tool](/en/slash-commands#skill-tool) (default: 15000)                                                                                                                                                                                                                                                            |\n| `USE_BUILTIN_RIPGREP`                         | Set to `0` to use system-installed `rg` instead of `rg` included with Claude Code                                                                                                                                                                                                                                                                                                            |\n| `VERTEX_REGION_CLAUDE_3_5_HAIKU`              | Override region for Claude 3.5 Haiku when using Vertex AI                                                                                                                                                                                                                                                                                                                                    |\n| `VERTEX_REGION_CLAUDE_3_7_SONNET`             | Override region for Claude 3.7 Sonnet when using Vertex AI                                                                                                                                                                                                                                                                                                                                   |\n| `VERTEX_REGION_CLAUDE_4_0_OPUS`               | Override region for Claude 4.0 Opus when using Vertex AI                                                                                                                                                                                                                                                                                                                                     |\n| `VERTEX_REGION_CLAUDE_4_0_SONNET`             | Override region for Claude 4.0 Sonnet when using Vertex AI                                                                                                                                                                                                                                                                                                                                   |\n| `VERTEX_REGION_CLAUDE_4_1_OPUS`               | Override region for Claude 4.1 Opus when using Vertex AI                                                                                                                                                                                                                                                                                                                                     |\n\n## Tools available to Claude\n\nClaude Code has access to a set of powerful tools that help it understand and modify your codebase:\n\n| Tool                | Description                                                                                       | Permission Required |\n| :------------------ | :------------------------------------------------------------------------------------------------ | :------------------ |\n| **AskUserQuestion** | Asks the user multiple choice questions to gather information or clarify ambiguity                | No                  |\n| **Bash**            | Executes shell commands in your environment (see [Bash tool behavior](#bash-tool-behavior) below) | Yes                 |\n| **BashOutput**      | Retrieves output from a background bash shell                                                     | No                  |\n| **Edit**            | Makes targeted edits to specific files                                                            | Yes                 |\n| **ExitPlanMode**    | Prompts the user to exit plan mode and start coding                                               | Yes                 |\n| **Glob**            | Finds files based on pattern matching                                                             | No                  |\n| **Grep**            | Searches for patterns in file contents                                                            | No                  |\n| **KillShell**       | Kills a running background bash shell by its ID                                                   | No                  |\n| **NotebookEdit**    | Modifies Jupyter notebook cells                                                                   | Yes                 |\n| **Read**            | Reads the contents of files                                                                       | No                  |\n| **Skill**           | Executes a [skill or slash command](/en/slash-commands#skill-tool) within the main conversation   | Yes                 |\n| **Task**            | Runs a sub-agent to handle complex, multi-step tasks                                              | No                  |\n| **TodoWrite**       | Creates and manages structured task lists                                                         | No                  |\n| **WebFetch**        | Fetches content from a specified URL                                                              | Yes                 |\n| **WebSearch**       | Performs web searches with domain filtering                                                       | Yes                 |\n| **Write**           | Creates or overwrites files                                                                       | Yes                 |\n\nPermission rules can be configured using `/allowed-tools` or in [permission settings](/en/settings#available-settings). Also see [Tool-specific permission rules](/en/iam#tool-specific-permission-rules).\n\n### Bash tool behavior\n\nThe Bash tool executes shell commands with the following persistence behavior:\n\n* **Working directory persists**: When Claude changes the working directory (for example, `cd /path/to/dir`), subsequent Bash commands will execute in that directory. You can use `CLAUDE_BASH_MAINTAIN_PROJECT_WORKING_DIR=1` to reset to the project directory after each command.\n* **Environment variables do NOT persist**: Environment variables set in one Bash command (for example, `export MY_VAR=value`) are **not** available in subsequent Bash commands. Each Bash command runs in a fresh shell environment.\n\nTo make environment variables available in Bash commands, you have **three options**:\n\n**Option 1: Activate environment before starting Claude Code** (simplest approach)\n\nActivate your virtual environment in your terminal before launching Claude Code:\n\n```bash  theme={null}\nconda activate myenv\n# or: source /path/to/venv/bin/activate\nclaude\n```\n\nThis works for shell environments but environment variables set within Claude's Bash commands will not persist between commands.\n\n**Option 2: Set CLAUDE\\_ENV\\_FILE before starting Claude Code** (persistent environment setup)\n\nExport the path to a shell script containing your environment setup:\n\n```bash  theme={null}\nexport CLAUDE_ENV_FILE=/path/to/env-setup.sh\nclaude\n```\n\nWhere `/path/to/env-setup.sh` contains:\n\n```bash  theme={null}\nconda activate myenv\n# or: source /path/to/venv/bin/activate\n# or: export MY_VAR=value\n```\n\nClaude Code will source this file before each Bash command, making the environment persistent across all commands.\n\n**Option 3: Use a SessionStart hook** (project-specific configuration)\n\nConfigure in `.claude/settings.json`:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"SessionStart\": [{\n      \"matcher\": \"startup\",\n      \"hooks\": [{\n        \"type\": \"command\",\n        \"command\": \"echo 'conda activate myenv' >> \\\"$CLAUDE_ENV_FILE\\\"\"\n      }]\n    }]\n  }\n}\n```\n\nThe hook writes to `$CLAUDE_ENV_FILE`, which is then sourced before each Bash command. This is ideal for team-shared project configurations.\n\nSee [SessionStart hooks](/en/hooks#persisting-environment-variables) for more details on Option 3.\n\n### Extending tools with hooks\n\nYou can run custom commands before or after any tool executes using\n[Claude Code hooks](/en/hooks-guide).\n\nFor example, you could automatically run a Python formatter after Claude\nmodifies Python files, or prevent modifications to production configuration\nfiles by blocking Write operations to certain paths.\n\n## See also\n\n* [Identity and Access Management](/en/iam#configuring-permissions) - Learn about Claude Code's permission system\n* [IAM and access control](/en/iam#managed-settings) - Managed policy configuration\n* [Troubleshooting](/en/troubleshooting#auto-updater-issues) - Solutions for common configuration issues\n\n\n---\n\n> To find navigation and other pages in this documentation, fetch the llms.txt file at: https://code.claude.com/docs/llms.txt"}]},"isSidechain":true,"agentId":"aa534fe","sourceToolAssistantUUID":"1e9bd649-4cc4-4bcc-8895-59cdaae38f1a"}
{"type":"assistant","uuid":"9108af75-803d-4671-96df-f0c8a0372e9a","parentUuid":"77ec46b6-bb2b-4b5c-a996-22013e81bced","timestamp":"2026-01-08T20:30:39.204Z","sessionId":"56f508cc-8978-4a5c-8518-37f364691c8e","message":{"role":"assistant","content":[{"type":"text","text":"Perfect! Now I have all the information I need. Let me provide a comprehensive answer based on the official documentation.\n\n## Tool Access Restrictions: Complete Guide\n\nBased on the Claude Code and Agent SDK documentation, here's how to restrict an agent's tool access:\n\n### 1. Limiting Bash to Specific Commands\n\nYou can restrict Bash using **prefix matching** in permission rules. The syntax uses `Bash(pattern:*)` where the pattern is matched from the start of the command:\n\n```json\n{\n  \"permissions\": {\n    \"allow\": [\n      \"Bash(bun $CLAUDE_PLUGIN_ROOT/cli.js:*)\"\n    ],\n    \"deny\": [\n      \"Bash(find:*)\",\n      \"Bash(curl:*)\"\n    ]\n  }\n}\n```\n\n**Important**: Bash patterns use **prefix matching**, not regex. So `Bash(bun:*)` allows any command starting with `bun`. The wildcard `*` at the end is required for matching variations.\n\n### 2. Restricting Read/Glob to Specific Directories\n\nThe Claude Code settings support directory-level restrictions for Read, Edit, and Write tools:\n\n```json\n{\n  \"permissions\": {\n    \"deny\": [\n      \"Read(.env)\",\n      \"Read(.env.*)\",\n      \"Read(./secrets/**)\",\n      \"Glob(./node_modules/**)\"\n    ],\n    \"allow\": [\n      \"Read(./src/**)\",\n      \"Read(./docs/**)\"\n    ]\n  }\n}\n```\n\n**Note about Glob**: The Glob tool doesn't have explicit permission controls in the same way as Read. You control it through the Allow/Deny rules, but the tool is primarily used for file discovery. To truly restrict file access, use Read/Edit deny rules for sensitive directories.\n\n### 3. YAML Syntax for Agent Frontmatter\n\nFor **Claude Code subagents** (not the Agent SDK), you define tool restrictions in the agent's markdown file:\n\n```yaml\n---\nname: retrieval-agent\ndescription: Secure retrieval with limited tools\nversion: 1.0.0\n---\n\n# Your agent instructions here\n```\n\nHowever, **agent frontmatter doesn't directly support permission rules**. Instead, you need to:\n\n**Option A**: Configure permissions at the **project level** in `.claude/settings.json`:\n\n```json\n{\n  \"permissions\": {\n    \"defaultMode\": \"dontAsk\",\n    \"allow\": [\n      \"Bash(bun $CLAUDE_PLUGIN_ROOT/cli.js:*)\",\n      \"Grep\",\n      \"Bash(grep:*)\",\n      \"Bash(head:*)\",\n      \"Bash(tail:*)\"\n    ],\n    \"deny\": [\n      \"Bash(find:*)\",\n      \"Read(**)\"\n    ]\n  }\n}\n```\n\n**Option B**: If you're using the **Agent SDK** (Python/TypeScript), you can configure permissions programmatically:\n\n```python\nfrom claude_agent_sdk import query, ClaudeAgentOptions\n\nasync for message in query(\n    prompt=\"Find matching records\",\n    options=ClaudeAgentOptions(\n        permission_mode=\"dontAsk\"  # Auto-deny unless explicitly allowed\n    ),\n):\n    pass\n```\n\n### 4. For Your Retrieval Agent Specifically\n\nTo create a retrieval agent that **only** uses your CLI commands and grep/head/tail:\n\n**In `.claude/agents/retrieval.md`:**\n\n```yaml\n---\nname: retrieval\ndescription: Retrieve data using CLI commands only\nversion: 1.0.0\n---\n\nYou are a retrieval agent. You can ONLY:\n1. Use the CLI command: `bun $CLAUDE_PLUGIN_ROOT/cli.js` with any arguments\n2. Use grep, head, and tail for text processing\n3. Search with Grep tool\n\nDO NOT use: find, Read tool, Glob tool, curl, or any network commands.\n```\n\n**In `.claude/settings.json`:**\n\n```json\n{\n  \"permissions\": {\n    \"defaultMode\": \"dontAsk\",\n    \"allow\": [\n      \"Bash(bun $CLAUDE_PLUGIN_ROOT/cli.js:*)\",\n      \"Bash(grep:*)\",\n      \"Bash(head:*)\",\n      \"Bash(tail:*)\",\n      \"Grep\"\n    ],\n    \"deny\": [\n      \"Bash(find:*)\",\n      \"Bash(curl:*)\",\n      \"Bash(ls:*)\",\n      \"Read(**)\",\n      \"Glob(**)\",\n      \"WebFetch\"\n    ]\n  }\n}\n```\n\n### Key Points\n\n- **Prefix matching**: Bash rules use prefix matching. `Bash(bun:*)` matches `bun run`, `bun test`, etc.\n- **Order matters**: Deny rules are evaluated first, then allow rules. A deny always blocks.\n- **Glob and Read**: You can't restrict Glob to certain directories via rules, but deny rules on Read will prevent file access.\n- **`dontAsk` mode**: This mode auto-denies all tools unless explicitly allowed in the allow list. Perfect for restrictive agents.\n- **Environment variables**: `$CLAUDE_PLUGIN_ROOT` is expanded in Bash rules.\n\nFor detailed information, see:\n- [Claude Code Permission Settings](https://code.claude.com/docs/en/settings.md#permission-settings)\n- [Claude Code IAM - Tool-Specific Rules](https://code.claude.com/docs/en/iam.md#tool-specific-permission-rules)\n- [Agent SDK Permissions](https://platform.claude.com/docs/en/agent-sdk/permissions.md)\n\nSources:\n- [Claude Code Settings Documentation](https://code.claude.com/docs/en/settings.md)\n- [Claude Code IAM Documentation](https://code.claude.com/docs/en/iam.md)\n- [Agent SDK Permissions Guide](https://platform.claude.com/docs/en/agent-sdk/permissions.md)"}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":13855,"cache_read_input_tokens":22107,"cache_creation":{"ephemeral_5m_input_tokens":13855,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.1.1","gitBranch":"main","agentId":"aa534fe"}
