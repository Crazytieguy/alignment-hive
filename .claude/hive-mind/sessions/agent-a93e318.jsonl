{"_type":"hive-mind-meta","version":"0.1","sessionId":"agent-a93e318","checkoutId":"deb16c4b-0302-4e62-8640-ec42acb25027","extractedAt":"2026-01-09T04:48:31.710Z","rawMtime":"2025-12-24T18:49:38.352Z","messageCount":21,"rawPath":"/Users/yoav/.claude/projects/-Users-yoav-projects-alignment-hive/agent-a93e318.jsonl","agentId":"a93e318","parentSessionId":"f968233b-ebe5-4958-aa2d-69a2d8e7413c"}
{"type":"user","uuid":"3f980f6c-663d-4891-b991-f77795ee2c2d","parentUuid":null,"timestamp":"2025-12-24T18:48:50.087Z","sessionId":"f968233b-ebe5-4958-aa2d-69a2d8e7413c","cwd":"/Users/yoav/projects/alignment-hive","gitBranch":"main","version":"2.0.76","message":{"role":"user","content":"Research Claude Code features that would be relevant for a memory system:\n1. Hooks - especially SessionEnd, PreToolUse, PostToolUse - how they work and what data they have access to\n2. Skills vs Commands - the difference and when to use each\n3. Any patterns for persistent storage across sessions\n\nFocus on understanding what capabilities are available. Do not run bash commands."},"isSidechain":true,"agentId":"a93e318"}
{"type":"assistant","uuid":"47b4f5c0-cb50-4547-bc5b-8eff45e83a1e","parentUuid":"3f980f6c-663d-4891-b991-f77795ee2c2d","timestamp":"2025-12-24T18:48:51.504Z","sessionId":"f968233b-ebe5-4958-aa2d-69a2d8e7413c","message":{"role":"assistant","content":[{"type":"text","text":"I'll research Claude Code features for building a memory system. Let me fetch the official documentation to understand hooks, skills vs commands, and persistent storage patterns."}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":7941,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":7941,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.0.76","gitBranch":"main","agentId":"a93e318"}
{"type":"assistant","uuid":"649d894d-853f-4f4b-91e8-4398386cf7f7","parentUuid":"47b4f5c0-cb50-4547-bc5b-8eff45e83a1e","timestamp":"2025-12-24T18:48:52.166Z","sessionId":"f968233b-ebe5-4958-aa2d-69a2d8e7413c","message":{"role":"assistant","content":[{"type":"tool_use","id":"toolu_01HZY3V1ceZCi3427bxxee5X","name":"WebFetch","input":{"url":"https://code.claude.com/docs/en/claude_code_docs_map.md","prompt":"Find the documentation URLs for hooks, skills, commands, and persistent storage/state management"}}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":7941,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":7941,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.0.76","gitBranch":"main","agentId":"a93e318"}
{"type":"assistant","uuid":"a57ae94b-9800-4883-9b01-612c72dc84a3","parentUuid":"649d894d-853f-4f4b-91e8-4398386cf7f7","timestamp":"2025-12-24T18:48:52.709Z","sessionId":"f968233b-ebe5-4958-aa2d-69a2d8e7413c","message":{"role":"assistant","content":[{"type":"tool_use","id":"toolu_01HPkBzL5ZM7uLwU4XXdsfDN","name":"WebFetch","input":{"url":"https://platform.claude.com/llms.txt","prompt":"Find information about Agent SDK features for persistent storage and session management"}}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":7941,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":7941,"ephemeral_1h_input_tokens":0},"output_tokens":213,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.0.76","gitBranch":"main","agentId":"a93e318"}
{"type":"user","uuid":"d2be1f58-9831-4d94-aca4-31eb6b953506","parentUuid":"a57ae94b-9800-4883-9b01-612c72dc84a3","timestamp":"2025-12-24T18:48:53.253Z","sessionId":"f968233b-ebe5-4958-aa2d-69a2d8e7413c","cwd":"/Users/yoav/projects/alignment-hive","gitBranch":"main","version":"2.0.76","message":{"role":"user","content":[{"type":"tool_result","tool_use_id":"toolu_01HZY3V1ceZCi3427bxxee5X","content":"# null\n\n# Claude Code Documentation Map\n\nThis is a comprehensive map of all Claude Code documentation pages with their headings, designed for easy navigation by LLMs.\n\n> **Note:** This file is auto-generated by GitHub Actions. Do not edit manually.\n> Last updated: 2025-11-06 00:10:13 UTC\n\n## Document Structure\n\nThis map uses a hierarchical structure:\n\n* **##** marks documentation groups (e.g., 'Getting started')\n* **###** marks individual documentation pages\n* **Nested bullets** show the heading structure within each page\n* Each page title links to the full documentation\n\n## Getting started\n\n### [overview](https://code.claude.com/docs/en/overview.md)\n\n* Get started in 30 seconds\n* What Claude Code does for you\n* Why developers love Claude Code\n* Next steps\n* Additional resources\n\n### [quickstart](https://code.claude.com/docs/en/quickstart.md)\n\n* Before you begin\n* Step 1: Install Claude Code\n* Step 2: Log in to your account\n* Step 3: Start your first session\n* Step 4: Ask your first question\n* Step 5: Make your first code change\n* Step 6: Use Git with Claude Code\n* Step 7: Fix a bug or add a feature\n* Step 8: Test out other common workflows\n* Essential commands\n* Pro tips for beginners\n* What's next?\n* Getting help\n\n### [common-workflows](https://code.claude.com/docs/en/common-workflows.md)\n\n* Understand new codebases\n  * Get a quick codebase overview\n  * Find relevant code\n* Fix bugs efficiently\n* Refactor code\n* Use specialized subagents\n* Use Plan Mode for safe code analysis\n  * When to use Plan Mode\n  * How to use Plan Mode\n  * Example: Planning a complex refactor\n  * Configure Plan Mode as default\n* Work with tests\n* Create pull requests\n* Handle documentation\n* Work with images\n* Reference files and directories\n* Use extended thinking\n* Resume previous conversations\n* Run parallel Claude Code sessions with Git worktrees\n* Use Claude as a unix-style utility\n  * Add Claude to your verification process\n  * Pipe in, pipe out\n  * Control output format\n* Create custom slash commands\n  * Create project-specific commands\n  * Add command arguments with \\$ARGUMENTS\n  * Create personal slash commands\n* Ask Claude about its capabilities\n  * Example questions\n* Next steps\n\n### [claude-code-on-the-web](https://code.claude.com/docs/en/claude-code-on-the-web.md)\n\n* What is Claude Code on the web?\n* Who can use Claude Code on the web?\n* Getting started\n* How it works\n* Moving tasks between web and terminal\n  * From web to terminal\n* Cloud environment\n  * Default image\n    * Checking available tools\n    * Language-specific setups\n  * Environment configuration\n  * Dependency management\n    * Local vs remote execution\n    * Persisting environment variables\n* Network access and security\n  * Network policy\n    * GitHub proxy\n    * Security proxy\n  * Access levels\n  * Default allowed domains\n    * Anthropic Services\n    * Version Control\n    * Container Registries\n    * Cloud Platforms\n    * Package Managers - JavaScript/Node\n    * Package Managers - Python\n    * Package Managers - Ruby\n    * Package Managers - Rust\n    * Package Managers - Go\n    * Package Managers - JVM\n    * Package Managers - Other Languages\n    * Linux Distributions\n    * Development Tools & Platforms\n    * Cloud Services & Monitoring\n    * Content Delivery & Mirrors\n    * Schema & Configuration\n  * Security best practices for customized network access\n* Security and isolation\n* Pricing and rate limits\n* Limitations\n* Best practices\n* Related resources\n\n## Build with Claude Code\n\n### [sub-agents](https://code.claude.com/docs/en/sub-agents.md)\n\n* What are subagents?\n* Key benefits\n* Quick start\n* Subagent configuration\n  * File locations\n  * Plugin agents\n  * CLI-based configuration\n  * File format\n    * Configuration fields\n  * Model selection\n  * Available tools\n* Managing subagents\n  * Using the /agents command (Recommended)\n  * Direct file management\n* Using subagents effectively\n  * Automatic delegation\n  * Explicit invocation\n* Built-in subagents\n  * Plan subagent\n* Example subagents\n  * Code reviewer\n  * Debugger\n  * Data scientist\n* Best practices\n* Advanced usage\n  * Chaining subagents\n  * Dynamic subagent selection\n  * Resumable subagents\n* Performance considerations\n* Related documentation\n\n### [plugins](https://code.claude.com/docs/en/plugins.md)\n\n* Quickstart\n  * Prerequisites\n  * Create your first plugin\n* Hello Command\n  * Plugin structure overview\n  * Install and manage plugins\n    * Prerequisites\n    * Add marketplaces\n    * Install plugins\n      * Via interactive menu (recommended for discovery)\n      * Via direct commands (for quick installation)\n    * Verify installation\n  * Set up team plugin workflows\n  * Develop more complex plugins\n    * Add Skills to your plugin\n    * Organize complex plugins\n    * Test your plugins locally\n    * Debug plugin issues\n    * Share your plugins\n  * Next steps\n    * For plugin users\n    * For plugin developers\n    * For team leads and administrators\n  * See also\n\n### [skills](https://code.claude.com/docs/en/skills.md)\n\n* Prerequisites\n* What are Agent Skills?\n* Create a Skill\n  * Personal Skills\n  * Project Skills\n  * Plugin Skills\n* Write SKILL.md\n* Add supporting files\n* Restrict tool access with allowed-tools\n* View available Skills\n* Test a Skill\n* Debug a Skill\n  * Make description specific\n  * Verify file path\n  * Check YAML syntax\n  * View errors\n* Share Skills with your team\n  * Step 1: Add Skill to your project\n  * Step 2: Commit to git\n  * Step 3: Team members get Skills automatically\n* Update a Skill\n* Remove a Skill\n* Best practices\n  * Keep Skills focused\n  * Write clear descriptions\n  * Test with your team\n  * Document Skill versions\n* Troubleshooting\n  * Claude doesn't use my Skill\n  * Skill has errors\n  * Multiple Skills conflict\n* Examples\n  * Simple Skill (single file)\n  * Skill with tool permissions\n  * Multi-file Skill\n* Next steps\n\n### [output-styles](https://code.claude.com/docs/en/output-styles.md)\n\n* Built-in output styles\n* How output styles work\n* Change your output style\n* Create a custom output style\n* Comparisons to related features\n  * Output Styles vs. CLAUDE.md vs. --append-system-prompt\n  * Output Styles vs. [Agents](/en/sub-agents)\n  * Output Styles vs. [Custom Slash Commands](/en/slash-commands)\n\n### [hooks-guide](https://code.claude.com/docs/en/hooks-guide.md)\n\n* Hook Events Overview\n* Quickstart\n  * Prerequisites\n  * Step 1: Open hooks configuration\n  * Step 2: Add a matcher\n  * Step 3: Add the hook\n  * Step 4: Save your configuration\n  * Step 5: Verify your hook\n  * Step 6: Test your hook\n* More Examples\n  * Code Formatting Hook\n  * Markdown Formatting Hook\n  * Custom Notification Hook\n  * File Protection Hook\n* Learn more\n\n### [headless](https://code.claude.com/docs/en/headless.md)\n\n* Overview\n* Basic usage\n* Configuration Options\n* Multi-turn conversations\n* Output Formats\n  * Text Output (Default)\n  * JSON Output\n  * Streaming JSON Output\n* Input Formats\n  * Text Input (Default)\n  * Streaming JSON Input\n* Agent Integration Examples\n  * SRE Incident Response Bot\n  * Automated Security Review\n  * Multi-turn Legal Assistant\n* Best Practices\n* Related Resources\n\n### [github-actions](https://code.claude.com/docs/en/github-actions.md)\n\n* Why use Claude Code GitHub Actions?\n* What can Claude do?\n  * Claude Code Action\n* Setup\n* Quick setup\n* Manual setup\n* Upgrading from Beta\n  * Essential changes\n  * Breaking Changes Reference\n  * Before and After Example\n* Example use cases\n  * Basic workflow\n  * Using slash commands\n  * Custom automation with prompts\n  * Common use cases\n* Best practices\n  * CLAUDE.md configuration\n  * Security considerations\n  * Optimizing performance\n  * CI costs\n* Configuration examples\n* Using with AWS Bedrock & Google Vertex AI\n  * Prerequisites\n    * For Google Cloud Vertex AI:\n    * For AWS Bedrock:\n* Troubleshooting\n  * Claude not responding to @claude commands\n  * CI not running on Claude's commits\n  * Authentication errors\n* Advanced configuration\n  * Action parameters\n    * Using claude\\_args\n  * Alternative integration methods\n  * Customizing Claude's behavior\n\n### [gitlab-ci-cd](https://code.claude.com/docs/en/gitlab-ci-cd.md)\n\n* Why use Claude Code with GitLab?\n* How it works\n* What can Claude do?\n* Setup\n  * Quick setup\n  * Manual setup (recommended for production)\n* Example use cases\n  * Turn issues into MRs\n  * Get implementation help\n  * Fix bugs quickly\n* Using with AWS Bedrock & Google Vertex AI\n* Configuration examples\n  * Basic .gitlab-ci.yml (Claude API)\n  * AWS Bedrock job example (OIDC)\n  * Google Vertex AI job example (Workload Identity Federation)\n* Best practices\n  * CLAUDE.md configuration\n  * Security considerations\n  * Optimizing performance\n  * CI costs\n* Security and governance\n* Troubleshooting\n  * Claude not responding to @claude commands\n  * Job can't write comments or open MRs\n  * Authentication errors\n* Advanced configuration\n  * Common parameters and variables\n  * Customizing Claude's behavior\n\n### [mcp](https://code.claude.com/docs/en/mcp.md)\n\n* What you can do with MCP\n* Popular MCP servers\n* Installing MCP servers\n  * Option 1: Add a remote HTTP server\n  * Option 2: Add a remote SSE server\n  * Option 3: Add a local stdio server\n  * Managing your servers\n  * Plugin-provided MCP servers\n* MCP installation scopes\n  * Local scope\n  * Project scope\n  * User scope\n  * Choosing the right scope\n  * Scope hierarchy and precedence\n  * Environment variable expansion in `.mcp.json`\n* Practical examples\n  * Example: Monitor errors with Sentry\n  * Example: Connect to GitHub for code reviews\n  * Example: Query your PostgreSQL database\n* Authenticate with remote MCP servers\n* Add MCP servers from JSON configuration\n* Import MCP servers from Claude Desktop\n* Use Claude Code as an MCP server\n* MCP output limits and warnings\n* Use MCP resources\n  * Reference MCP resources\n* Use MCP prompts as slash commands\n  * Execute MCP prompts\n* Enterprise MCP configuration\n  * Setting up enterprise MCP configuration\n  * Restricting MCP servers with allowlists and denylists\n\n### [migration-guide](https://code.claude.com/docs/en/migration-guide.md)\n\n* Overview\n* What's Changed\n* Migration Steps\n  * For TypeScript/JavaScript Projects\n  * For Python Projects\n* Breaking changes\n  * Python: ClaudeCodeOptions renamed to ClaudeAgentOptions\n  * System prompt no longer default\n  * Settings Sources No Longer Loaded by Default\n* Why the Rename?\n* Getting Help\n* Next Steps\n\n### [troubleshooting](https://code.claude.com/docs/en/troubleshooting.md)\n\n* Common installation issues\n  * Windows installation issues: errors in WSL\n  * Linux and Mac installation issues: permission or command not found errors\n    * Recommended solution: Native Claude Code installation\n* Permissions and authentication\n  * Repeated permission prompts\n  * Authentication issues\n* Performance and stability\n  * High CPU or memory usage\n  * Command hangs or freezes\n  * Search and discovery issues\n  * Slow or incomplete search results on WSL\n* IDE integration issues\n  * JetBrains IDE not detected on WSL2\n    * WSL2 networking modes\n  * Reporting Windows IDE integration issues (both native and WSL)\n  * ESC key not working in JetBrains (IntelliJ, PyCharm, etc.) terminals\n* Markdown formatting issues\n  * Missing language tags in code blocks\n  * Inconsistent spacing and formatting\n  * Best practices for markdown generation\n* Getting more help\n\n## Deployment\n\n### [third-party-integrations](https://code.claude.com/docs/en/third-party-integrations.md)\n\n* Provider comparison\n* Cloud providers\n* Corporate infrastructure\n* Configuration overview\n  * Using Bedrock with corporate proxy\n  * Using Bedrock with LLM Gateway\n  * Using Vertex AI with corporate proxy\n  * Using Vertex AI with LLM Gateway\n  * Authentication configuration\n* Choosing the right deployment configuration\n  * Direct provider access\n  * Corporate proxy\n  * LLM Gateway\n* Debugging\n* Best practices for organizations\n  * 1. Invest in documentation and memory\n  * 2. Simplify deployment\n  * 3. Start with guided usage\n  * 4. Configure security policies\n  * 5. Leverage MCP for integrations\n* Next steps\n\n### [amazon-bedrock](https://code.claude.com/docs/en/amazon-bedrock.md)\n\n* Prerequisites\n* Setup\n  * 1. Submit use case details\n  * 2. Configure AWS credentials\n    * Advanced credential configuration\n      * Example configuration\n      * Configuration settings explained\n  * 3. Configure Claude Code\n  * 4. Model configuration\n  * 5. Output token configuration\n* IAM configuration\n* Troubleshooting\n* Additional resources\n\n### [google-vertex-ai](https://code.claude.com/docs/en/google-vertex-ai.md)\n\n* Prerequisites\n* Region Configuration\n* Setup\n  * 1. Enable Vertex AI API\n  * 2. Request model access\n  * 3. Configure GCP credentials\n  * 4. Configure Claude Code\n  * 5. Model configuration\n* IAM configuration\n* 1M token context window\n* Troubleshooting\n* Additional resources\n\n### [network-config](https://code.claude.com/docs/en/network-config.md)\n\n* Proxy configuration\n  * Environment variables\n  * Basic authentication\n* Custom CA certificates\n* mTLS authentication\n* Network access requirements\n* Additional resources\n\n### [llm-gateway](https://code.claude.com/docs/en/llm-gateway.md)\n\n* LiteLLM configuration\n  * Prerequisites\n  * Basic LiteLLM setup\n    * Authentication methods\n      * Static API key\n      * Dynamic API key with helper\n    * Unified endpoint (recommended)\n    * Provider-specific pass-through endpoints (alternative)\n      * Claude API through LiteLLM\n      * Amazon Bedrock through LiteLLM\n      * Google Vertex AI through LiteLLM\n  * Model selection\n* Additional resources\n\n### [devcontainer](https://code.claude.com/docs/en/devcontainer.md)\n\n* Key features\n* Getting started in 4 steps\n* Configuration breakdown\n* Security features\n* Customization options\n* Example use cases\n  * Secure client work\n  * Team onboarding\n  * Consistent CI/CD environments\n* Related resources\n\n### [sandboxing](https://code.claude.com/docs/en/sandboxing.md)\n\n* Overview\n* Why sandboxing matters\n* How it works\n  * Filesystem isolation\n  * Network isolation\n  * OS-level enforcement\n* Getting started\n  * Enable sandboxing\n  * Configure sandboxing\n* Security benefits\n  * Protection against prompt injection\n  * Reduced attack surface\n  * Transparent operation\n* Security Limitations\n* Advanced usage\n  * Custom proxy configuration\n  * Integration with existing security tools\n* Best practices\n* Open source\n* Limitations\n* See also\n\n## Administration\n\n### [setup](https://code.claude.com/docs/en/setup.md)\n\n* System requirements\n  * Additional dependencies\n* Standard installation\n* Windows setup\n* Alternative installation methods\n  * Native installation options\n  * NPM installation\n* Running on AWS or GCP\n* Update Claude Code\n  * Auto updates\n  * Update manually\n\n### [iam](https://code.claude.com/docs/en/iam.md)\n\n* Authentication methods\n  * Claude API authentication\n  * Cloud provider authentication\n* Access control and permissions\n  * Permission system\n  * Configuring permissions\n    * Permission modes\n    * Working directories\n    * Tool-specific permission rules\n  * Additional permission control with hooks\n  * Enterprise managed policy settings\n  * Settings precedence\n* Credential management\n\n### [security](https://code.claude.com/docs/en/security.md)\n\n* How we approach security\n  * Security foundation\n  * Permission-based architecture\n  * Built-in protections\n  * User responsibility\n* Protect against prompt injection\n  * Core protections\n  * Privacy safeguards\n  * Additional safeguards\n* MCP security\n* IDE security\n* Cloud execution security\n* Security best practices\n  * Working with sensitive code\n  * Team security\n  * Reporting security issues\n* Related resources\n\n### [data-usage](https://code.claude.com/docs/en/data-usage.md)\n\n* Data policies\n  * Data training policy\n  * Development Partner Program\n  * Feedback using the `/bug` command\n  * Session quality surveys\n  * Data retention\n* Data flow and dependencies\n  * Cloud execution\n* Telemetry services\n* Default behaviors by API provider\n\n### [monitoring-usage](https://code.claude.com/docs/en/monitoring-usage.md)\n\n* Quick Start\n* Administrator Configuration\n* Configuration Details\n  * Common Configuration Variables\n  * Metrics Cardinality Control\n  * Dynamic Headers\n    * Settings Configuration\n    * Script Requirements\n    * Important Limitations\n  * Multi-Team Organization Support\n  * Example Configurations\n* Available Metrics and Events\n  * Standard Attributes\n  * Metrics\n  * Metric Details\n    * Session Counter\n    * Lines of Code Counter\n    * Pull Request Counter\n    * Commit Counter\n    * Cost Counter\n    * Token Counter\n    * Code Edit Tool Decision Counter\n    * Active Time Counter\n  * Events\n    * User Prompt Event\n    * Tool Result Event\n    * API Request Event\n    * API Error Event\n    * Tool Decision Event\n* Interpreting Metrics and Events Data\n  * Usage Monitoring\n  * Cost Monitoring\n  * Alerting and Segmentation\n  * Event Analysis\n* Backend Considerations\n  * For Metrics:\n  * For Events/Logs:\n* Service Information\n* ROI Measurement Resources\n* Security/Privacy Considerations\n* Monitoring Claude Code on Amazon Bedrock\n\n### [costs](https://code.claude.com/docs/en/costs.md)\n\n* Track your costs\n  * Using the `/cost` command\n  * Additional tracking options\n* Managing costs for teams\n  * Rate limit recommendations\n* Reduce token usage\n* Background token usage\n* Tracking version changes and updates\n  * Current version information\n  * Understanding changes in Claude Code behavior\n  * When cost reporting changes\n\n### [analytics](https://code.claude.com/docs/en/analytics.md)\n\n* Access analytics\n  * Required roles\n* Available metrics\n  * Lines of code accepted\n  * Suggestion accept rate\n  * Activity\n  * Spend\n  * Team insights\n* Using analytics effectively\n  * Monitor adoption\n  * Measure productivity\n* Related resources\n\n### [plugin-marketplaces](https://code.claude.com/docs/en/plugin-marketplaces.md)\n\n* Overview\n  * Prerequisites\n* Add and use marketplaces\n  * Add GitHub marketplaces\n  * Add Git repositories\n  * Add local marketplaces for development\n  * Install plugins from marketplaces\n  * Verify marketplace installation\n* Configure team marketplaces\n* Create your own marketplace\n  * Prerequisites for marketplace creation\n  * Create the marketplace file\n  * Marketplace schema\n    * Required fields\n    * Optional metadata\n  * Plugin entries\n    * Optional plugin fields\n  * Plugin sources\n    * Relative paths\n    * GitHub repositories\n    * Git repositories\n    * Advanced plugin entries\n* Host and distribute marketplaces\n  * Host on GitHub (recommended)\n  * Host on other git services\n  * Use local marketplaces for development\n* Manage marketplace operations\n  * List known marketplaces\n  * Update marketplace metadata\n  * Remove a marketplace\n* Troubleshooting marketplaces\n  * Common marketplace issues\n    * Marketplace not loading\n    * Plugin installation failures\n  * Validation and testing\n* Next steps\n  * For marketplace users\n  * For marketplace creators\n  * For organizations\n* See also\n\n## Configuration\n\n### [settings](https://code.claude.com/docs/en/settings.md)\n\n* Settings files\n  * Available settings\n  * Permission settings\n  * Sandbox settings\n  * Settings precedence\n  * Key points about the configuration system\n  * System prompt availability\n  * Excluding sensitive files\n* Subagent configuration\n* Plugin configuration\n  * Plugin settings\n    * `enabledPlugins`\n    * `extraKnownMarketplaces`\n  * Managing plugins\n* Environment variables\n* Tools available to Claude\n  * Extending tools with hooks\n* See also\n\n### [vs-code](https://code.claude.com/docs/en/vs-code.md)\n\n* VS Code Extension (Beta)\n  * Features\n  * Requirements\n  * Installation\n  * How It Works\n  * Using Third-Party Providers (Vertex and Bedrock)\n    * Environment Variables\n  * Not Yet Implemented\n* Security Considerations\n* Legacy CLI Integration\n* Troubleshooting\n  * Extension Not Installing\n  * Legacy Integration Not Working\n\n### [jetbrains](https://code.claude.com/docs/en/jetbrains.md)\n\n* Supported IDEs\n* Features\n* Installation\n  * Marketplace Installation\n* Usage\n  * From Your IDE\n  * From External Terminals\n* Configuration\n  * Claude Code Settings\n  * Plugin Settings\n    * General Settings\n    * ESC Key Configuration\n* Special Configurations\n  * Remote Development\n  * WSL Configuration\n* Troubleshooting\n  * Plugin Not Working\n  * IDE Not Detected\n  * Command Not Found\n* Security Considerations\n\n### [terminal-config](https://code.claude.com/docs/en/terminal-config.md)\n\n* Themes and appearance\n* Line breaks\n  * Set up Shift+Enter (VS Code or iTerm2):\n  * Set up Option+Enter (VS Code, iTerm2 or macOS Terminal.app):\n* Notification setup\n  * iTerm 2 system notifications\n  * Custom notification hooks\n* Handling large inputs\n* Vim Mode\n\n### [model-config](https://code.claude.com/docs/en/model-config.md)\n\n* Available models\n  * Model aliases\n  * Setting your model\n* Special model behavior\n  * `default` model setting\n  * `opusplan` model setting\n  * Extended context with \\[1m]\n* Checking your current model\n* Environment variables\n  * Prompt caching configuration\n\n### [memory](https://code.claude.com/docs/en/memory.md)\n\n* Determine memory type\n* CLAUDE.md imports\n* How Claude looks up memories\n* Quickly add memories with the `#` shortcut\n* Directly edit memories with `/memory`\n* Set up project memory\n* Organization-level memory management\n* Memory best practices\n\n### [statusline](https://code.claude.com/docs/en/statusline.md)\n\n* Create a custom status line\n* How it Works\n* JSON Input Structure\n* Example Scripts\n  * Simple Status Line\n  * Git-Aware Status Line\n  * Python Example\n  * Node.js Example\n  * Helper Function Approach\n* Tips\n* Troubleshooting\n\n## Reference\n\n### [cli-reference](https://code.claude.com/docs/en/cli-reference.md)\n\n* CLI commands\n* CLI flags\n  * Agents flag format\n  * System prompt flags\n* See also\n\n### [interactive-mode](https://code.claude.com/docs/en/interactive-mode.md)\n\n* Keyboard shortcuts\n  * General controls\n  * Multiline input\n  * Quick commands\n* Vim editor mode\n  * Mode switching\n  * Navigation (NORMAL mode)\n  * Editing (NORMAL mode)\n* Command history\n  * Reverse search with Ctrl+R\n* Background bash commands\n  * How backgrounding works\n  * Bash mode with `!` prefix\n* See also\n\n### [slash-commands](https://code.claude.com/docs/en/slash-commands.md)\n\n* Built-in slash commands\n* Custom slash commands\n  * Syntax\n    * Parameters\n  * Command types\n    * Project commands\n    * Personal commands\n  * Features\n    * Namespacing\n    * Arguments\n      * All arguments with `$ARGUMENTS`\n      * Individual arguments with `$1`, `$2`, etc.\n    * Bash command execution\n    * File references\n    * Thinking mode\n  * Frontmatter\n* Plugin commands\n  * How plugin commands work\n  * Plugin command structure\n  * Invocation patterns\n* MCP slash commands\n  * Command format\n  * Features\n    * Dynamic discovery\n    * Arguments\n    * Naming conventions\n  * Managing MCP connections\n  * MCP permissions and wildcards\n* `SlashCommand` tool\n  * `SlashCommand` tool supported commands\n  * Disable `SlashCommand` tool\n  * Disable specific commands only\n  * `SlashCommand` permission rules\n  * Character budget limit\n* Skills vs slash commands\n  * Use slash commands for\n  * Use Skills for\n  * Key differences\n  * Example comparison\n  * When to use each\n* See also\n\n### [checkpointing](https://code.claude.com/docs/en/checkpointing.md)\n\n* How checkpoints work\n  * Automatic tracking\n  * Rewinding changes\n* Common use cases\n* Limitations\n  * Bash command changes not tracked\n  * External changes not tracked\n  * Not a replacement for version control\n* See also\n\n### [hooks](https://code.claude.com/docs/en/hooks.md)\n\n* Configuration\n  * Structure\n  * Project-Specific Hook Scripts\n  * Plugin hooks\n* Prompt-Based Hooks\n  * How prompt-based hooks work\n  * Configuration\n  * Response schema\n  * Supported hook events\n  * Example: Intelligent Stop hook\n  * Example: SubagentStop with custom logic\n  * Comparison with bash command hooks\n  * Best practices\n* Hook Events\n  * PreToolUse\n  * PermissionRequest\n  * PostToolUse\n  * Notification\n  * UserPromptSubmit\n  * Stop\n  * SubagentStop\n  * PreCompact\n  * SessionStart\n    * Persisting environment variables\n  * SessionEnd\n* Hook Input\n  * PreToolUse Input\n  * PermissionRequest\n  * PostToolUse Input\n  * Notification Input\n  * UserPromptSubmit Input\n  * Stop and SubagentStop Input\n  * PreCompact Input\n  * SessionStart Input\n  * SessionEnd Input\n* Hook Output\n  * Simple: Exit Code\n    * Exit Code 2 Behavior\n  * Advanced: JSON Output\n    * Common JSON Fields\n    * `PreToolUse` Decision Control\n    * `PermissionRequest` Decision Control\n    * `PostToolUse` Decision Control\n    * `UserPromptSubmit` Decision Control\n    * `Stop`/`SubagentStop` Decision Control\n    * `SessionStart` Decision Control\n    * `SessionEnd` Decision Control\n    * Exit Code Example: Bash Command Validation\n    * JSON Output Example: UserPromptSubmit to Add Context and Validation\n    * JSON Output Example: PreToolUse with Approval\n* Working with MCP Tools\n  * MCP Tool Naming\n  * Configuring Hooks for MCP Tools\n* Examples\n* Security Considerations\n  * Disclaimer\n  * Security Best Practices\n  * Configuration Safety\n* Hook Execution Details\n* Debugging\n  * Basic Troubleshooting\n  * Advanced Debugging\n  * Debug Output Example\n\n### [plugins-reference](https://code.claude.com/docs/en/plugins-reference.md)\n\n* Plugin components reference\n  * Commands\n  * Agents\n  * Skills\n  * Hooks\n  * MCP servers\n* Plugin manifest schema\n  * Complete schema\n  * Required fields\n  * Metadata fields\n  * Component path fields\n  * Path behavior rules\n  * Environment variables\n* Plugin directory structure\n  * Standard plugin layout\n  * File locations reference\n* Debugging and development tools\n  * Debugging commands\n  * Common issues\n* Distribution and versioning reference\n  * Version management\n\n## Resources\n\n### [legal-and-compliance](https://code.claude.com/docs/en/legal-and-compliance.md)\n\n* Legal agreements\n  * License\n  * Commercial agreements\n* Compliance\n  * Healthcare compliance (BAA)\n* Security and trust\n  * Trust and safety\n  * Security vulnerability reporting\n\n\n---\n\n> To find navigation and other pages in this documentation, fetch the llms.txt file at: https://code.claude.com/docs/llms.txt"}]},"isSidechain":true,"agentId":"a93e318"}
{"type":"user","uuid":"0a8031de-75ec-46f6-8832-c2fa0505f6a1","parentUuid":"d2be1f58-9831-4d94-aca4-31eb6b953506","timestamp":"2025-12-24T18:49:01.468Z","sessionId":"f968233b-ebe5-4958-aa2d-69a2d8e7413c","cwd":"/Users/yoav/projects/alignment-hive","gitBranch":"main","version":"2.0.76","message":{"role":"user","content":[{"type":"tool_result","tool_use_id":"toolu_01HPkBzL5ZM7uLwU4XXdsfDN","content":"# Claude Code - CLI for Claude\n\nBased on the documentation provided, I can help you understand the Anthropic Claude API and development resources. Here's what's available:\n\n## Key Resources\n\n### Developer Platform\n- **Root URL**: https://platform.claude.com\n- **Console**: Requires login at https://platform.claude.com\n\n### Available Languages\nDocumentation is available in 11 languages including English (530 pages), German, Spanish, French, Italian, Japanese, Korean, Portuguese, Russian, and Chinese variants (Simplified & Traditional).\n\n## Main Documentation Sections\n\n### 1. **Developer Guide** - Core Building Blocks\n- Introduction to Claude and available models\n- **Quickstarts** for getting started with the API\n- **Agent SDK** (Python & TypeScript) for building AI agents\n- **Prompt Engineering** best practices including:\n  - Chain of thought prompting\n  - System prompts and role-playing\n  - Multishot prompting\n  - Structured outputs\n\n### 2. **Agent Features**\n- Agent Skills for extending capabilities\n- Tool use (bash, code execution, computer use, web search, memory)\n- Custom tools and MCP (Model Context Protocol) integration\n- Subagents for complex multi-step operations\n- Session management and file checkpointing\n\n### 3. **API Reference**\nComplete endpoints for:\n- **Messages API** - Create and manage messages\n- **Batch Processing** - Process multiple requests efficiently\n- **Models** - List and retrieve available models\n- **Files API** - Upload and manage files\n- **Admin API** - Workspace, user, and API key management\n\n### 4. **Testing & Evaluation**\n- Define success criteria for your applications\n- Develop comprehensive test cases\n- Strengthen guardrails (reduce hallucinations, mitigate jailbreaks)\n- Handle streaming refusals\n- Keep Claude in character\n\n### 5. **Advanced Features**\n- Extended thinking for complex reasoning\n- Vision/image understanding\n- Embeddings for semantic search\n- Token counting and cost tracking\n- Prompt caching for efficiency\n- Context windows and long-context support\n\n## Getting Started\n\n1. **Visit**: https://platform.claude.com/docs\n2. **Choose language**: Full docs in 11 languages\n3. **Select your path**:\n   - API integration → Start with \"Get started with Claude\"\n   - Agent building → \"Agent SDK quickstart\"\n   - Specific task → Browse prompt library with 50+ examples\n\n## Quick Navigation\n\n- **Models Overview**: Choose between Claude 3.5 Sonnet, Claude 3.5 Haiku, and others\n- **Pricing**: Check current pricing\n- **SDKs**: Python, TypeScript, Go, Java, Kotlin, Ruby available\n- **Examples**: 50+ prompt templates in the library\n\nIs there a specific aspect of Claude development you'd like to explore?"}]},"isSidechain":true,"agentId":"a93e318"}
{"type":"assistant","uuid":"b04ae7ed-3519-4df3-9c64-a072d31bcb44","parentUuid":"0a8031de-75ec-46f6-8832-c2fa0505f6a1","timestamp":"2025-12-24T18:49:03.857Z","sessionId":"f968233b-ebe5-4958-aa2d-69a2d8e7413c","message":{"role":"assistant","content":[{"type":"text","text":"Now let me fetch the specific documentation pages for hooks and skills to get detailed information:"}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":7985,"cache_read_input_tokens":7941,"cache_creation":{"ephemeral_5m_input_tokens":7985,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.0.76","gitBranch":"main","agentId":"a93e318"}
{"type":"assistant","uuid":"f2a1619a-eca8-4e39-bd14-ec67ad5b657d","parentUuid":"b04ae7ed-3519-4df3-9c64-a072d31bcb44","timestamp":"2025-12-24T18:49:04.671Z","sessionId":"f968233b-ebe5-4958-aa2d-69a2d8e7413c","message":{"role":"assistant","content":[{"type":"tool_use","id":"toolu_01PkmYSgY4XNyXAEoDm9yHBz","name":"WebFetch","input":{"url":"https://code.claude.com/docs/en/hooks.md","prompt":"Document the complete hook events, especially SessionEnd, PreToolUse, PostToolUse - what data they have access to and what capabilities they provide"}}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":7985,"cache_read_input_tokens":7941,"cache_creation":{"ephemeral_5m_input_tokens":7985,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.0.76","gitBranch":"main","agentId":"a93e318"}
{"type":"assistant","uuid":"88cd8ed1-25d6-45fd-84df-9d238e91a43d","parentUuid":"f2a1619a-eca8-4e39-bd14-ec67ad5b657d","timestamp":"2025-12-24T18:49:05.081Z","sessionId":"f968233b-ebe5-4958-aa2d-69a2d8e7413c","message":{"role":"assistant","content":[{"type":"tool_use","id":"toolu_01MXfkcYFWqLZfsoMdfCvbJc","name":"WebFetch","input":{"url":"https://code.claude.com/docs/en/skills.md","prompt":"Explain the difference between skills and commands, when to use each, and how they work"}}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":7985,"cache_read_input_tokens":7941,"cache_creation":{"ephemeral_5m_input_tokens":7985,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.0.76","gitBranch":"main","agentId":"a93e318"}
{"type":"assistant","uuid":"f32cb2dd-2d76-42cf-b816-dc1927bb09af","parentUuid":"88cd8ed1-25d6-45fd-84df-9d238e91a43d","timestamp":"2025-12-24T18:49:05.514Z","sessionId":"f968233b-ebe5-4958-aa2d-69a2d8e7413c","message":{"role":"assistant","content":[{"type":"tool_use","id":"toolu_01GD29b7M1NsKtHwend75MvA","name":"WebFetch","input":{"url":"https://code.claude.com/docs/en/hooks-guide.md","prompt":"Provide examples and guidance on implementing hooks for practical use cases"}}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":7985,"cache_read_input_tokens":7941,"cache_creation":{"ephemeral_5m_input_tokens":7985,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.0.76","gitBranch":"main","agentId":"a93e318"}
{"type":"assistant","uuid":"24772a32-b024-4385-9115-a498dff2bd27","parentUuid":"f32cb2dd-2d76-42cf-b816-dc1927bb09af","timestamp":"2025-12-24T18:49:05.907Z","sessionId":"f968233b-ebe5-4958-aa2d-69a2d8e7413c","message":{"role":"assistant","content":[{"type":"tool_use","id":"toolu_01JkNp7q9jMYWJgtA8tzk6A2","name":"WebFetch","input":{"url":"https://code.claude.com/docs/en/slash-commands.md","prompt":"Compare skills vs slash commands and explain the differences"}}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":7985,"cache_read_input_tokens":7941,"cache_creation":{"ephemeral_5m_input_tokens":7985,"ephemeral_1h_input_tokens":0},"output_tokens":373,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.0.76","gitBranch":"main","agentId":"a93e318"}
{"type":"user","uuid":"ea5d43e8-ef0b-463d-8dd2-66edeafac8dc","parentUuid":"24772a32-b024-4385-9115-a498dff2bd27","timestamp":"2025-12-24T18:49:06.128Z","sessionId":"f968233b-ebe5-4958-aa2d-69a2d8e7413c","cwd":"/Users/yoav/projects/alignment-hive","gitBranch":"main","version":"2.0.76","message":{"role":"user","content":[{"type":"tool_result","tool_use_id":"toolu_01MXfkcYFWqLZfsoMdfCvbJc","content":"# Agent Skills\n\n> Create, manage, and share Skills to extend Claude's capabilities in Claude Code.\n\nThis guide shows you how to create, use, and manage Agent Skills in Claude Code. Skills are modular capabilities that extend Claude's functionality through organized folders containing instructions, scripts, and resources.\n\n## Prerequisites\n\n* Claude Code version 1.0 or later\n* Basic familiarity with [Claude Code](/en/quickstart)\n\n## What are Agent Skills?\n\nAgent Skills package expertise into discoverable capabilities. Each Skill consists of a `SKILL.md` file with instructions that Claude reads when relevant, plus optional supporting files like scripts and templates.\n\n**How Skills are invoked**: Skills are **model-invoked**—Claude autonomously decides when to use them based on your request and the Skill's description. This is different from slash commands, which are **user-invoked** (you explicitly type `/command` to trigger them).\n\n**Benefits**:\n\n* Extend Claude's capabilities for your specific workflows\n* Share expertise across your team via git\n* Reduce repetitive prompting\n* Compose multiple Skills for complex tasks\n\nLearn more in the [Agent Skills overview](https://docs.claude.com/en/docs/agents-and-tools/agent-skills/overview).\n\n<Note>\n  For a deep dive into the architecture and real-world applications of Agent Skills, read our engineering blog: [Equipping agents for the real world with Agent Skills](https://www.anthropic.com/engineering/equipping-agents-for-the-real-world-with-agent-skills).\n</Note>\n\n## Create a Skill\n\nSkills are stored as directories containing a `SKILL.md` file.\n\n### Personal Skills\n\nPersonal Skills are available across all your projects. Store them in `~/.claude/skills/`:\n\n```bash  theme={null}\nmkdir -p ~/.claude/skills/my-skill-name\n```\n\n**Use personal Skills for**:\n\n* Your individual workflows and preferences\n* Experimental Skills you're developing\n* Personal productivity tools\n\n### Project Skills\n\nProject Skills are shared with your team. Store them in `.claude/skills/` within your project:\n\n```bash  theme={null}\nmkdir -p .claude/skills/my-skill-name\n```\n\n**Use project Skills for**:\n\n* Team workflows and conventions\n* Project-specific expertise\n* Shared utilities and scripts\n\nProject Skills are checked into git and automatically available to team members.\n\n### Plugin Skills\n\nSkills can also come from [Claude Code plugins](/en/plugins). Plugins may bundle Skills that are automatically available when the plugin is installed. These Skills work the same way as personal and project Skills.\n\n## Write SKILL.md\n\nCreate a `SKILL.md` file with YAML frontmatter and Markdown content:\n\n```yaml  theme={null}\n---\nname: your-skill-name\ndescription: Brief description of what this Skill does and when to use it\n---\n\n# Your Skill Name\n\n## Instructions\nProvide clear, step-by-step guidance for Claude.\n\n## Examples\nShow concrete examples of using this Skill.\n```\n\n**Field requirements**:\n\n* `name`: Must use lowercase letters, numbers, and hyphens only (max 64 characters)\n* `description`: Brief description of what the Skill does and when to use it (max 1024 characters)\n\nThe `description` field is critical for Claude to discover when to use your Skill. It should include both what the Skill does and when Claude should use it.\n\nSee the [best practices guide](https://docs.claude.com/en/docs/agents-and-tools/agent-skills/best-practices) for complete authoring guidance including validation rules.\n\n## Add supporting files\n\nCreate additional files alongside SKILL.md:\n\n```\nmy-skill/\n├── SKILL.md (required)\n├── reference.md (optional documentation)\n├── examples.md (optional examples)\n├── scripts/\n│   └── helper.py (optional utility)\n└── templates/\n    └── template.txt (optional template)\n```\n\nReference these files from SKILL.md:\n\n````markdown  theme={null}\nFor advanced usage, see [reference.md](reference.md).\n\nRun the helper script:\n```bash\npython scripts/helper.py input.txt\n```\n````\n\nClaude reads these files only when needed, using progressive disclosure to manage context efficiently.\n\n## Restrict tool access with allowed-tools\n\nUse the `allowed-tools` frontmatter field to limit which tools Claude can use when a Skill is active:\n\n```yaml  theme={null}\n---\nname: safe-file-reader\ndescription: Read files without making changes. Use when you need read-only file access.\nallowed-tools: Read, Grep, Glob\n---\n\n# Safe File Reader\n\nThis Skill provides read-only file access.\n\n## Instructions\n1. Use Read to view file contents\n2. Use Grep to search within files\n3. Use Glob to find files by pattern\n```\n\nWhen this Skill is active, Claude can only use the specified tools (Read, Grep, Glob) without needing to ask for permission. This is useful for:\n\n* Read-only Skills that shouldn't modify files\n* Skills with limited scope: for example, only data analysis, no file writing\n* Security-sensitive workflows where you want to restrict capabilities\n\nIf `allowed-tools` isn't specified, Claude will ask for permission to use tools as normal, following the standard permission model.\n\n<Note>\n  `allowed-tools` is only supported for Skills in Claude Code.\n</Note>\n\n## View available Skills\n\nSkills are automatically discovered by Claude from three sources:\n\n* Personal Skills: `~/.claude/skills/`\n* Project Skills: `.claude/skills/`\n* Plugin Skills: bundled with installed plugins\n\n**To view all available Skills**, ask Claude directly:\n\n```\nWhat Skills are available?\n```\n\nor\n\n```\nList all available Skills\n```\n\nThis will show all Skills from all sources, including plugin Skills.\n\n**To inspect a specific Skill**, you can also check the filesystem:\n\n```bash  theme={null}\n# List personal Skills\nls ~/.claude/skills/\n\n# List project Skills (if in a project directory)\nls .claude/skills/\n\n# View a specific Skill's content\ncat ~/.claude/skills/my-skill/SKILL.md\n```\n\n## Test a Skill\n\nAfter creating a Skill, test it by asking questions that match your description.\n\n**Example**: If your description mentions \"PDF files\":\n\n```\nCan you help me extract text from this PDF?\n```\n\nClaude autonomously decides to use your Skill if it matches the request—you don't need to explicitly invoke it. The Skill activates automatically based on the context of your question.\n\n## Debug a Skill\n\nIf Claude doesn't use your Skill, check these common issues:\n\n### Make description specific\n\n**Too vague**:\n\n```yaml  theme={null}\ndescription: Helps with documents\n```\n\n**Specific**:\n\n```yaml  theme={null}\ndescription: Extract text and tables from PDF files, fill forms, merge documents. Use when working with PDF files or when the user mentions PDFs, forms, or document extraction.\n```\n\nInclude both what the Skill does and when to use it in the description.\n\n### Verify file path\n\n**Personal Skills**: `~/.claude/skills/skill-name/SKILL.md`\n**Project Skills**: `.claude/skills/skill-name/SKILL.md`\n\nCheck the file exists:\n\n```bash  theme={null}\n# Personal\nls ~/.claude/skills/my-skill/SKILL.md\n\n# Project\nls .claude/skills/my-skill/SKILL.md\n```\n\n### Check YAML syntax\n\nInvalid YAML prevents the Skill from loading. Verify the frontmatter:\n\n```bash  theme={null}\ncat SKILL.md | head -n 10\n```\n\nEnsure:\n\n* Opening `---` on line 1\n* Closing `---` before Markdown content\n* Valid YAML syntax (no tabs, correct indentation)\n\n### View errors\n\nRun Claude Code with debug mode to see Skill loading errors:\n\n```bash  theme={null}\nclaude --debug\n```\n\n## Share Skills with your team\n\n**Recommended approach**: Distribute Skills through [plugins](/en/plugins).\n\nTo share Skills via plugin:\n\n1. Create a plugin with Skills in the `skills/` directory\n2. Add the plugin to a marketplace\n3. Team members install the plugin\n\nFor complete instructions, see [Add Skills to your plugin](/en/plugins#add-skills-to-your-plugin).\n\nYou can also share Skills directly through project repositories:\n\n### Step 1: Add Skill to your project\n\nCreate a project Skill:\n\n```bash  theme={null}\nmkdir -p .claude/skills/team-skill\n# Create SKILL.md\n```\n\n### Step 2: Commit to git\n\n```bash  theme={null}\ngit add .claude/skills/\ngit commit -m \"Add team Skill for PDF processing\"\ngit push\n```\n\n### Step 3: Team members get Skills automatically\n\nWhen team members pull the latest changes, Skills are immediately available:\n\n```bash  theme={null}\ngit pull\nclaude  # Skills are now available\n```\n\n## Update a Skill\n\nEdit SKILL.md directly:\n\n```bash  theme={null}\n# Personal Skill\ncode ~/.claude/skills/my-skill/SKILL.md\n\n# Project Skill\ncode .claude/skills/my-skill/SKILL.md\n```\n\nChanges take effect the next time you start Claude Code. If Claude Code is already running, restart it to load the updates.\n\n## Remove a Skill\n\nDelete the Skill directory:\n\n```bash  theme={null}\n# Personal\nrm -rf ~/.claude/skills/my-skill\n\n# Project\nrm -rf .claude/skills/my-skill\ngit commit -m \"Remove unused Skill\"\n```\n\n## Best practices\n\n### Keep Skills focused\n\nOne Skill should address one capability:\n\n**Focused**:\n\n* \"PDF form filling\"\n* \"Excel data analysis\"\n* \"Git commit messages\"\n\n**Too broad**:\n\n* \"Document processing\" (split into separate Skills)\n* \"Data tools\" (split by data type or operation)\n\n### Write clear descriptions\n\nHelp Claude discover when to use Skills by including specific triggers in your description:\n\n**Clear**:\n\n```yaml  theme={null}\ndescription: Analyze Excel spreadsheets, create pivot tables, and generate charts. Use when working with Excel files, spreadsheets, or analyzing tabular data in .xlsx format.\n```\n\n**Vague**:\n\n```yaml  theme={null}\ndescription: For files\n```\n\n### Test with your team\n\nHave teammates use Skills and provide feedback:\n\n* Does the Skill activate when expected?\n* Are the instructions clear?\n* Are there missing examples or edge cases?\n\n### Document Skill versions\n\nYou can document Skill versions in your SKILL.md content to track changes over time. Add a version history section:\n\n```markdown  theme={null}\n# My Skill\n\n## Version History\n- v2.0.0 (2025-10-01): Breaking changes to API\n- v1.1.0 (2025-09-15): Added new features\n- v1.0.0 (2025-09-01): Initial release\n```\n\nThis helps team members understand what changed between versions.\n\n## Troubleshooting\n\n### Claude doesn't use my Skill\n\n**Symptom**: You ask a relevant question but Claude doesn't use your Skill.\n\n**Check**: Is the description specific enough?\n\nVague descriptions make discovery difficult. Include both what the Skill does and when to use it, with key terms users would mention.\n\n**Too generic**:\n\n```yaml  theme={null}\ndescription: Helps with data\n```\n\n**Specific**:\n\n```yaml  theme={null}\ndescription: Analyze Excel spreadsheets, generate pivot tables, create charts. Use when working with Excel files, spreadsheets, or .xlsx files.\n```\n\n**Check**: Is the YAML valid?\n\nRun validation to check for syntax errors:\n\n```bash  theme={null}\n# View frontmatter\ncat .claude/skills/my-skill/SKILL.md | head -n 15\n\n# Check for common issues\n# - Missing opening or closing ---\n# - Tabs instead of spaces\n# - Unquoted strings with special characters\n```\n\n**Check**: Is the Skill in the correct location?\n\n```bash  theme={null}\n# Personal Skills\nls ~/.claude/skills/*/SKILL.md\n\n# Project Skills\nls .claude/skills/*/SKILL.md\n```\n\n### Skill has errors\n\n**Symptom**: The Skill loads but doesn't work correctly.\n\n**Check**: Are dependencies available?\n\nClaude will automatically install required dependencies (or ask for permission to install them) when it needs them.\n\n**Check**: Do scripts have execute permissions?\n\n```bash  theme={null}\nchmod +x .claude/skills/my-skill/scripts/*.py\n```\n\n**Check**: Are file paths correct?\n\nUse forward slashes (Unix style) in all paths:\n\n**Correct**: `scripts/helper.py`\n**Wrong**: `scripts\\helper.py` (Windows style)\n\n### Multiple Skills conflict\n\n**Symptom**: Claude uses the wrong Skill or seems confused between similar Skills.\n\n**Be specific in descriptions**: Help Claude choose the right Skill by using distinct trigger terms in your descriptions.\n\nInstead of:\n\n```yaml  theme={null}\n# Skill 1\ndescription: For data analysis\n\n# Skill 2\ndescription: For analyzing data\n```\n\nUse:\n\n```yaml  theme={null}\n# Skill 1\ndescription: Analyze sales data in Excel files and CRM exports. Use for sales reports, pipeline analysis, and revenue tracking.\n\n# Skill 2\ndescription: Analyze log files and system metrics data. Use for performance monitoring, debugging, and system diagnostics.\n```\n\n## Examples\n\n### Simple Skill (single file)\n\n```\ncommit-helper/\n└── SKILL.md\n```\n\n```yaml  theme={null}\n---\nname: generating-commit-messages\ndescription: Generates clear commit messages from git diffs. Use when writing commit messages or reviewing staged changes.\n---\n\n# Generating Commit Messages\n\n## Instructions\n\n1. Run `git diff --staged` to see changes\n2. I'll suggest a commit message with:\n   - Summary under 50 characters\n   - Detailed description\n   - Affected components\n\n## Best practices\n\n- Use present tense\n- Explain what and why, not how\n```\n\n### Skill with tool permissions\n\n```\ncode-reviewer/\n└── SKILL.md\n```\n\n```yaml  theme={null}\n---\nname: code-reviewer\ndescription: Review code for best practices and potential issues. Use when reviewing code, checking PRs, or analyzing code quality.\nallowed-tools: Read, Grep, Glob\n---\n\n# Code Reviewer\n\n## Review checklist\n\n1. Code organization and structure\n2. Error handling\n3. Performance considerations\n4. Security concerns\n5. Test coverage\n\n## Instructions\n\n1. Read the target files using Read tool\n2. Search for patterns using Grep\n3. Find related files using Glob\n4. Provide detailed feedback on code quality\n```\n\n### Multi-file Skill\n\n```\npdf-processing/\n├── SKILL.md\n├── FORMS.md\n├── REFERENCE.md\n└── scripts/\n    ├── fill_form.py\n    └── validate.py\n```\n\n**SKILL.md**:\n\n````yaml  theme={null}\n---\nname: pdf-processing\ndescription: Extract text, fill forms, merge PDFs. Use when working with PDF files, forms, or document extraction. Requires pypdf and pdfplumber packages.\n---\n\n# PDF Processing\n\n## Quick start\n\nExtract text:\n```python\nimport pdfplumber\nwith pdfplumber.open(\"doc.pdf\") as pdf:\n    text = pdf.pages[0].extract_text()\n```\n\nFor form filling, see [FORMS.md](FORMS.md).\nFor detailed API reference, see [REFERENCE.md](REFERENCE.md).\n\n## Requirements\n\nPackages must be installed in your environment:\n```bash\npip install pypdf pdfplumber\n```\n````\n\n<Note>\n  List required packages in the description. Packages must be installed in your environment before Claude can use them.\n</Note>\n\nClaude loads additional files only when needed.\n\n## Next steps\n\n<CardGroup cols={2}>\n  <Card title=\"Authoring best practices\" icon=\"lightbulb\" href=\"https://docs.claude.com/en/docs/agents-and-tools/agent-skills/best-practices\">\n    Write Skills that Claude can use effectively\n  </Card>\n\n  <Card title=\"Agent Skills overview\" icon=\"book\" href=\"https://docs.claude.com/en/docs/agents-and-tools/agent-skills/overview\">\n    Learn how Skills work across Claude products\n  </Card>\n\n  <Card title=\"Use Skills in the Agent SDK\" icon=\"cube\" href=\"https://docs.claude.com/en/docs/agent-sdk/skills\">\n    Use Skills programmatically with TypeScript and Python\n  </Card>\n\n  <Card title=\"Get started with Agent Skills\" icon=\"rocket\" href=\"https://docs.claude.com/en/docs/agents-and-tools/agent-skills/quickstart\">\n    Create your first Skill\n  </Card>\n</CardGroup>\n\n\n---\n\n> To find navigation and other pages in this documentation, fetch the llms.txt file at: https://code.claude.com/docs/llms.txt"}]},"isSidechain":true,"agentId":"a93e318"}
{"type":"user","uuid":"9326afe8-9ada-44bf-b53b-280e965f24b4","parentUuid":"ea5d43e8-ef0b-463d-8dd2-66edeafac8dc","timestamp":"2025-12-24T18:49:06.268Z","sessionId":"f968233b-ebe5-4958-aa2d-69a2d8e7413c","cwd":"/Users/yoav/projects/alignment-hive","gitBranch":"main","version":"2.0.76","message":{"role":"user","content":[{"type":"tool_result","tool_use_id":"toolu_01PkmYSgY4XNyXAEoDm9yHBz","content":"# Hooks reference\n\n> This page provides reference documentation for implementing hooks in Claude Code.\n\n<Tip>\n  For a quickstart guide with examples, see [Get started with Claude Code hooks](/en/hooks-guide).\n</Tip>\n\n## Configuration\n\nClaude Code hooks are configured in your [settings files](/en/settings):\n\n* `~/.claude/settings.json` - User settings\n* `.claude/settings.json` - Project settings\n* `.claude/settings.local.json` - Local project settings (not committed)\n* Enterprise managed policy settings\n\n<Note>\n  Enterprise administrators can use `allowManagedHooksOnly` to block user, project, and plugin hooks. See [Hook configuration](/en/settings#hook-configuration).\n</Note>\n\n### Structure\n\nHooks are organized by matchers, where each matcher can have multiple hooks:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"EventName\": [\n      {\n        \"matcher\": \"ToolPattern\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"your-command-here\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n* **matcher**: Pattern to match tool names, case-sensitive (only applicable for\n  `PreToolUse`, `PermissionRequest`, and `PostToolUse`)\n  * Simple strings match exactly: `Write` matches only the Write tool\n  * Supports regex: `Edit|Write` or `Notebook.*`\n  * Use `*` to match all tools. You can also use empty string (`\"\"`) or leave\n    `matcher` blank.\n* **hooks**: Array of hooks to execute when the pattern matches\n  * `type`: Hook execution type - `\"command\"` for bash commands or `\"prompt\"` for LLM-based evaluation\n  * `command`: (For `type: \"command\"`) The bash command to execute (can use `$CLAUDE_PROJECT_DIR` environment variable)\n  * `prompt`: (For `type: \"prompt\"`) The prompt to send to the LLM for evaluation\n  * `timeout`: (Optional) How long a hook should run, in seconds, before canceling that specific hook\n\nFor events like `UserPromptSubmit`, `Stop`, and `SubagentStop`\nthat don't use matchers, you can omit the matcher field:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"UserPromptSubmit\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"/path/to/prompt-validator.py\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### Project-Specific Hook Scripts\n\nYou can use the environment variable `CLAUDE_PROJECT_DIR` (only available when\nClaude Code spawns the hook command) to reference scripts stored in your project,\nensuring they work regardless of Claude's current directory:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"PostToolUse\": [\n      {\n        \"matcher\": \"Write|Edit\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"\\\"$CLAUDE_PROJECT_DIR\\\"/.claude/hooks/check-style.sh\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### Plugin hooks\n\n[Plugins](/en/plugins) can provide hooks that integrate seamlessly with your user and project hooks. Plugin hooks are automatically merged with your configuration when plugins are enabled.\n\n**How plugin hooks work**:\n\n* Plugin hooks are defined in the plugin's `hooks/hooks.json` file or in a file given by a custom path to the `hooks` field.\n* When a plugin is enabled, its hooks are merged with user and project hooks\n* Multiple hooks from different sources can respond to the same event\n* Plugin hooks use the `${CLAUDE_PLUGIN_ROOT}` environment variable to reference plugin files\n\n**Example plugin hook configuration**:\n\n```json  theme={null}\n{\n  \"description\": \"Automatic code formatting\",\n  \"hooks\": {\n    \"PostToolUse\": [\n      {\n        \"matcher\": \"Write|Edit\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"${CLAUDE_PLUGIN_ROOT}/scripts/format.sh\",\n            \"timeout\": 30\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n<Note>\n  Plugin hooks use the same format as regular hooks with an optional `description` field to explain the hook's purpose.\n</Note>\n\n<Note>\n  Plugin hooks run alongside your custom hooks. If multiple hooks match an event, they all execute in parallel.\n</Note>\n\n**Environment variables for plugins**:\n\n* `${CLAUDE_PLUGIN_ROOT}`: Absolute path to the plugin directory\n* `${CLAUDE_PROJECT_DIR}`: Project root directory (same as for project hooks)\n* All standard environment variables are available\n\nSee the [plugin components reference](/en/plugins-reference#hooks) for details on creating plugin hooks.\n\n## Prompt-Based Hooks\n\nIn addition to bash command hooks (`type: \"command\"`), Claude Code supports prompt-based hooks (`type: \"prompt\"`) that use an LLM to evaluate whether to allow or block an action. Prompt-based hooks are currently only supported for `Stop` and `SubagentStop` hooks, where they enable intelligent, context-aware decisions.\n\n### How prompt-based hooks work\n\nInstead of executing a bash command, prompt-based hooks:\n\n1. Send the hook input and your prompt to a fast LLM (Haiku)\n2. The LLM responds with structured JSON containing a decision\n3. Claude Code processes the decision automatically\n\n### Configuration\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"Stop\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"prompt\",\n            \"prompt\": \"Evaluate if Claude should stop: $ARGUMENTS. Check if all tasks are complete.\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n**Fields:**\n\n* `type`: Must be `\"prompt\"`\n* `prompt`: The prompt text to send to the LLM\n  * Use `$ARGUMENTS` as a placeholder for the hook input JSON\n  * If `$ARGUMENTS` is not present, input JSON is appended to the prompt\n* `timeout`: (Optional) Timeout in seconds (default: 30 seconds)\n\n### Response schema\n\nThe LLM must respond with JSON containing:\n\n```json  theme={null}\n{\n  \"decision\": \"approve\" | \"block\",\n  \"reason\": \"Explanation for the decision\",\n  \"continue\": false,  // Optional: stops Claude entirely\n  \"stopReason\": \"Message shown to user\",  // Optional: custom stop message\n  \"systemMessage\": \"Warning or context\"  // Optional: shown to user\n}\n```\n\n**Response fields:**\n\n* `decision`: `\"approve\"` allows the action, `\"block\"` prevents it\n* `reason`: Explanation shown to Claude when decision is `\"block\"`\n* `continue`: (Optional) If `false`, stops Claude's execution entirely\n* `stopReason`: (Optional) Message shown when `continue` is false\n* `systemMessage`: (Optional) Additional message shown to the user\n\n### Supported hook events\n\nPrompt-based hooks work with any hook event, but are most useful for:\n\n* **Stop**: Intelligently decide if Claude should continue working\n* **SubagentStop**: Evaluate if a subagent has completed its task\n* **UserPromptSubmit**: Validate user prompts with LLM assistance\n* **PreToolUse**: Make context-aware permission decisions\n* **PermissionRequest**: Intelligently allow or deny permission dialogs\n\n### Example: Intelligent Stop hook\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"Stop\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"prompt\",\n            \"prompt\": \"You are evaluating whether Claude should stop working. Context: $ARGUMENTS\\n\\nAnalyze the conversation and determine if:\\n1. All user-requested tasks are complete\\n2. Any errors need to be addressed\\n3. Follow-up work is needed\\n\\nRespond with JSON: {\\\"decision\\\": \\\"approve\\\" or \\\"block\\\", \\\"reason\\\": \\\"your explanation\\\"}\",\n            \"timeout\": 30\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### Example: SubagentStop with custom logic\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"SubagentStop\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"prompt\",\n            \"prompt\": \"Evaluate if this subagent should stop. Input: $ARGUMENTS\\n\\nCheck if:\\n- The subagent completed its assigned task\\n- Any errors occurred that need fixing\\n- Additional context gathering is needed\\n\\nReturn: {\\\"decision\\\": \\\"approve\\\" or \\\"block\\\", \\\"reason\\\": \\\"explanation\\\"}\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### Comparison with bash command hooks\n\n| Feature               | Bash Command Hooks      | Prompt-Based Hooks             |\n| --------------------- | ----------------------- | ------------------------------ |\n| **Execution**         | Runs bash script        | Queries LLM                    |\n| **Decision logic**    | You implement in code   | LLM evaluates context          |\n| **Setup complexity**  | Requires script file    | Configure prompt               |\n| **Context awareness** | Limited to script logic | Natural language understanding |\n| **Performance**       | Fast (local execution)  | Slower (API call)              |\n| **Use case**          | Deterministic rules     | Context-aware decisions        |\n\n### Best practices\n\n* **Be specific in prompts**: Clearly state what you want the LLM to evaluate\n* **Include decision criteria**: List the factors the LLM should consider\n* **Test your prompts**: Verify the LLM makes correct decisions for your use cases\n* **Set appropriate timeouts**: Default is 30 seconds, adjust if needed\n* **Use for complex decisions**: Bash hooks are better for simple, deterministic rules\n\nSee the [plugin components reference](/en/plugins-reference#hooks) for details on creating plugin hooks.\n\n## Hook Events\n\n### PreToolUse\n\nRuns after Claude creates tool parameters and before processing the tool call.\n\n**Common matchers:**\n\n* `Task` - Subagent tasks (see [subagents documentation](/en/sub-agents))\n* `Bash` - Shell commands\n* `Glob` - File pattern matching\n* `Grep` - Content search\n* `Read` - File reading\n* `Edit` - File editing\n* `Write` - File writing\n* `WebFetch`, `WebSearch` - Web operations\n\nUse [PreToolUse decision control](#pretooluse-decision-control) to allow, deny, or ask for permission to use the tool.\n\n### PermissionRequest\n\nRuns when the user is shown a permission dialog.\nUse [PermissionRequest decision control](#permissionrequest-decision-control) to allow or deny on behalf of the user.\n\nRecognizes the same matcher values as PreToolUse.\n\n### PostToolUse\n\nRuns immediately after a tool completes successfully.\n\nRecognizes the same matcher values as PreToolUse.\n\n### Notification\n\nRuns when Claude Code sends notifications. Supports matchers to filter by notification type.\n\n**Common matchers:**\n\n* `permission_prompt` - Permission requests from Claude Code\n* `idle_prompt` - When Claude is waiting for user input (after 60+ seconds of idle time)\n* `auth_success` - Authentication success notifications\n* `elicitation_dialog` - When Claude Code needs input for MCP tool elicitation\n\nYou can use matchers to run different hooks for different notification types, or omit the matcher to run hooks for all notifications.\n\n**Example: Different notifications for different types**\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"Notification\": [\n      {\n        \"matcher\": \"permission_prompt\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"/path/to/permission-alert.sh\"\n          }\n        ]\n      },\n      {\n        \"matcher\": \"idle_prompt\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"/path/to/idle-notification.sh\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### UserPromptSubmit\n\nRuns when the user submits a prompt, before Claude processes it. This allows you\nto add additional context based on the prompt/conversation, validate prompts, or\nblock certain types of prompts.\n\n### Stop\n\nRuns when the main Claude Code agent has finished responding. Does not run if\nthe stoppage occurred due to a user interrupt.\n\n### SubagentStop\n\nRuns when a Claude Code subagent (Task tool call) has finished responding.\n\n### PreCompact\n\nRuns before Claude Code is about to run a compact operation.\n\n**Matchers:**\n\n* `manual` - Invoked from `/compact`\n* `auto` - Invoked from auto-compact (due to full context window)\n\n### SessionStart\n\nRuns when Claude Code starts a new session or resumes an existing session (which\ncurrently does start a new session under the hood). Useful for loading in\ndevelopment context like existing issues or recent changes to your codebase, installing dependencies, or setting up environment variables.\n\n**Matchers:**\n\n* `startup` - Invoked from startup\n* `resume` - Invoked from `--resume`, `--continue`, or `/resume`\n* `clear` - Invoked from `/clear`\n* `compact` - Invoked from auto or manual compact.\n\n#### Persisting environment variables\n\nSessionStart hooks have access to the `CLAUDE_ENV_FILE` environment variable, which provides a file path where you can persist environment variables for subsequent bash commands.\n\n**Example: Setting individual environment variables**\n\n```bash  theme={null}\n#!/bin/bash\n\nif [ -n \"$CLAUDE_ENV_FILE\" ]; then\n  echo 'export NODE_ENV=production' >> \"$CLAUDE_ENV_FILE\"\n  echo 'export API_KEY=your-api-key' >> \"$CLAUDE_ENV_FILE\"\n  echo 'export PATH=\"$PATH:./node_modules/.bin\"' >> \"$CLAUDE_ENV_FILE\"\nfi\n\nexit 0\n```\n\n**Example: Persisting all environment changes from the hook**\n\nWhen your setup modifies the environment (for example, `nvm use`), capture and persist all changes by diffing the environment:\n\n```bash  theme={null}\n#!/bin/bash\n\nENV_BEFORE=$(export -p | sort)\n\n# Run your setup commands that modify the environment\nsource ~/.nvm/nvm.sh\nnvm use 20\n\nif [ -n \"$CLAUDE_ENV_FILE\" ]; then\n  ENV_AFTER=$(export -p | sort)\n  comm -13 <(echo \"$ENV_BEFORE\") <(echo \"$ENV_AFTER\") >> \"$CLAUDE_ENV_FILE\"\nfi\n\nexit 0\n```\n\nAny variables written to this file will be available in all subsequent bash commands that Claude Code executes during the session.\n\n<Note>\n  `CLAUDE_ENV_FILE` is only available for SessionStart hooks. Other hook types do not have access to this variable.\n</Note>\n\n### SessionEnd\n\nRuns when a Claude Code session ends. Useful for cleanup tasks, logging session\nstatistics, or saving session state.\n\nThe `reason` field in the hook input will be one of:\n\n* `clear` - Session cleared with /clear command\n* `logout` - User logged out\n* `prompt_input_exit` - User exited while prompt input was visible\n* `other` - Other exit reasons\n\n## Hook Input\n\nHooks receive JSON data via stdin containing session information and\nevent-specific data:\n\n```typescript  theme={null}\n{\n  // Common fields\n  session_id: string\n  transcript_path: string  // Path to conversation JSON\n  cwd: string              // The current working directory when the hook is invoked\n  permission_mode: string  // Current permission mode: \"default\", \"plan\", \"acceptEdits\", or \"bypassPermissions\"\n\n  // Event-specific fields\n  hook_event_name: string\n  ...\n}\n```\n\n### PreToolUse Input\n\nThe exact schema for `tool_input` depends on the tool.\n\n```json  theme={null}\n{\n  \"session_id\": \"abc123\",\n  \"transcript_path\": \"/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl\",\n  \"cwd\": \"/Users/...\",\n  \"permission_mode\": \"default\",\n  \"hook_event_name\": \"PreToolUse\",\n  \"tool_name\": \"Write\",\n  \"tool_input\": {\n    \"file_path\": \"/path/to/file.txt\",\n    \"content\": \"file content\"\n  },\n  \"tool_use_id\": \"toolu_01ABC123...\"\n}\n```\n\n### PostToolUse Input\n\nThe exact schema for `tool_input` and `tool_response` depends on the tool.\n\n```json  theme={null}\n{\n  \"session_id\": \"abc123\",\n  \"transcript_path\": \"/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl\",\n  \"cwd\": \"/Users/...\",\n  \"permission_mode\": \"default\",\n  \"hook_event_name\": \"PostToolUse\",\n  \"tool_name\": \"Write\",\n  \"tool_input\": {\n    \"file_path\": \"/path/to/file.txt\",\n    \"content\": \"file content\"\n  },\n  \"tool_response\": {\n    \"filePath\": \"/path/to/file.txt\",\n    \"success\": true\n  },\n  \"tool_use_id\": \"toolu_01ABC123...\"\n}\n```\n\n### Notification Input\n\n```json  theme={null}\n{\n  \"session_id\": \"abc123\",\n  \"transcript_path\": \"/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl\",\n  \"cwd\": \"/Users/...\",\n  \"permission_mode\": \"default\",\n  \"hook_event_name\": \"Notification\",\n  \"message\": \"Claude needs your permission to use Bash\",\n  \"notification_type\": \"permission_prompt\"\n}\n```\n\n### UserPromptSubmit Input\n\n```json  theme={null}\n{\n  \"session_id\": \"abc123\",\n  \"transcript_path\": \"/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl\",\n  \"cwd\": \"/Users/...\",\n  \"permission_mode\": \"default\",\n  \"hook_event_name\": \"UserPromptSubmit\",\n  \"prompt\": \"Write a function to calculate the factorial of a number\"\n}\n```\n\n### Stop and SubagentStop Input\n\n`stop_hook_active` is true when Claude Code is already continuing as a result of\na stop hook. Check this value or process the transcript to prevent Claude Code\nfrom running indefinitely.\n\n```json  theme={null}\n{\n  \"session_id\": \"abc123\",\n  \"transcript_path\": \"~/.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl\",\n  \"permission_mode\": \"default\",\n  \"hook_event_name\": \"Stop\",\n  \"stop_hook_active\": true\n}\n```\n\n### PreCompact Input\n\nFor `manual`, `custom_instructions` comes from what the user passes into\n`/compact`. For `auto`, `custom_instructions` is empty.\n\n```json  theme={null}\n{\n  \"session_id\": \"abc123\",\n  \"transcript_path\": \"~/.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl\",\n  \"permission_mode\": \"default\",\n  \"hook_event_name\": \"PreCompact\",\n  \"trigger\": \"manual\",\n  \"custom_instructions\": \"\"\n}\n```\n\n### SessionStart Input\n\n```json  theme={null}\n{\n  \"session_id\": \"abc123\",\n  \"transcript_path\": \"~/.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl\",\n  \"permission_mode\": \"default\",\n  \"hook_event_name\": \"SessionStart\",\n  \"source\": \"startup\"\n}\n```\n\n### SessionEnd Input\n\n```json  theme={null}\n{\n  \"session_id\": \"abc123\",\n  \"transcript_path\": \"~/.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl\",\n  \"cwd\": \"/Users/...\",\n  \"permission_mode\": \"default\",\n  \"hook_event_name\": \"SessionEnd\",\n  \"reason\": \"exit\"\n}\n```\n\n## Hook Output\n\nThere are two mutually exclusive ways for hooks to return output back to Claude Code. The output\ncommunicates whether to block and any feedback that should be shown to Claude\nand the user.\n\n### Simple: Exit Code\n\nHooks communicate status through exit codes, stdout, and stderr:\n\n* **Exit code 0**: Success. `stdout` is shown to the user in verbose mode\n  (ctrl+o), except for `UserPromptSubmit` and `SessionStart`, where stdout is\n  added to the context. JSON output in `stdout` is parsed for structured control\n  (see [Advanced: JSON Output](#advanced-json-output)).\n* **Exit code 2**: Blocking error. Only `stderr` is used as the error message\n  and fed back to Claude. The format is `[command]: {stderr}`. JSON in `stdout`\n  is **not** processed for exit code 2. See per-hook-event behavior below.\n* **Other exit codes**: Non-blocking error. `stderr` is shown to the user in verbose mode (ctrl+o) with\n  format `Failed with non-blocking status code: {stderr}`. If `stderr` is empty,\n  it shows `No stderr output`. Execution continues.\n\n<Warning>\n  Reminder: Claude Code does not see stdout if the exit code is 0, except for\n  the `UserPromptSubmit` hook where stdout is injected as context.\n</Warning>\n\n#### Exit Code 2 Behavior\n\n| Hook Event          | Behavior                                                           |\n| ------------------- | ------------------------------------------------------------------ |\n| `PreToolUse`        | Blocks the tool call, shows stderr to Claude                       |\n| `PermissionRequest` | Denies the permission, shows stderr to Claude                      |\n| `PostToolUse`       | Shows stderr to Claude (tool already ran)                          |\n| `Notification`      | N/A, shows stderr to user only                                     |\n| `UserPromptSubmit`  | Blocks prompt processing, erases prompt, shows stderr to user only |\n| `Stop`              | Blocks stoppage, shows stderr to Claude                            |\n| `SubagentStop`      | Blocks stoppage, shows stderr to Claude subagent                   |\n| `PreCompact`        | N/A, shows stderr to user only                                     |\n| `SessionStart`      | N/A, shows stderr to user only                                     |\n| `SessionEnd`        | N/A, shows stderr to user only                                     |\n\n### Advanced: JSON Output\n\nHooks can return structured JSON in `stdout` for more sophisticated control.\n\n<Warning>\n  JSON output is only processed when the hook exits with code 0. If your hook\n  exits with code 2 (blocking error), `stderr` text is used directly—any JSON in `stdout`\n  is ignored. For other non-zero exit codes, only `stderr` is shown to the user in verbose mode (ctrl+o).\n</Warning>\n\n#### Common JSON Fields\n\nAll hook types can include these optional fields:\n\n```json  theme={null}\n{\n  \"continue\": true, // Whether Claude should continue after hook execution (default: true)\n  \"stopReason\": \"string\", // Message shown when continue is false\n\n  \"suppressOutput\": true, // Hide stdout from transcript mode (default: false)\n  \"systemMessage\": \"string\" // Optional warning message shown to the user\n}\n```\n\nIf `continue` is false, Claude stops processing after the hooks run.\n\n* For `PreToolUse`, this is different from `\"permissionDecision\": \"deny\"`, which\n  only blocks a specific tool call and provides automatic feedback to Claude.\n* For `PostToolUse`, this is different from `\"decision\": \"block\"`, which\n  provides automated feedback to Claude.\n* For `UserPromptSubmit`, this prevents the prompt from being processed.\n* For `Stop` and `SubagentStop`, this takes precedence over any\n  `\"decision\": \"block\"` output.\n* In all cases, `\"continue\" = false` takes precedence over any\n  `\"decision\": \"block\"` output.\n\n`stopReason` accompanies `continue` with a reason shown to the user, not shown\nto Claude.\n\n#### `PreToolUse` Decision Control\n\n`PreToolUse` hooks can control whether a tool call proceeds.\n\n* `\"allow\"` bypasses the permission system. `permissionDecisionReason` is shown\n  to the user but not to Claude.\n* `\"deny\"` prevents the tool call from executing. `permissionDecisionReason` is\n  shown to Claude.\n* `\"ask\"` asks the user to confirm the tool call in the UI.\n  `permissionDecisionReason` is shown to the user but not to Claude.\n\nAdditionally, hooks can modify tool inputs before execution using `updatedInput`:\n\n* `updatedInput` allows you to modify the tool's input parameters before the tool executes.\n* This is most useful with `\"permissionDecision\": \"allow\"` to modify and approve tool calls.\n\n```json  theme={null}\n{\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"PreToolUse\",\n    \"permissionDecision\": \"allow\"\n    \"permissionDecisionReason\": \"My reason here\",\n    \"updatedInput\": {\n      \"field_to_modify\": \"new value\"\n    }\n  }\n}\n```\n\n<Note>\n  The `decision` and `reason` fields are deprecated for PreToolUse hooks.\n  Use `hookSpecificOutput.permissionDecision` and\n  `hookSpecificOutput.permissionDecisionReason` instead. The deprecated fields\n  `\"approve\"` and `\"block\"` map to `\"allow\"` and `\"deny\"` respectively.\n</Note>\n\n#### `PermissionRequest` Decision Control\n\n`PermissionRequest` hooks can allow or deny permission requests shown to the user.\n\n* For `\"behavior\": \"allow\"` you can also optionally pass in an `\"updatedInput\"` that modifies the tool's input parameters before the tool executes.\n* For `\"behavior\": \"deny\"` you can also optionally pass in a `\"message\"` string that tells the model why the permission was denied, and a boolean `\"interrupt\"` which will stop Claude.\n\n```json  theme={null}\n{\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"PermissionRequest\",\n    \"decision\": {\n      \"behavior\": \"allow\",\n      \"updatedInput\": {\n        \"command\": \"npm run lint\"\n      }\n    }\n  }\n}\n```\n\n#### `PostToolUse` Decision Control\n\n`PostToolUse` hooks can provide feedback to Claude after tool execution.\n\n* `\"block\"` automatically prompts Claude with `reason`.\n* `undefined` does nothing. `reason` is ignored.\n* `\"hookSpecificOutput.additionalContext\"` adds context for Claude to consider.\n\n```json  theme={null}\n{\n  \"decision\": \"block\" | undefined,\n  \"reason\": \"Explanation for decision\",\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"PostToolUse\",\n    \"additionalContext\": \"Additional information for Claude\"\n  }\n}\n```\n\n#### `UserPromptSubmit` Decision Control\n\n`UserPromptSubmit` hooks can control whether a user prompt is processed and add context.\n\n**Adding context (exit code 0):**\nThere are two ways to add context to the conversation:\n\n1. **Plain text stdout** (simpler): Any non-JSON text written to stdout is added\n   as context. This is the easiest way to inject information.\n\n2. **JSON with `additionalContext`** (structured): Use the JSON format below for\n   more control. The `additionalContext` field is added as context.\n\nBoth methods work with exit code 0. Plain stdout is shown as hook output in\nthe transcript; `additionalContext` is added more discretely.\n\n**Blocking prompts:**\n\n* `\"decision\": \"block\"` prevents the prompt from being processed. The submitted\n  prompt is erased from context. `\"reason\"` is shown to the user but not added\n  to context.\n* `\"decision\": undefined` (or omitted) allows the prompt to proceed normally.\n\n```json  theme={null}\n{\n  \"decision\": \"block\" | undefined,\n  \"reason\": \"Explanation for decision\",\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"UserPromptSubmit\",\n    \"additionalContext\": \"My additional context here\"\n  }\n}\n```\n\n<Note>\n  The JSON format isn't required for simple use cases. To add context, you can print plain text to stdout with exit code 0. Use JSON when you need to\n  block prompts or want more structured control.\n</Note>\n\n#### `Stop`/`SubagentStop` Decision Control\n\n`Stop` and `SubagentStop` hooks can control whether Claude must continue.\n\n* `\"block\"` prevents Claude from stopping. You must populate `reason` for Claude\n  to know how to proceed.\n* `undefined` allows Claude to stop. `reason` is ignored.\n\n```json  theme={null}\n{\n  \"decision\": \"block\" | undefined,\n  \"reason\": \"Must be provided when Claude is blocked from stopping\"\n}\n```\n\n#### `SessionStart` Decision Control\n\n`SessionStart` hooks allow you to load in context at the start of a session.\n\n* `\"hookSpecificOutput.additionalContext\"` adds the string to the context.\n* Multiple hooks' `additionalContext` values are concatenated.\n\n```json  theme={null}\n{\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"SessionStart\",\n    \"additionalContext\": \"My additional context here\"\n  }\n}\n```\n\n#### `SessionEnd` Decision Control\n\n`SessionEnd` hooks run when a session ends. They cannot block session termination\nbut can perform cleanup tasks.\n\n#### Exit Code Example: Bash Command Validation\n\n```python  theme={null}\n#!/usr/bin/env python3\nimport json\nimport re\nimport sys\n\n# Define validation rules as a list of (regex pattern, message) tuples\nVALIDATION_RULES = [\n    (\n        r\"\\bgrep\\b(?!.*\\|)\",\n        \"Use 'rg' (ripgrep) instead of 'grep' for better performance and features\",\n    ),\n    (\n        r\"\\bfind\\s+\\S+\\s+-name\\b\",\n        \"Use 'rg --files | rg pattern' or 'rg --files -g pattern' instead of 'find -name' for better performance\",\n    ),\n]\n\n\ndef validate_command(command: str) -> list[str]:\n    issues = []\n    for pattern, message in VALIDATION_RULES:\n        if re.search(pattern, command):\n            issues.append(message)\n    return issues\n\n\ntry:\n    input_data = json.load(sys.stdin)\nexcept json.JSONDecodeError as e:\n    print(f\"Error: Invalid JSON input: {e}\", file=sys.stderr)\n    sys.exit(1)\n\ntool_name = input_data.get(\"tool_name\", \"\")\ntool_input = input_data.get(\"tool_input\", {})\ncommand = tool_input.get(\"command\", \"\")\n\nif tool_name != \"Bash\" or not command:\n    sys.exit(1)\n\n# Validate the command\nissues = validate_command(command)\n\nif issues:\n    for message in issues:\n        print(f\"• {message}\", file=sys.stderr)\n    # Exit code 2 blocks tool call and shows stderr to Claude\n    sys.exit(2)\n```\n\n#### JSON Output Example: UserPromptSubmit to Add Context and Validation\n\n<Note>\n  For `UserPromptSubmit` hooks, you can inject context using either method:\n\n  * **Plain text stdout** with exit code 0: Simplest approach, prints text\n  * **JSON output** with exit code 0: Use `\"decision\": \"block\"` to reject prompts,\n    or `additionalContext` for structured context injection\n\n  Remember: Exit code 2 only uses `stderr` for the error message. To block using\n  JSON (with a custom reason), use `\"decision\": \"block\"` with exit code 0.\n</Note>\n\n```python  theme={null}\n#!/usr/bin/env python3\nimport json\nimport sys\nimport re\nimport datetime\n\n# Load input from stdin\ntry:\n    input_data = json.load(sys.stdin)\nexcept json.JSONDecodeError as e:\n    print(f\"Error: Invalid JSON input: {e}\", file=sys.stderr)\n    sys.exit(1)\n\nprompt = input_data.get(\"prompt\", \"\")\n\n# Check for sensitive patterns\nsensitive_patterns = [\n    (r\"(?i)\\b(password|secret|key|token)\\s*[:=]\", \"Prompt contains potential secrets\"),\n]\n\nfor pattern, message in sensitive_patterns:\n    if re.search(pattern, prompt):\n        # Use JSON output to block with a specific reason\n        output = {\n            \"decision\": \"block\",\n            \"reason\": f\"Security policy violation: {message}. Please rephrase your request without sensitive information.\"\n        }\n        print(json.dumps(output))\n        sys.exit(0)\n\n# Add current time to context\ncontext = f\"Current time: {datetime.datetime.now()}\"\nprint(context)\n\n\"\"\"\nThe following is also equivalent:\nprint(json.dumps({\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"UserPromptSubmit\",\n    \"additionalContext\": context,\n  },\n}))\n\"\"\"\n\n# Allow the prompt to proceed with the additional context\nsys.exit(0)\n```\n\n#### JSON Output Example: PreToolUse with Approval\n\n```python  theme={null}\n#!/usr/bin/env python3\nimport json\nimport sys\n\n# Load input from stdin\ntry:\n    input_data = json.load(sys.stdin)\nexcept json.JSONDecodeError as e:\n    print(f\"Error: Invalid JSON input: {e}\", file=sys.stderr)\n    sys.exit(1)\n\ntool_name = input_data.get(\"tool_name\", \"\")\ntool_input = input_data.get(\"tool_input\", {})\n\n# Example: Auto-approve file reads for documentation files\nif tool_name == \"Read\":\n    file_path = tool_input.get(\"file_path\", \"\")\n    if file_path.endswith((\".md\", \".mdx\", \".txt\", \".json\")):\n        # Use JSON output to auto-approve the tool call\n        output = {\n            \"decision\": \"approve\",\n            \"reason\": \"Documentation file auto-approved\",\n            \"suppressOutput\": True  # Don't show in verbose mode\n        }\n        print(json.dumps(output))\n        sys.exit(0)\n\n# For other cases, let the normal permission flow proceed\nsys.exit(0)\n```\n\n## Working with MCP Tools\n\nClaude Code hooks work seamlessly with\n[Model Context Protocol (MCP) tools](/en/mcp). When MCP servers\nprovide tools, they appear with a special naming pattern that you can match in\nyour hooks.\n\n### MCP Tool Naming\n\nMCP tools follow the pattern `mcp__<server>__<tool>`, for example:\n\n* `mcp__memory__create_entities` - Memory server's create entities tool\n* `mcp__filesystem__read_file` - Filesystem server's read file tool\n* `mcp__github__search_repositories` - GitHub server's search tool\n\n### Configuring Hooks for MCP Tools\n\nYou can target specific MCP tools or entire MCP servers:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"PreToolUse\": [\n      {\n        \"matcher\": \"mcp__memory__.*\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"echo 'Memory operation initiated' >> ~/mcp-operations.log\"\n          }\n        ]\n      },\n      {\n        \"matcher\": \"mcp__.*__write.*\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"/home/user/scripts/validate-mcp-write.py\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n## Examples\n\n<Tip>\n  For practical examples including code formatting, notifications, and file protection, see [More Examples](/en/hooks-guide#more-examples) in the get started guide.\n</Tip>\n\n## Security Considerations\n\n### Disclaimer\n\n**USE AT YOUR OWN RISK**: Claude Code hooks execute arbitrary shell commands on\nyour system automatically. By using hooks, you acknowledge that:\n\n* You are solely responsible for the commands you configure\n* Hooks can modify, delete, or access any files your user account can access\n* Malicious or poorly written hooks can cause data loss or system damage\n* Anthropic provides no warranty and assumes no liability for any damages\n  resulting from hook usage\n* You should thoroughly test hooks in a safe environment before production use\n\nAlways review and understand any hook commands before adding them to your\nconfiguration.\n\n### Security Best Practices\n\nHere are some key practices for writing more secure hooks:\n\n1. **Validate and sanitize inputs** - Never trust input data blindly\n2. **Always quote shell variables** - Use `\"$VAR\"` not `$VAR`\n3. **Block path traversal** - Check for `..` in file paths\n4. **Use absolute paths** - Specify full paths for scripts (use\n   \"\\$CLAUDE\\_PROJECT\\_DIR\" for the project path)\n5. **Skip sensitive files** - Avoid `.env`, `.git/`, keys, etc.\n\n### Configuration Safety\n\nDirect edits to hooks in settings files don't take effect immediately. Claude\nCode:\n\n1. Captures a snapshot of hooks at startup\n2. Uses this snapshot throughout the session\n3. Warns if hooks are modified externally\n4. Requires review in `/hooks` menu for changes to apply\n\nThis prevents malicious hook modifications from affecting your current session.\n\n## Hook Execution Details\n\n* **Timeout**: 60-second execution limit by default, configurable per command.\n  * A timeout for an individual command does not affect the other commands.\n* **Parallelization**: All matching hooks run in parallel\n* **Deduplication**: Multiple identical hook commands are deduplicated automatically\n* **Environment**: Runs in current directory with Claude Code's environment\n  * The `CLAUDE_PROJECT_DIR` environment variable is available and contains the\n    absolute path to the project root directory (where Claude Code was started)\n  * The `CLAUDE_CODE_REMOTE` environment variable indicates whether the hook is running in a remote (web) environment (`\"true\"`) or local CLI environment (not set or empty). Use this to run different logic based on execution context.\n* **Input**: JSON via stdin\n* **Output**:\n  * PreToolUse/PermissionRequest/PostToolUse/Stop/SubagentStop: Progress shown in verbose mode (ctrl+o)\n  * Notification/SessionEnd: Logged to debug only (`--debug`)\n  * UserPromptSubmit/SessionStart: stdout added as context for Claude\n\n## Debugging\n\n### Basic Troubleshooting\n\nIf your hooks aren't working:\n\n1. **Check configuration** - Run `/hooks` to see if your hook is registered\n2. **Verify syntax** - Ensure your JSON settings are valid\n3. **Test commands** - Run hook commands manually first\n4. **Check permissions** - Make sure scripts are executable\n5. **Review logs** - Use `claude --debug` to see hook execution details\n\nCommon issues:\n\n* **Quotes not escaped** - Use `\\\"` inside JSON strings\n* **Wrong matcher** - Check tool names match exactly (case-sensitive)\n* **Command not found** - Use full paths for scripts\n\n### Advanced Debugging\n\nFor complex hook issues:\n\n1. **Inspect hook execution** - Use `claude --debug` to see detailed hook\n   execution\n2. **Validate JSON schemas** - Test hook input/output with external tools\n3. **Check environment variables** - Verify Claude Code's environment is correct\n4. **Test edge cases** - Try hooks with unusual file paths or inputs\n5. **Monitor system resources** - Check for resource exhaustion during hook\n   execution\n6. **Use structured logging** - Implement logging in your hook scripts\n\n### Debug Output Example\n\nUse `claude --debug` to see hook execution details:\n\n```\n[DEBUG] Executing hooks for PostToolUse:Write\n[DEBUG] Getting matching hook commands for PostToolUse with query: Write\n[DEBUG] Found 1 hook matchers in settings\n[DEBUG] Matched 1 hooks for query \"Write\"\n[DEBUG] Found 1 hook commands to execute\n[DEBUG] Executing hook command: <Your command> with timeout 60000ms\n[DEBUG] Hook command completed with status 0: <Your stdout>\n```\n\nProgress messages appear in verbose mode (ctrl+o) showing:\n\n* Which hook is running\n* Command being executed\n* Success/failure status\n* Output or error messages\n\n\n---\n\n> To find navigation and other pages in this documentation, fetch the llms.txt file at: https://code.claude.com/docs/llms.txt"}]},"isSidechain":true,"agentId":"a93e318"}
{"type":"user","uuid":"9c98de46-0708-435a-b2b2-fe19c0299cb6","parentUuid":"9326afe8-9ada-44bf-b53b-280e965f24b4","timestamp":"2025-12-24T18:49:06.311Z","sessionId":"f968233b-ebe5-4958-aa2d-69a2d8e7413c","cwd":"/Users/yoav/projects/alignment-hive","gitBranch":"main","version":"2.0.76","message":{"role":"user","content":[{"type":"tool_result","tool_use_id":"toolu_01GD29b7M1NsKtHwend75MvA","content":"# Get started with Claude Code hooks\n\n> Learn how to customize and extend Claude Code's behavior by registering shell commands\n\nClaude Code hooks are user-defined shell commands that execute at various points\nin Claude Code's lifecycle. Hooks provide deterministic control over Claude\nCode's behavior, ensuring certain actions always happen rather than relying on\nthe LLM to choose to run them.\n\n<Tip>\n  For reference documentation on hooks, see [Hooks reference](/en/hooks).\n</Tip>\n\nExample use cases for hooks include:\n\n* **Notifications**: Customize how you get notified when Claude Code is awaiting\n  your input or permission to run something.\n* **Automatic formatting**: Run `prettier` on .ts files, `gofmt` on .go files,\n  etc. after every file edit.\n* **Logging**: Track and count all executed commands for compliance or\n  debugging.\n* **Feedback**: Provide automated feedback when Claude Code produces code that\n  does not follow your codebase conventions.\n* **Custom permissions**: Block modifications to production files or sensitive\n  directories.\n\nBy encoding these rules as hooks rather than prompting instructions, you turn\nsuggestions into app-level code that executes every time it is expected to run.\n\n<Warning>\n  You must consider the security implication of hooks as you add them, because hooks run automatically during the agent loop with your current environment's credentials.\n  For example, malicious hooks code can exfiltrate your data. Always review your hooks implementation before registering them.\n\n  For full security best practices, see [Security Considerations](/en/hooks#security-considerations) in the hooks reference documentation.\n</Warning>\n\n## Hook Events Overview\n\nClaude Code provides several hook events that run at different points in the\nworkflow:\n\n* **PreToolUse**: Runs before tool calls (can block them)\n* **PermissionRequest**: Runs when a permission dialog is shown (can allow or deny)\n* **PostToolUse**: Runs after tool calls complete\n* **UserPromptSubmit**: Runs when the user submits a prompt, before Claude processes it\n* **Notification**: Runs when Claude Code sends notifications\n* **Stop**: Runs when Claude Code finishes responding\n* **SubagentStop**: Runs when subagent tasks complete\n* **PreCompact**: Runs before Claude Code is about to run a compact operation\n* **SessionStart**: Runs when Claude Code starts a new session or resumes an existing session\n* **SessionEnd**: Runs when Claude Code session ends\n\nEach event receives different data and can control Claude's behavior in\ndifferent ways.\n\n## Quickstart\n\nIn this quickstart, you'll add a hook that logs the shell commands that Claude\nCode runs.\n\n### Prerequisites\n\nInstall `jq` for JSON processing in the command line.\n\n### Step 1: Open hooks configuration\n\nRun the `/hooks` [slash command](/en/slash-commands) and select\nthe `PreToolUse` hook event.\n\n`PreToolUse` hooks run before tool calls and can block them while providing\nClaude feedback on what to do differently.\n\n### Step 2: Add a matcher\n\nSelect `+ Add new matcher…` to run your hook only on Bash tool calls.\n\nType `Bash` for the matcher.\n\n<Note>You can use `*` to match all tools.</Note>\n\n### Step 3: Add the hook\n\nSelect `+ Add new hook…` and enter this command:\n\n```bash  theme={null}\njq -r '\"\\(.tool_input.command) - \\(.tool_input.description // \"No description\")\"' >> ~/.claude/bash-command-log.txt\n```\n\n### Step 4: Save your configuration\n\nFor storage location, select `User settings` since you're logging to your home\ndirectory. This hook will then apply to all projects, not just your current\nproject.\n\nThen press `Esc` until you return to the REPL. Your hook is now registered.\n\n### Step 5: Verify your hook\n\nRun `/hooks` again or check `~/.claude/settings.json` to see your configuration:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"PreToolUse\": [\n      {\n        \"matcher\": \"Bash\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"jq -r '\\\"\\\\(.tool_input.command) - \\\\(.tool_input.description // \\\"No description\\\")\\\"' >> ~/.claude/bash-command-log.txt\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### Step 6: Test your hook\n\nAsk Claude to run a simple command like `ls` and check your log file:\n\n```bash  theme={null}\ncat ~/.claude/bash-command-log.txt\n```\n\nYou should see entries like:\n\n```\nls - Lists files and directories\n```\n\n## More Examples\n\n<Note>\n  For a complete example implementation, see the [bash command validator example](https://github.com/anthropics/claude-code/blob/main/examples/hooks/bash_command_validator_example.py) in our public codebase.\n</Note>\n\n### Code Formatting Hook\n\nAutomatically format TypeScript files after editing:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"PostToolUse\": [\n      {\n        \"matcher\": \"Edit|Write\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"jq -r '.tool_input.file_path' | { read file_path; if echo \\\"$file_path\\\" | grep -q '\\\\.ts$'; then npx prettier --write \\\"$file_path\\\"; fi; }\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### Markdown Formatting Hook\n\nAutomatically fix missing language tags and formatting issues in markdown files:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"PostToolUse\": [\n      {\n        \"matcher\": \"Edit|Write\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"\\\"$CLAUDE_PROJECT_DIR\\\"/.claude/hooks/markdown_formatter.py\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\nCreate `.claude/hooks/markdown_formatter.py` with this content:\n\n````python  theme={null}\n#!/usr/bin/env python3\n\"\"\"\nMarkdown formatter for Claude Code output.\nFixes missing language tags and spacing issues while preserving code content.\n\"\"\"\nimport json\nimport sys\nimport re\nimport os\n\ndef detect_language(code):\n    \"\"\"Best-effort language detection from code content.\"\"\"\n    s = code.strip()\n    \n    # JSON detection\n    if re.search(r'^\\s*[{\\[]', s):\n        try:\n            json.loads(s)\n            return 'json'\n        except:\n            pass\n    \n    # Python detection\n    if re.search(r'^\\s*def\\s+\\w+\\s*\\(', s, re.M) or \\\n       re.search(r'^\\s*(import|from)\\s+\\w+', s, re.M):\n        return 'python'\n    \n    # JavaScript detection  \n    if re.search(r'\\b(function\\s+\\w+\\s*\\(|const\\s+\\w+\\s*=)', s) or \\\n       re.search(r'=>|console\\.(log|error)', s):\n        return 'javascript'\n    \n    # Bash detection\n    if re.search(r'^#!.*\\b(bash|sh)\\b', s, re.M) or \\\n       re.search(r'\\b(if|then|fi|for|in|do|done)\\b', s):\n        return 'bash'\n    \n    # SQL detection\n    if re.search(r'\\b(SELECT|INSERT|UPDATE|DELETE|CREATE)\\s+', s, re.I):\n        return 'sql'\n        \n    return 'text'\n\ndef format_markdown(content):\n    \"\"\"Format markdown content with language detection.\"\"\"\n    # Fix unlabeled code fences\n    def add_lang_to_fence(match):\n        indent, info, body, closing = match.groups()\n        if not info.strip():\n            lang = detect_language(body)\n            return f\"{indent}```{lang}\\n{body}{closing}\\n\"\n        return match.group(0)\n    \n    fence_pattern = r'(?ms)^([ \\t]{0,3})```([^\\n]*)\\n(.*?)(\\n\\1```)\\s*$'\n    content = re.sub(fence_pattern, add_lang_to_fence, content)\n    \n    # Fix excessive blank lines (only outside code fences)\n    content = re.sub(r'\\n{3,}', '\\n\\n', content)\n    \n    return content.rstrip() + '\\n'\n\n# Main execution\ntry:\n    input_data = json.load(sys.stdin)\n    file_path = input_data.get('tool_input', {}).get('file_path', '')\n    \n    if not file_path.endswith(('.md', '.mdx')):\n        sys.exit(0)  # Not a markdown file\n    \n    if os.path.exists(file_path):\n        with open(file_path, 'r', encoding='utf-8') as f:\n            content = f.read()\n        \n        formatted = format_markdown(content)\n        \n        if formatted != content:\n            with open(file_path, 'w', encoding='utf-8') as f:\n                f.write(formatted)\n            print(f\"✓ Fixed markdown formatting in {file_path}\")\n    \nexcept Exception as e:\n    print(f\"Error formatting markdown: {e}\", file=sys.stderr)\n    sys.exit(1)\n````\n\nMake the script executable:\n\n```bash  theme={null}\nchmod +x .claude/hooks/markdown_formatter.py\n```\n\nThis hook automatically:\n\n* Detects programming languages in unlabeled code blocks\n* Adds appropriate language tags for syntax highlighting\n* Fixes excessive blank lines while preserving code content\n* Only processes markdown files (`.md`, `.mdx`)\n\n### Custom Notification Hook\n\nGet desktop notifications when Claude needs input:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"Notification\": [\n      {\n        \"matcher\": \"\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"notify-send 'Claude Code' 'Awaiting your input'\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### File Protection Hook\n\nBlock edits to sensitive files:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"PreToolUse\": [\n      {\n        \"matcher\": \"Edit|Write\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"python3 -c \\\"import json, sys; data=json.load(sys.stdin); path=data.get('tool_input',{}).get('file_path',''); sys.exit(2 if any(p in path for p in ['.env', 'package-lock.json', '.git/']) else 0)\\\"\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n## Learn more\n\n* For reference documentation on hooks, see [Hooks reference](/en/hooks).\n* For comprehensive security best practices and safety guidelines, see [Security Considerations](/en/hooks#security-considerations) in the hooks reference documentation.\n* For troubleshooting steps and debugging techniques, see [Debugging](/en/hooks#debugging) in the hooks reference\n  documentation.\n\n\n---\n\n> To find navigation and other pages in this documentation, fetch the llms.txt file at: https://code.claude.com/docs/llms.txt"}]},"isSidechain":true,"agentId":"a93e318"}
{"type":"user","uuid":"e160191a-b201-416f-a5dc-cf5c32a0d417","parentUuid":"9c98de46-0708-435a-b2b2-fe19c0299cb6","timestamp":"2025-12-24T18:49:06.324Z","sessionId":"f968233b-ebe5-4958-aa2d-69a2d8e7413c","cwd":"/Users/yoav/projects/alignment-hive","gitBranch":"main","version":"2.0.76","message":{"role":"user","content":[{"type":"tool_result","tool_use_id":"toolu_01JkNp7q9jMYWJgtA8tzk6A2","content":"# Slash commands\n\n> Control Claude's behavior during an interactive session with slash commands.\n\n## Built-in slash commands\n\n| Command                   | Purpose                                                                                                                     |\n| :------------------------ | :-------------------------------------------------------------------------------------------------------------------------- |\n| `/add-dir`                | Add additional working directories                                                                                          |\n| `/agents`                 | Manage custom AI subagents for specialized tasks                                                                            |\n| `/bashes`                 | List and manage background tasks                                                                                            |\n| `/bug`                    | Report bugs (sends conversation to Anthropic)                                                                               |\n| `/clear`                  | Clear conversation history                                                                                                  |\n| `/compact [instructions]` | Compact conversation with optional focus instructions                                                                       |\n| `/config`                 | Open the Settings interface (Config tab)                                                                                    |\n| `/context`                | Visualize current context usage as a colored grid                                                                           |\n| `/cost`                   | Show token usage statistics. See [cost tracking guide](/en/costs#using-the-cost-command) for subscription-specific details. |\n| `/doctor`                 | Checks the health of your Claude Code installation                                                                          |\n| `/exit`                   | Exit the REPL                                                                                                               |\n| `/export [filename]`      | Export the current conversation to a file or clipboard                                                                      |\n| `/help`                   | Get usage help                                                                                                              |\n| `/hooks`                  | Manage hook configurations for tool events                                                                                  |\n| `/ide`                    | Manage IDE integrations and show status                                                                                     |\n| `/init`                   | Initialize project with `CLAUDE.md` guide                                                                                   |\n| `/install-github-app`     | Set up Claude GitHub Actions for a repository                                                                               |\n| `/login`                  | Switch Anthropic accounts                                                                                                   |\n| `/logout`                 | Sign out from your Anthropic account                                                                                        |\n| `/mcp`                    | Manage MCP server connections and OAuth authentication                                                                      |\n| `/memory`                 | Edit `CLAUDE.md` memory files                                                                                               |\n| `/model`                  | Select or change the AI model                                                                                               |\n| `/output-style [style]`   | Set the output style directly or from a selection menu                                                                      |\n| `/permissions`            | View or update [permissions](/en/iam#configuring-permissions)                                                               |\n| `/plugin`                 | Manage Claude Code plugins                                                                                                  |\n| `/pr-comments`            | View pull request comments                                                                                                  |\n| `/privacy-settings`       | View and update your privacy settings                                                                                       |\n| `/release-notes`          | View release notes                                                                                                          |\n| `/rename <name>`          | Rename the current session for easier identification                                                                        |\n| `/resume [session]`       | Resume a conversation by ID or name, or open the session picker                                                             |\n| `/review`                 | Request code review                                                                                                         |\n| `/rewind`                 | Rewind the conversation and/or code                                                                                         |\n| `/sandbox`                | Enable sandboxed bash tool with filesystem and network isolation for safer, more autonomous execution                       |\n| `/security-review`        | Complete a security review of pending changes on the current branch                                                         |\n| `/stats`                  | Visualize daily usage, session history, streaks, and model preferences                                                      |\n| `/status`                 | Open the Settings interface (Status tab) showing version, model, account, and connectivity                                  |\n| `/statusline`             | Set up Claude Code's status line UI                                                                                         |\n| `/terminal-setup`         | Install Shift+Enter key binding for newlines (iTerm2 and VSCode only)                                                       |\n| `/todos`                  | List current TODO items                                                                                                     |\n| `/usage`                  | For subscription plans only: show plan usage limits and rate limit status                                                   |\n| `/vim`                    | Enter vim mode for alternating insert and command modes                                                                     |\n\n## Custom slash commands\n\nCustom slash commands allow you to define frequently used prompts as Markdown files that Claude Code can execute. Commands are organized by scope (project-specific or personal) and support namespacing through directory structures.\n\n### Syntax\n\n```\n/<command-name> [arguments]\n```\n\n#### Parameters\n\n| Parameter        | Description                                                       |\n| :--------------- | :---------------------------------------------------------------- |\n| `<command-name>` | Name derived from the Markdown filename (without `.md` extension) |\n| `[arguments]`    | Optional arguments passed to the command                          |\n\n### Command types\n\n#### Project commands\n\nCommands stored in your repository and shared with your team. When listed in `/help`, these commands show \"(project)\" after their description.\n\n**Location**: `.claude/commands/`\n\nThe following example creates the `/optimize` command:\n\n```bash  theme={null}\n# Create a project command\nmkdir -p .claude/commands\necho \"Analyze this code for performance issues and suggest optimizations:\" > .claude/commands/optimize.md\n```\n\n#### Personal commands\n\nCommands available across all your projects. When listed in `/help`, these commands show \"(user)\" after their description.\n\n**Location**: `~/.claude/commands/`\n\nThe following example creates the `/security-review` command:\n\n```bash  theme={null}\n# Create a personal command\nmkdir -p ~/.claude/commands\necho \"Review this code for security vulnerabilities:\" > ~/.claude/commands/security-review.md\n```\n\n### Features\n\n#### Namespacing\n\nUse subdirectories to group related commands. Subdirectories appear in the command description but don't affect the command name.\n\nFor example:\n\n* `.claude/commands/frontend/component.md` creates `/component` with description \"(project:frontend)\"\n* `~/.claude/commands/component.md` creates `/component` with description \"(user)\"\n\nIf a project command and user command share the same name, the project command takes precedence and the user command is silently ignored. For example, if both `.claude/commands/deploy.md` and `~/.claude/commands/deploy.md` exist, `/deploy` runs the project version.\n\nCommands in different subdirectories can share names since the subdirectory appears in the description to distinguish them. For example, `.claude/commands/frontend/test.md` and `.claude/commands/backend/test.md` both create `/test`, but show as \"(project:frontend)\" and \"(project:backend)\" respectively.\n\n#### Arguments\n\nPass dynamic values to commands using argument placeholders:\n\n##### All arguments with `$ARGUMENTS`\n\nThe `$ARGUMENTS` placeholder captures all arguments passed to the command:\n\n```bash  theme={null}\n# Command definition\necho 'Fix issue #$ARGUMENTS following our coding standards' > .claude/commands/fix-issue.md\n\n# Usage\n> /fix-issue 123 high-priority\n# $ARGUMENTS becomes: \"123 high-priority\"\n```\n\n##### Individual arguments with `$1`, `$2`, etc.\n\nAccess specific arguments individually using positional parameters (similar to shell scripts):\n\n```bash  theme={null}\n# Command definition  \necho 'Review PR #$1 with priority $2 and assign to $3' > .claude/commands/review-pr.md\n\n# Usage\n> /review-pr 456 high alice\n# $1 becomes \"456\", $2 becomes \"high\", $3 becomes \"alice\"\n```\n\nUse positional arguments when you need to:\n\n* Access arguments individually in different parts of your command\n* Provide defaults for missing arguments\n* Build more structured commands with specific parameter roles\n\n#### Bash command execution\n\nExecute bash commands before the slash command runs using the `!` prefix. The output is included in the command context. You *must* include `allowed-tools` with the `Bash` tool, but you can choose the specific bash commands to allow.\n\nFor example:\n\n```markdown  theme={null}\n---\nallowed-tools: Bash(git add:*), Bash(git status:*), Bash(git commit:*)\ndescription: Create a git commit\n---\n\n## Context\n\n- Current git status: !`git status`\n- Current git diff (staged and unstaged changes): !`git diff HEAD`\n- Current branch: !`git branch --show-current`\n- Recent commits: !`git log --oneline -10`\n\n## Your task\n\nBased on the above changes, create a single git commit.\n```\n\n#### File references\n\nInclude file contents in commands using the `@` prefix to [reference files](/en/common-workflows#reference-files-and-directories).\n\nFor example:\n\n```markdown  theme={null}\n# Reference a specific file\n\nReview the implementation in @src/utils/helpers.js\n\n# Reference multiple files\n\nCompare @src/old-version.js with @src/new-version.js\n```\n\n#### Thinking mode\n\nSlash commands can trigger extended thinking by including [extended thinking keywords](/en/common-workflows#use-extended-thinking).\n\n### Frontmatter\n\nCommand files support frontmatter, useful for specifying metadata about the command:\n\n| Frontmatter                | Purpose                                                                                                                                                                               | Default                             |\n| :------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :---------------------------------- |\n| `allowed-tools`            | List of tools the command can use                                                                                                                                                     | Inherits from the conversation      |\n| `argument-hint`            | The arguments expected for the slash command. Example: `argument-hint: add [tagId] \\| remove [tagId] \\| list`. This hint is shown to the user when auto-completing the slash command. | None                                |\n| `description`              | Brief description of the command                                                                                                                                                      | Uses the first line from the prompt |\n| `model`                    | Specific model string (see [Models overview](https://docs.claude.com/en/docs/about-claude/models/overview))                                                                           | Inherits from the conversation      |\n| `disable-model-invocation` | Whether to prevent `SlashCommand` tool from calling this command                                                                                                                      | false                               |\n\nFor example:\n\n```markdown  theme={null}\n---\nallowed-tools: Bash(git add:*), Bash(git status:*), Bash(git commit:*)\nargument-hint: [message]\ndescription: Create a git commit\nmodel: claude-3-5-haiku-20241022\n---\n\nCreate a git commit with message: $ARGUMENTS\n```\n\nExample using positional arguments:\n\n```markdown  theme={null}\n---\nargument-hint: [pr-number] [priority] [assignee]\ndescription: Review pull request\n---\n\nReview PR #$1 with priority $2 and assign to $3.\nFocus on security, performance, and code style.\n```\n\n## Plugin commands\n\n[Plugins](/en/plugins) can provide custom slash commands that integrate seamlessly with Claude Code. Plugin commands work exactly like user-defined commands but are distributed through [plugin marketplaces](/en/plugin-marketplaces).\n\n### How plugin commands work\n\nPlugin commands are:\n\n* **Namespaced**: Commands can use the format `/plugin-name:command-name` to avoid conflicts (plugin prefix is optional unless there are name collisions)\n* **Automatically available**: Once a plugin is installed and enabled, its commands appear in `/help`\n* **Fully integrated**: Support all command features (arguments, frontmatter, bash execution, file references)\n\n### Plugin command structure\n\n**Location**: `commands/` directory in plugin root\n\n**File format**: Markdown files with frontmatter\n\n**Basic command structure**:\n\n```markdown  theme={null}\n---\ndescription: Brief description of what the command does\n---\n\n# Command Name\n\nDetailed instructions for Claude on how to execute this command.\nInclude specific guidance on parameters, expected outcomes, and any special considerations.\n```\n\n**Advanced command features**:\n\n* **Arguments**: Use placeholders like `{arg1}` in command descriptions\n* **Subdirectories**: Organize commands in subdirectories for namespacing\n* **Bash integration**: Commands can execute shell scripts and programs\n* **File references**: Commands can reference and modify project files\n\n### Invocation patterns\n\n```shell Direct command (when no conflicts) theme={null}\n/command-name\n```\n\n```shell Plugin-prefixed (when needed for disambiguation) theme={null}\n/plugin-name:command-name\n```\n\n```shell With arguments (if command supports them) theme={null}\n/command-name arg1 arg2\n```\n\n## MCP slash commands\n\nMCP servers can expose prompts as slash commands that become available in Claude Code. These commands are dynamically discovered from connected MCP servers.\n\n### Command format\n\nMCP commands follow the pattern:\n\n```\n/mcp__<server-name>__<prompt-name> [arguments]\n```\n\n### Features\n\n#### Dynamic discovery\n\nMCP commands are automatically available when:\n\n* An MCP server is connected and active\n* The server exposes prompts through the MCP protocol\n* The prompts are successfully retrieved during connection\n\n#### Arguments\n\nMCP prompts can accept arguments defined by the server:\n\n```\n# Without arguments\n> /mcp__github__list_prs\n\n# With arguments\n> /mcp__github__pr_review 456\n> /mcp__jira__create_issue \"Bug title\" high\n```\n\n#### Naming conventions\n\nServer and prompt names are normalized:\n\n* Spaces and special characters become underscores\n* Names are lowercase for consistency\n\n### Managing MCP connections\n\nUse the `/mcp` command to:\n\n* View all configured MCP servers\n* Check connection status\n* Authenticate with OAuth-enabled servers\n* Clear authentication tokens\n* View available tools and prompts from each server\n\n### MCP permissions and wildcards\n\nTo approve all tools from an MCP server, use either the server name alone or wildcard syntax:\n\n* `mcp__github` (approves all GitHub tools)\n* `mcp__github__*` (wildcard syntax, also approves all GitHub tools)\n\nTo approve specific tools, list each one explicitly:\n\n* `mcp__github__get_issue`\n* `mcp__github__list_issues`\n\nSee [MCP permission rules](/en/iam#tool-specific-permission-rules) for more details.\n\n## `SlashCommand` tool\n\nThe `SlashCommand` tool allows Claude to execute [custom slash commands](/en/slash-commands#custom-slash-commands) programmatically\nduring a conversation. This gives Claude the ability to invoke custom commands\non your behalf when appropriate.\n\nTo encourage Claude to use the `SlashCommand` tool, reference the command by name, including the slash, in your prompts or `CLAUDE.md` file. For example:\n\n```\n> Run /write-unit-test when you are about to start writing tests.\n```\n\nThis tool puts each available custom slash command's metadata into context up to the character budget limit. You can use `/context` to monitor token usage and follow the operations below to manage context.\n\n### `SlashCommand` tool supported commands\n\n`SlashCommand` tool only supports custom slash commands that:\n\n* Are user-defined. Built-in commands like `/compact` and `/init` are *not* supported.\n* Have the `description` frontmatter field populated. The description is used in the context.\n\nFor Claude Code versions >= 1.0.124, you can see which custom slash commands\n`SlashCommand` tool can invoke by running `claude --debug` and triggering a query.\n\n### Disable `SlashCommand` tool\n\nTo prevent Claude from executing any slash commands via the tool:\n\n```bash  theme={null}\n/permissions\n# Add to deny rules: SlashCommand\n```\n\nThis also removes the SlashCommand tool and command descriptions from context.\n\n### Disable specific commands only\n\nTo prevent a specific slash command from becoming available, add\n`disable-model-invocation: true` to the slash command's frontmatter.\n\nThis also removes the command's metadata from context.\n\n### `SlashCommand` permission rules\n\nThe permission rules support:\n\n* **Exact match**: `SlashCommand:/commit` (allows only `/commit` with no arguments)\n* **Prefix match**: `SlashCommand:/review-pr:*` (allows `/review-pr` with any arguments)\n\n### Character budget limit\n\nThe `SlashCommand` tool includes a character budget to limit the size of command\ndescriptions shown to Claude. This prevents token overflow when many commands\nare available.\n\nThe budget includes each custom slash command's name, arguments, and description.\n\n* **Default limit**: 15,000 characters\n* **Custom limit**: Set via `SLASH_COMMAND_TOOL_CHAR_BUDGET` environment variable\n\nWhen the character budget is exceeded, Claude sees only a subset of the available commands. In `/context`, a warning shows \"M of N commands\".\n\n## Skills vs slash commands\n\n**Slash commands** and **Agent Skills** serve different purposes in Claude Code:\n\n### Use slash commands for\n\n**Quick, frequently used prompts**:\n\n* Simple prompt snippets you use often\n* Quick reminders or templates\n* Frequently used instructions that fit in one file\n\n**Examples**:\n\n* `/review` → \"Review this code for bugs and suggest improvements\"\n* `/explain` → \"Explain this code in simple terms\"\n* `/optimize` → \"Analyze this code for performance issues\"\n\n### Use Skills for\n\n**Comprehensive capabilities with structure**:\n\n* Complex workflows with multiple steps\n* Capabilities requiring scripts or utilities\n* Knowledge organized across multiple files\n* Team workflows you want to standardize\n\n**Examples**:\n\n* PDF processing Skill with form-filling scripts and validation\n* Data analysis Skill with reference docs for different data types\n* Documentation Skill with style guides and templates\n\n### Key differences\n\n| Aspect         | Slash Commands                   | Agent Skills                        |\n| -------------- | -------------------------------- | ----------------------------------- |\n| **Complexity** | Simple prompts                   | Complex capabilities                |\n| **Structure**  | Single .md file                  | Directory with SKILL.md + resources |\n| **Discovery**  | Explicit invocation (`/command`) | Automatic (based on context)        |\n| **Files**      | One file only                    | Multiple files, scripts, templates  |\n| **Scope**      | Project or personal              | Project or personal                 |\n| **Sharing**    | Via git                          | Via git                             |\n\n### Example comparison\n\n**As a slash command**:\n\n```markdown  theme={null}\n# .claude/commands/review.md\nReview this code for:\n- Security vulnerabilities\n- Performance issues\n- Code style violations\n```\n\nUsage: `/review` (manual invocation)\n\n**As a Skill**:\n\n```\n.claude/skills/code-review/\n├── SKILL.md (overview and workflows)\n├── SECURITY.md (security checklist)\n├── PERFORMANCE.md (performance patterns)\n├── STYLE.md (style guide reference)\n└── scripts/\n    └── run-linters.sh\n```\n\nUsage: \"Can you review this code?\" (automatic discovery)\n\nThe Skill provides richer context, validation scripts, and organized reference material.\n\n### When to use each\n\n**Use slash commands**:\n\n* You invoke the same prompt repeatedly\n* The prompt fits in a single file\n* You want explicit control over when it runs\n\n**Use Skills**:\n\n* Claude should discover the capability automatically\n* Multiple files or scripts are needed\n* Complex workflows with validation steps\n* Team needs standardized, detailed guidance\n\nBoth slash commands and Skills can coexist. Use the approach that fits your needs.\n\nLearn more about [Agent Skills](/en/skills).\n\n## See also\n\n* [Plugins](/en/plugins) - Extend Claude Code with custom commands through plugins\n* [Identity and Access Management](/en/iam) - Complete guide to permissions, including MCP tool permissions\n* [Interactive mode](/en/interactive-mode) - Shortcuts, input modes, and interactive features\n* [CLI reference](/en/cli-reference) - Command-line flags and options\n* [Settings](/en/settings) - Configuration options\n* [Memory management](/en/memory) - Managing Claude's memory across sessions\n\n\n---\n\n> To find navigation and other pages in this documentation, fetch the llms.txt file at: https://code.claude.com/docs/llms.txt"}]},"isSidechain":true,"agentId":"a93e318"}
{"type":"assistant","uuid":"cbb5c184-da2c-4749-b05a-1256e5f852ec","parentUuid":"e160191a-b201-416f-a5dc-cf5c32a0d417","timestamp":"2025-12-24T18:49:08.764Z","sessionId":"f968233b-ebe5-4958-aa2d-69a2d8e7413c","message":{"role":"assistant","content":[{"type":"text","text":"Excellent! Now let me fetch one more document about persistent storage patterns in plugins to understand state management:"}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":22249,"cache_read_input_tokens":15926,"cache_creation":{"ephemeral_5m_input_tokens":22249,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.0.76","gitBranch":"main","agentId":"a93e318"}
{"type":"assistant","uuid":"d0d330b4-141c-4fd0-a3e4-5d58c3b44444","parentUuid":"cbb5c184-da2c-4749-b05a-1256e5f852ec","timestamp":"2025-12-24T18:49:09.267Z","sessionId":"f968233b-ebe5-4958-aa2d-69a2d8e7413c","message":{"role":"assistant","content":[{"type":"tool_use","id":"toolu_01SEiG2DyUCrr6ZpHtHyEt3K","name":"WebFetch","input":{"url":"https://code.claude.com/docs/en/plugins-reference.md","prompt":"Find information about plugin state management, configuration storage, and persistent data across sessions"}}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":22249,"cache_read_input_tokens":15926,"cache_creation":{"ephemeral_5m_input_tokens":22249,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.0.76","gitBranch":"main","agentId":"a93e318"}
{"type":"assistant","uuid":"6ead2641-4b4c-4fcc-99b1-4a93845ffcaf","parentUuid":"d0d330b4-141c-4fd0-a3e4-5d58c3b44444","timestamp":"2025-12-24T18:49:09.667Z","sessionId":"f968233b-ebe5-4958-aa2d-69a2d8e7413c","message":{"role":"assistant","content":[{"type":"tool_use","id":"toolu_01LQtaPk7zUM37VRvpfHsHu2","name":"WebFetch","input":{"url":"https://code.claude.com/docs/en/settings.md","prompt":"Document how to persist data across sessions, environment variables, and state management in Claude Code"}}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":22249,"cache_read_input_tokens":15926,"cache_creation":{"ephemeral_5m_input_tokens":22249,"ephemeral_1h_input_tokens":0},"output_tokens":205,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.0.76","gitBranch":"main","agentId":"a93e318"}
{"type":"user","uuid":"719076cd-7275-4d85-90e4-693f7dfec34e","parentUuid":"6ead2641-4b4c-4fcc-99b1-4a93845ffcaf","timestamp":"2025-12-24T18:49:09.918Z","sessionId":"f968233b-ebe5-4958-aa2d-69a2d8e7413c","cwd":"/Users/yoav/projects/alignment-hive","gitBranch":"main","version":"2.0.76","message":{"role":"user","content":[{"type":"tool_result","tool_use_id":"toolu_01SEiG2DyUCrr6ZpHtHyEt3K","content":"# Plugins reference\n\n> Complete technical reference for Claude Code plugin system, including schemas, CLI commands, and component specifications.\n\n<Tip>\n  Looking to install plugins? See [Discover and install plugins](/en/discover-plugins). For creating plugins, see [Plugins](/en/plugins). For distributing plugins, see [Plugin marketplaces](/en/plugin-marketplaces).\n</Tip>\n\nThis reference provides complete technical specifications for the Claude Code plugin system, including component schemas, CLI commands, and development tools.\n\n## Plugin components reference\n\nThis section documents the five types of components that plugins can provide.\n\n### Commands\n\nPlugins add custom slash commands that integrate seamlessly with Claude Code's command system.\n\n**Location**: `commands/` directory in plugin root\n\n**File format**: Markdown files with frontmatter\n\nFor complete details on plugin command structure, invocation patterns, and features, see [Plugin commands](/en/slash-commands#plugin-commands).\n\n### Agents\n\nPlugins can provide specialized subagents for specific tasks that Claude can invoke automatically when appropriate.\n\n**Location**: `agents/` directory in plugin root\n\n**File format**: Markdown files describing agent capabilities\n\n**Agent structure**:\n\n```markdown  theme={null}\n---\ndescription: What this agent specializes in\ncapabilities: [\"task1\", \"task2\", \"task3\"]\n---\n\n# Agent Name\n\nDetailed description of the agent's role, expertise, and when Claude should invoke it.\n\n## Capabilities\n- Specific task the agent excels at\n- Another specialized capability\n- When to use this agent vs others\n\n## Context and examples\nProvide examples of when this agent should be used and what kinds of problems it solves.\n```\n\n**Integration points**:\n\n* Agents appear in the `/agents` interface\n* Claude can invoke agents automatically based on task context\n* Agents can be invoked manually by users\n* Plugin agents work alongside built-in Claude agents\n\n### Skills\n\nPlugins can provide Agent Skills that extend Claude's capabilities. Skills are model-invoked—Claude autonomously decides when to use them based on the task context.\n\n**Location**: `skills/` directory in plugin root\n\n**File format**: Directories containing `SKILL.md` files with frontmatter\n\n**Skill structure**:\n\n```\nskills/\n├── pdf-processor/\n│   ├── SKILL.md\n│   ├── reference.md (optional)\n│   └── scripts/ (optional)\n└── code-reviewer/\n    └── SKILL.md\n```\n\n**Integration behavior**:\n\n* Plugin Skills are automatically discovered when the plugin is installed\n* Claude autonomously invokes Skills based on matching task context\n* Skills can include supporting files alongside SKILL.md\n\nFor SKILL.md format and complete Skill authoring guidance, see:\n\n* [Use Skills in Claude Code](/en/skills)\n* [Agent Skills overview](https://docs.claude.com/en/docs/agents-and-tools/agent-skills/overview#skill-structure)\n\n### Hooks\n\nPlugins can provide event handlers that respond to Claude Code events automatically.\n\n**Location**: `hooks/hooks.json` in plugin root, or inline in plugin.json\n\n**Format**: JSON configuration with event matchers and actions\n\n**Hook configuration**:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"PostToolUse\": [\n      {\n        \"matcher\": \"Write|Edit\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"${CLAUDE_PLUGIN_ROOT}/scripts/format-code.sh\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n**Available events**:\n\n* `PreToolUse`: Before Claude uses any tool\n* `PostToolUse`: After Claude successfully uses any tool\n* `PostToolUseFailure`: After Claude tool execution fails\n* `PermissionRequest`: When a permission dialog is shown\n* `UserPromptSubmit`: When user submits a prompt\n* `Notification`: When Claude Code sends notifications\n* `Stop`: When Claude attempts to stop\n* `SubagentStart`: When a subagent is started\n* `SubagentStop`: When a subagent attempts to stop\n* `SessionStart`: At the beginning of sessions\n* `SessionEnd`: At the end of sessions\n* `PreCompact`: Before conversation history is compacted\n\n**Hook types**:\n\n* `command`: Execute shell commands or scripts\n* `prompt`: Evaluate a prompt with an LLM (uses `$ARGUMENTS` placeholder for context)\n* `agent`: Run an agentic verifier with tools for complex verification tasks\n\n### MCP servers\n\nPlugins can bundle Model Context Protocol (MCP) servers to connect Claude Code with external tools and services.\n\n**Location**: `.mcp.json` in plugin root, or inline in plugin.json\n\n**Format**: Standard MCP server configuration\n\n**MCP server configuration**:\n\n```json  theme={null}\n{\n  \"mcpServers\": {\n    \"plugin-database\": {\n      \"command\": \"${CLAUDE_PLUGIN_ROOT}/servers/db-server\",\n      \"args\": [\"--config\", \"${CLAUDE_PLUGIN_ROOT}/config.json\"],\n      \"env\": {\n        \"DB_PATH\": \"${CLAUDE_PLUGIN_ROOT}/data\"\n      }\n    },\n    \"plugin-api-client\": {\n      \"command\": \"npx\",\n      \"args\": [\"@company/mcp-server\", \"--plugin-mode\"],\n      \"cwd\": \"${CLAUDE_PLUGIN_ROOT}\"\n    }\n  }\n}\n```\n\n**Integration behavior**:\n\n* Plugin MCP servers start automatically when the plugin is enabled\n* Servers appear as standard MCP tools in Claude's toolkit\n* Server capabilities integrate seamlessly with Claude's existing tools\n* Plugin servers can be configured independently of user MCP servers\n\n### LSP servers\n\n<Tip>\n  Looking to use LSP plugins? Install them from the official marketplace—search for \"lsp\" in the `/plugin` Discover tab. This section documents how to create LSP plugins for languages not covered by the official marketplace.\n</Tip>\n\nPlugins can provide [Language Server Protocol](https://microsoft.github.io/language-server-protocol/) (LSP) servers to give Claude real-time code intelligence while working on your codebase.\n\nLSP integration provides:\n\n* **Instant diagnostics**: Claude sees errors and warnings immediately after each edit\n* **Code navigation**: go to definition, find references, and hover information\n* **Language awareness**: type information and documentation for code symbols\n\n**Location**: `.lsp.json` in plugin root, or inline in `plugin.json`\n\n**Format**: JSON configuration mapping language server names to their configurations\n\n**`.lsp.json` file format**:\n\n```json  theme={null}\n{\n  \"go\": {\n    \"command\": \"gopls\",\n    \"args\": [\"serve\"],\n    \"extensionToLanguage\": {\n      \".go\": \"go\"\n    }\n  }\n}\n```\n\n**Inline in `plugin.json`**:\n\n```json  theme={null}\n{\n  \"name\": \"my-plugin\",\n  \"lspServers\": {\n    \"go\": {\n      \"command\": \"gopls\",\n      \"args\": [\"serve\"],\n      \"extensionToLanguage\": {\n        \".go\": \"go\"\n      }\n    }\n  }\n}\n```\n\n**Required fields:**\n\n| Field                 | Description                                  |\n| :-------------------- | :------------------------------------------- |\n| `command`             | The LSP binary to execute (must be in PATH)  |\n| `extensionToLanguage` | Maps file extensions to language identifiers |\n\n**Optional fields:**\n\n| Field                   | Description                                               |\n| :---------------------- | :-------------------------------------------------------- |\n| `args`                  | Command-line arguments for the LSP server                 |\n| `transport`             | Communication transport: `stdio` (default) or `socket`    |\n| `env`                   | Environment variables to set when starting the server     |\n| `initializationOptions` | Options passed to the server during initialization        |\n| `settings`              | Settings passed via `workspace/didChangeConfiguration`    |\n| `workspaceFolder`       | Workspace folder path for the server                      |\n| `startupTimeout`        | Max time to wait for server startup (milliseconds)        |\n| `shutdownTimeout`       | Max time to wait for graceful shutdown (milliseconds)     |\n| `restartOnCrash`        | Whether to automatically restart the server if it crashes |\n| `maxRestarts`           | Maximum number of restart attempts before giving up       |\n| `loggingConfig`         | Debug logging configuration (see below)                   |\n\n**Debug logging configuration:**\n\nThe `loggingConfig` field enables verbose LSP logging when users pass `--enable-lsp-logging`. This helps debug language server issues without impacting normal operation.\n\n```json  theme={null}\n\"loggingConfig\": {\n  \"args\": [\"--log-level\", \"4\"],\n  \"env\": {\n    \"TSS_LOG\": \"-level verbose -file ${CLAUDE_PLUGIN_LSP_LOG_FILE}\"\n  }\n}\n```\n\n| Field  | Description                                                        |\n| :----- | :----------------------------------------------------------------- |\n| `args` | Additional command-line arguments appended when logging is enabled |\n| `env`  | Additional environment variables merged when logging is enabled    |\n\nThe `${CLAUDE_PLUGIN_LSP_LOG_FILE}` variable expands to the log file path. Logs are written to `~/.claude/debug/`.\n\n<Warning>\n  **You must install the language server binary separately.** LSP plugins configure how Claude Code connects to a language server, but they don't include the server itself. If you see `Executable not found in $PATH` in the `/plugin` Errors tab, install the required binary for your language.\n</Warning>\n\n**Available LSP plugins:**\n\n| Plugin           | Language server            | Install command                                                                            |\n| :--------------- | :------------------------- | :----------------------------------------------------------------------------------------- |\n| `pyright-lsp`    | Pyright (Python)           | `pip install pyright` or `npm install -g pyright`                                          |\n| `typescript-lsp` | TypeScript Language Server | `npm install -g typescript-language-server typescript`                                     |\n| `rust-lsp`       | rust-analyzer              | [See rust-analyzer installation](https://rust-analyzer.github.io/manual.html#installation) |\n\nInstall the language server first, then install the plugin from the marketplace.\n\n***\n\n## Plugin installation scopes\n\nWhen you install a plugin, you choose a **scope** that determines where the plugin is available and who else can use it:\n\n| Scope     | Settings file                 | Use case                                                 |\n| :-------- | :---------------------------- | :------------------------------------------------------- |\n| `user`    | `~/.claude/settings.json`     | Personal plugins available across all projects (default) |\n| `project` | `.claude/settings.json`       | Team plugins shared via version control                  |\n| `local`   | `.claude/settings.local.json` | Project-specific plugins, gitignored                     |\n| `managed` | `managed-settings.json`       | Enterprise-managed plugins (read-only, update only)      |\n\nPlugins use the same scope system as other Claude Code configurations. For installation instructions and scope flags, see [Install plugins](/en/discover-plugins#install-plugins). For a complete explanation of scopes, see [Configuration scopes](/en/settings#configuration-scopes).\n\n***\n\n## Plugin manifest schema\n\nThe `plugin.json` file defines your plugin's metadata and configuration. This section documents all supported fields and options.\n\n### Complete schema\n\n```json  theme={null}\n{\n  \"name\": \"plugin-name\",\n  \"version\": \"1.2.0\",\n  \"description\": \"Brief plugin description\",\n  \"author\": {\n    \"name\": \"Author Name\",\n    \"email\": \"author@example.com\",\n    \"url\": \"https://github.com/author\"\n  },\n  \"homepage\": \"https://docs.example.com/plugin\",\n  \"repository\": \"https://github.com/author/plugin\",\n  \"license\": \"MIT\",\n  \"keywords\": [\"keyword1\", \"keyword2\"],\n  \"commands\": [\"./custom/commands/special.md\"],\n  \"agents\": \"./custom/agents/\",\n  \"skills\": \"./custom/skills/\",\n  \"hooks\": \"./config/hooks.json\",\n  \"mcpServers\": \"./mcp-config.json\",\n  \"outputStyles\": \"./styles/\",\n  \"lspServers\": \"./.lsp.json\"\n}\n```\n\n### Required fields\n\n| Field  | Type   | Description                               | Example              |\n| :----- | :----- | :---------------------------------------- | :------------------- |\n| `name` | string | Unique identifier (kebab-case, no spaces) | `\"deployment-tools\"` |\n\n### Metadata fields\n\n| Field         | Type   | Description                         | Example                                            |\n| :------------ | :----- | :---------------------------------- | :------------------------------------------------- |\n| `version`     | string | Semantic version                    | `\"2.1.0\"`                                          |\n| `description` | string | Brief explanation of plugin purpose | `\"Deployment automation tools\"`                    |\n| `author`      | object | Author information                  | `{\"name\": \"Dev Team\", \"email\": \"dev@company.com\"}` |\n| `homepage`    | string | Documentation URL                   | `\"https://docs.example.com\"`                       |\n| `repository`  | string | Source code URL                     | `\"https://github.com/user/plugin\"`                 |\n| `license`     | string | License identifier                  | `\"MIT\"`, `\"Apache-2.0\"`                            |\n| `keywords`    | array  | Discovery tags                      | `[\"deployment\", \"ci-cd\"]`                          |\n\n### Component path fields\n\n| Field          | Type           | Description                                                                                                                                              | Example                                |\n| :------------- | :------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------- |\n| `commands`     | string\\|array  | Additional command files/directories                                                                                                                     | `\"./custom/cmd.md\"` or `[\"./cmd1.md\"]` |\n| `agents`       | string\\|array  | Additional agent files                                                                                                                                   | `\"./custom/agents/\"`                   |\n| `skills`       | string\\|array  | Additional skill directories                                                                                                                             | `\"./custom/skills/\"`                   |\n| `hooks`        | string\\|object | Hook config path or inline config                                                                                                                        | `\"./hooks.json\"`                       |\n| `mcpServers`   | string\\|object | MCP config path or inline config                                                                                                                         | `\"./mcp-config.json\"`                  |\n| `outputStyles` | string\\|array  | Additional output style files/directories                                                                                                                | `\"./styles/\"`                          |\n| `lspServers`   | string\\|object | [Language Server Protocol](https://microsoft.github.io/language-server-protocol/) config for code intelligence (go to definition, find references, etc.) | `\"./.lsp.json\"`                        |\n\n### Path behavior rules\n\n**Important**: Custom paths supplement default directories - they don't replace them.\n\n* If `commands/` exists, it's loaded in addition to custom command paths\n* All paths must be relative to plugin root and start with `./`\n* Commands from custom paths use the same naming and namespacing rules\n* Multiple paths can be specified as arrays for flexibility\n\n**Path examples**:\n\n```json  theme={null}\n{\n  \"commands\": [\n    \"./specialized/deploy.md\",\n    \"./utilities/batch-process.md\"\n  ],\n  \"agents\": [\n    \"./custom-agents/reviewer.md\",\n    \"./custom-agents/tester.md\"\n  ]\n}\n```\n\n### Environment variables\n\n**`${CLAUDE_PLUGIN_ROOT}`**: Contains the absolute path to your plugin directory. Use this in hooks, MCP servers, and scripts to ensure correct paths regardless of installation location.\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"PostToolUse\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"${CLAUDE_PLUGIN_ROOT}/scripts/process.sh\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n***\n\n## Plugin caching and file resolution\n\nFor security and verification purposes, Claude Code copies plugins to a cache directory rather than using them in-place. Understanding this behavior is important when developing plugins that reference external files.\n\n### How plugin caching works\n\nWhen you install a plugin, Claude Code copies the plugin files to a cache directory:\n\n* **For marketplace plugins with relative paths**: The path specified in the `source` field is copied recursively. For example, if your marketplace entry specifies `\"source\": \"./plugins/my-plugin\"`, the entire `./plugins` directory is copied.\n* **For plugins with `.claude-plugin/plugin.json`**: The implicit root directory (the directory containing `.claude-plugin/plugin.json`) is copied recursively.\n\n### Path traversal limitations\n\nPlugins cannot reference files outside their copied directory structure. Paths that traverse outside the plugin root (such as `../shared-utils`) will not work after installation because those external files are not copied to the cache.\n\n### Working with external dependencies\n\nIf your plugin needs to access files outside its directory, you have two options:\n\n**Option 1: Use symlinks**\n\nCreate symbolic links to external files within your plugin directory. Symlinks are honored during the copy process:\n\n```bash  theme={null}\n# Inside your plugin directory\nln -s /path/to/shared-utils ./shared-utils\n```\n\nThe symlinked content will be copied into the plugin cache.\n\n**Option 2: Restructure your marketplace**\n\nSet the plugin path to a parent directory that contains all required files, then provide the rest of the plugin manifest directly in the marketplace entry:\n\n```json  theme={null}\n{\n  \"name\": \"my-plugin\",\n  \"source\": \"./\",\n  \"description\": \"Plugin that needs root-level access\",\n  \"commands\": [\"./plugins/my-plugin/commands/\"],\n  \"agents\": [\"./plugins/my-plugin/agents/\"],\n  \"strict\": false\n}\n```\n\nThis approach copies the entire marketplace root, giving your plugin access to sibling directories.\n\n<Note>\n  Symlinks that point to locations outside the plugin's logical root are followed during copying. This provides flexibility while maintaining the security benefits of the caching system.\n</Note>\n\n***\n\n## Plugin directory structure\n\n### Standard plugin layout\n\nA complete plugin follows this structure:\n\n```\nenterprise-plugin/\n├── .claude-plugin/           # Metadata directory\n│   └── plugin.json          # Required: plugin manifest\n├── commands/                 # Default command location\n│   ├── status.md\n│   └── logs.md\n├── agents/                   # Default agent location\n│   ├── security-reviewer.md\n│   ├── performance-tester.md\n│   └── compliance-checker.md\n├── skills/                   # Agent Skills\n│   ├── code-reviewer/\n│   │   └── SKILL.md\n│   └── pdf-processor/\n│       ├── SKILL.md\n│       └── scripts/\n├── hooks/                    # Hook configurations\n│   ├── hooks.json           # Main hook config\n│   └── security-hooks.json  # Additional hooks\n├── .mcp.json                # MCP server definitions\n├── .lsp.json                # LSP server configurations\n├── scripts/                 # Hook and utility scripts\n│   ├── security-scan.sh\n│   ├── format-code.py\n│   └── deploy.js\n├── LICENSE                  # License file\n└── CHANGELOG.md             # Version history\n```\n\n<Warning>\n  The `.claude-plugin/` directory contains the `plugin.json` file. All other directories (commands/, agents/, skills/, hooks/) must be at the plugin root, not inside `.claude-plugin/`.\n</Warning>\n\n### File locations reference\n\n| Component       | Default Location             | Purpose                          |\n| :-------------- | :--------------------------- | :------------------------------- |\n| **Manifest**    | `.claude-plugin/plugin.json` | Required metadata file           |\n| **Commands**    | `commands/`                  | Slash command Markdown files     |\n| **Agents**      | `agents/`                    | Subagent Markdown files          |\n| **Skills**      | `skills/`                    | Agent Skills with SKILL.md files |\n| **Hooks**       | `hooks/hooks.json`           | Hook configuration               |\n| **MCP servers** | `.mcp.json`                  | MCP server definitions           |\n| **LSP servers** | `.lsp.json`                  | Language server configurations   |\n\n***\n\n## CLI commands reference\n\nClaude Code provides CLI commands for non-interactive plugin management, useful for scripting and automation.\n\n### plugin install\n\nInstall a plugin from available marketplaces.\n\n```bash  theme={null}\nclaude plugin install <plugin> [options]\n```\n\n**Arguments:**\n\n* `<plugin>`: Plugin name or `plugin-name@marketplace-name` for a specific marketplace\n\n**Options:**\n\n| Option                | Description                                       | Default |\n| :-------------------- | :------------------------------------------------ | :------ |\n| `-s, --scope <scope>` | Installation scope: `user`, `project`, or `local` | `user`  |\n| `-h, --help`          | Display help for command                          |         |\n\n**Examples:**\n\n```bash  theme={null}\n# Install to user scope (default)\nclaude plugin install formatter@my-marketplace\n\n# Install to project scope (shared with team)\nclaude plugin install formatter@my-marketplace --scope project\n\n# Install to local scope (gitignored)\nclaude plugin install formatter@my-marketplace --scope local\n```\n\n### plugin uninstall\n\nRemove an installed plugin.\n\n```bash  theme={null}\nclaude plugin uninstall <plugin> [options]\n```\n\n**Arguments:**\n\n* `<plugin>`: Plugin name or `plugin-name@marketplace-name`\n\n**Options:**\n\n| Option                | Description                                         | Default |\n| :-------------------- | :-------------------------------------------------- | :------ |\n| `-s, --scope <scope>` | Uninstall from scope: `user`, `project`, or `local` | `user`  |\n| `-h, --help`          | Display help for command                            |         |\n\n**Aliases:** `remove`, `rm`\n\n### plugin enable\n\nEnable a disabled plugin.\n\n```bash  theme={null}\nclaude plugin enable <plugin> [options]\n```\n\n**Arguments:**\n\n* `<plugin>`: Plugin name or `plugin-name@marketplace-name`\n\n**Options:**\n\n| Option                | Description                                    | Default |\n| :-------------------- | :--------------------------------------------- | :------ |\n| `-s, --scope <scope>` | Scope to enable: `user`, `project`, or `local` | `user`  |\n| `-h, --help`          | Display help for command                       |         |\n\n### plugin disable\n\nDisable a plugin without uninstalling it.\n\n```bash  theme={null}\nclaude plugin disable <plugin> [options]\n```\n\n**Arguments:**\n\n* `<plugin>`: Plugin name or `plugin-name@marketplace-name`\n\n**Options:**\n\n| Option                | Description                                     | Default |\n| :-------------------- | :---------------------------------------------- | :------ |\n| `-s, --scope <scope>` | Scope to disable: `user`, `project`, or `local` | `user`  |\n| `-h, --help`          | Display help for command                        |         |\n\n### plugin update\n\nUpdate a plugin to the latest version.\n\n```bash  theme={null}\nclaude plugin update <plugin> [options]\n```\n\n**Arguments:**\n\n* `<plugin>`: Plugin name or `plugin-name@marketplace-name`\n\n**Options:**\n\n| Option                | Description                                               | Default |\n| :-------------------- | :-------------------------------------------------------- | :------ |\n| `-s, --scope <scope>` | Scope to update: `user`, `project`, `local`, or `managed` | `user`  |\n| `-h, --help`          | Display help for command                                  |         |\n\n***\n\n## Debugging and development tools\n\n### Debugging commands\n\nUse `claude --debug` to see plugin loading details:\n\n```bash  theme={null}\nclaude --debug\n```\n\nThis shows:\n\n* Which plugins are being loaded\n* Any errors in plugin manifests\n* Command, agent, and hook registration\n* MCP server initialization\n\n### Common issues\n\n| Issue                               | Cause                           | Solution                                                                          |\n| :---------------------------------- | :------------------------------ | :-------------------------------------------------------------------------------- |\n| Plugin not loading                  | Invalid `plugin.json`           | Validate JSON syntax with `claude plugin validate` or `/plugin validate`          |\n| Commands not appearing              | Wrong directory structure       | Ensure `commands/` at root, not in `.claude-plugin/`                              |\n| Hooks not firing                    | Script not executable           | Run `chmod +x script.sh`                                                          |\n| MCP server fails                    | Missing `${CLAUDE_PLUGIN_ROOT}` | Use variable for all plugin paths                                                 |\n| Path errors                         | Absolute paths used             | All paths must be relative and start with `./`                                    |\n| LSP `Executable not found in $PATH` | Language server not installed   | Install the binary (e.g., `npm install -g typescript-language-server typescript`) |\n\n### Example error messages\n\n**Manifest validation errors**:\n\n* `Invalid JSON syntax: Unexpected token } in JSON at position 142`: check for missing commas, extra commas, or unquoted strings\n* `Plugin has an invalid manifest file at .claude-plugin/plugin.json. Validation errors: name: Required`: a required field is missing\n* `Plugin has a corrupt manifest file at .claude-plugin/plugin.json. JSON parse error: ...`: JSON syntax error\n\n**Plugin loading errors**:\n\n* `Warning: No commands found in plugin my-plugin custom directory: ./cmds. Expected .md files or SKILL.md in subdirectories.`: command path exists but contains no valid command files\n* `Plugin directory not found at path: ./plugins/my-plugin. Check that the marketplace entry has the correct path.`: the `source` path in marketplace.json points to a non-existent directory\n* `Plugin my-plugin has conflicting manifests: both plugin.json and marketplace entry specify components.`: remove duplicate component definitions or set `strict: true` in marketplace entry\n\n### Hook troubleshooting\n\n**Hook script not executing**:\n\n1. Check the script is executable: `chmod +x ./scripts/your-script.sh`\n2. Verify the shebang line: First line should be `#!/bin/bash` or `#!/usr/bin/env bash`\n3. Check the path uses `${CLAUDE_PLUGIN_ROOT}`: `\"command\": \"${CLAUDE_PLUGIN_ROOT}/scripts/your-script.sh\"`\n4. Test the script manually: `./scripts/your-script.sh`\n\n**Hook not triggering on expected events**:\n\n1. Verify the event name is correct (case-sensitive): `PostToolUse`, not `postToolUse`\n2. Check the matcher pattern matches your tools: `\"matcher\": \"Write|Edit\"` for file operations\n3. Confirm the hook type is valid: `command`, `prompt`, or `agent`\n\n### MCP server troubleshooting\n\n**Server not starting**:\n\n1. Check the command exists and is executable\n2. Verify all paths use `${CLAUDE_PLUGIN_ROOT}` variable\n3. Check the MCP server logs: `claude --debug` shows initialization errors\n4. Test the server manually outside of Claude Code\n\n**Server tools not appearing**:\n\n1. Ensure the server is properly configured in `.mcp.json` or `plugin.json`\n2. Verify the server implements the MCP protocol correctly\n3. Check for connection timeouts in debug output\n\n### Directory structure mistakes\n\n**Symptoms**: Plugin loads but components (commands, agents, hooks) are missing.\n\n**Correct structure**: Components must be at the plugin root, not inside `.claude-plugin/`. Only `plugin.json` belongs in `.claude-plugin/`.\n\n```\nmy-plugin/\n├── .claude-plugin/\n│   └── plugin.json      ← Only manifest here\n├── commands/            ← At root level\n├── agents/              ← At root level\n└── hooks/               ← At root level\n```\n\nIf your components are inside `.claude-plugin/`, move them to the plugin root.\n\n**Debug checklist**:\n\n1. Run `claude --debug` and look for \"loading plugin\" messages\n2. Check that each component directory is listed in the debug output\n3. Verify file permissions allow reading the plugin files\n\n***\n\n## Distribution and versioning reference\n\n### Version management\n\nFollow semantic versioning for plugin releases:\n\n```json  theme={null}\n{\n  \"name\": \"my-plugin\",\n  \"version\": \"2.1.0\"\n}\n```\n\n**Version format**: `MAJOR.MINOR.PATCH`\n\n* **MAJOR**: Breaking changes (incompatible API changes)\n* **MINOR**: New features (backward-compatible additions)\n* **PATCH**: Bug fixes (backward-compatible fixes)\n\n**Best practices**:\n\n* Start at `1.0.0` for your first stable release\n* Update the version in `plugin.json` before distributing changes\n* Document changes in a `CHANGELOG.md` file\n* Use pre-release versions like `2.0.0-beta.1` for testing\n\n***\n\n## See also\n\n* [Plugins](/en/plugins) - Tutorials and practical usage\n* [Plugin marketplaces](/en/plugin-marketplaces) - Creating and managing marketplaces\n* [Slash commands](/en/slash-commands) - Command development details\n* [Subagents](/en/sub-agents) - Agent configuration and capabilities\n* [Agent Skills](/en/skills) - Extend Claude's capabilities\n* [Hooks](/en/hooks) - Event handling and automation\n* [MCP](/en/mcp) - External tool integration\n* [Settings](/en/settings) - Configuration options for plugins\n\n\n---\n\n> To find navigation and other pages in this documentation, fetch the llms.txt file at: https://code.claude.com/docs/llms.txt"}]},"isSidechain":true,"agentId":"a93e318"}
{"type":"user","uuid":"21e76ea9-b00d-4b5a-91e5-9f53d96062b7","parentUuid":"719076cd-7275-4d85-90e4-693f7dfec34e","timestamp":"2025-12-24T18:49:09.928Z","sessionId":"f968233b-ebe5-4958-aa2d-69a2d8e7413c","cwd":"/Users/yoav/projects/alignment-hive","gitBranch":"main","version":"2.0.76","message":{"role":"user","content":[{"type":"tool_result","tool_use_id":"toolu_01LQtaPk7zUM37VRvpfHsHu2","content":"# Claude Code settings\n\n> Configure Claude Code with global and project-level settings, and environment variables.\n\nClaude Code offers a variety of settings to configure its behavior to meet your needs. You can configure Claude Code by running the `/config` command when using the interactive REPL, which opens a tabbed Settings interface where you can view status information and modify configuration options.\n\n## Configuration scopes\n\nClaude Code uses a **scope system** to determine where configurations apply and who they're shared with. Understanding scopes helps you decide how to configure Claude Code for personal use, team collaboration, or enterprise deployment.\n\n### Available scopes\n\n| Scope          | Location                             | Who it affects                       | Shared with team?      |\n| :------------- | :----------------------------------- | :----------------------------------- | :--------------------- |\n| **Enterprise** | System-level `managed-settings.json` | All users on the machine             | Yes (deployed by IT)   |\n| **User**       | `~/.claude/` directory               | You, across all projects             | No                     |\n| **Project**    | `.claude/` in repository             | All collaborators on this repository | Yes (committed to git) |\n| **Local**      | `.claude/*.local.*` files            | You, in this repository only         | No (gitignored)        |\n\n### When to use each scope\n\n**Enterprise scope** is for:\n\n* Security policies that must be enforced organization-wide\n* Compliance requirements that can't be overridden\n* Standardized configurations deployed by IT/DevOps\n\n**User scope** is best for:\n\n* Personal preferences you want everywhere (themes, editor settings)\n* Tools and plugins you use across all projects\n* API keys and authentication (stored securely)\n\n**Project scope** is best for:\n\n* Team-shared settings (permissions, hooks, MCP servers)\n* Plugins the whole team should have\n* Standardizing tooling across collaborators\n\n**Local scope** is best for:\n\n* Personal overrides for a specific project\n* Testing configurations before sharing with the team\n* Machine-specific settings that won't work for others\n\n### How scopes interact\n\nWhen the same setting is configured in multiple scopes, more specific scopes take precedence:\n\n1. **Enterprise** (highest) - can't be overridden by anything\n2. **Command line arguments** - temporary session overrides\n3. **Local** - overrides project and user settings\n4. **Project** - overrides user settings\n5. **User** (lowest) - applies when nothing else specifies the setting\n\nFor example, if a permission is allowed in user settings but denied in project settings, the project setting takes precedence and the permission is blocked.\n\n### What uses scopes\n\nScopes apply to many Claude Code features:\n\n| Feature         | User location             | Project location                   | Local location                 |\n| :-------------- | :------------------------ | :--------------------------------- | :----------------------------- |\n| **Settings**    | `~/.claude/settings.json` | `.claude/settings.json`            | `.claude/settings.local.json`  |\n| **Subagents**   | `~/.claude/agents/`       | `.claude/agents/`                  | —                              |\n| **MCP servers** | `~/.claude.json`          | `.mcp.json`                        | `~/.claude.json` (per-project) |\n| **Plugins**     | `~/.claude/settings.json` | `.claude/settings.json`            | `.claude/settings.local.json`  |\n| **CLAUDE.md**   | `~/.claude/CLAUDE.md`     | `CLAUDE.md` or `.claude/CLAUDE.md` | `CLAUDE.local.md`              |\n\n***\n\n## Settings files\n\nThe `settings.json` file is our official mechanism for configuring Claude\nCode through hierarchical settings:\n\n* **User settings** are defined in `~/.claude/settings.json` and apply to all\n  projects.\n* **Project settings** are saved in your project directory:\n  * `.claude/settings.json` for settings that are checked into source control and shared with your team\n  * `.claude/settings.local.json` for settings that are not checked in, useful for personal preferences and experimentation. Claude Code will configure git to ignore `.claude/settings.local.json` when it is created.\n* **Managed settings** (Enterprise): Enterprise administrators can configure and distribute Claude Code settings to their organization through the [Claude.ai admin console](https://claude.ai/admin-settings/claude-code). These settings are fetched automatically when users authenticate, take precedence over user and project settings, and cannot be overridden locally. This feature is available to Claude for Enterprise customers. If you don't see this option in your admin console, contact your Anthropic account team to have the feature enabled.\n\n  For organizations that prefer file-based policy distribution, Claude Code also supports `managed-settings.json` and `managed-mcp.json` files that can be deployed to system directories:\n\n  * macOS: `/Library/Application Support/ClaudeCode/`\n  * Linux and WSL: `/etc/claude-code/`\n  * Windows: `C:\\Program Files\\ClaudeCode\\`\n\n  <Note>\n    These are system-wide paths (not user home directories like `~/Library/...`) that require administrator privileges. They are designed to be deployed by IT administrators.\n  </Note>\n\n  See [Enterprise managed settings](/en/iam#enterprise-managed-settings) and [Enterprise MCP configuration](/en/mcp#enterprise-mcp-configuration) for details.\n\n  <Note>\n    Enterprise deployments can also restrict **plugin marketplace additions** using\n    `strictKnownMarketplaces`. For more information, see [Enterprise marketplace restrictions](/en/plugin-marketplaces#enterprise-marketplace-restrictions).\n  </Note>\n* **Other configuration** is stored in `~/.claude.json`. This file contains your preferences (theme, notification settings, editor mode), OAuth session, [MCP server](/en/mcp) configurations for user and local scopes, per-project state (allowed tools, trust settings), and various caches. Project-scoped MCP servers are stored separately in `.mcp.json`.\n\n```JSON Example settings.json theme={null}\n{\n  \"permissions\": {\n    \"allow\": [\n      \"Bash(npm run lint)\",\n      \"Bash(npm run test:*)\",\n      \"Read(~/.zshrc)\"\n    ],\n    \"deny\": [\n      \"Bash(curl:*)\",\n      \"Read(./.env)\",\n      \"Read(./.env.*)\",\n      \"Read(./secrets/**)\"\n    ]\n  },\n  \"env\": {\n    \"CLAUDE_CODE_ENABLE_TELEMETRY\": \"1\",\n    \"OTEL_METRICS_EXPORTER\": \"otlp\"\n  },\n  \"companyAnnouncements\": [\n    \"Welcome to Acme Corp! Review our code guidelines at docs.acme.com\",\n    \"Reminder: Code reviews required for all PRs\",\n    \"New security policy in effect\"\n  ]\n}\n```\n\n### Available settings\n\n`settings.json` supports a number of options:\n\n| Key                          | Description                                                                                                                                                                                                                                                                           | Example                                                                 |\n| :--------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :---------------------------------------------------------------------- |\n| `apiKeyHelper`               | Custom script, to be executed in `/bin/sh`, to generate an auth value. This value will be sent as `X-Api-Key` and `Authorization: Bearer` headers for model requests                                                                                                                  | `/bin/generate_temp_api_key.sh`                                         |\n| `cleanupPeriodDays`          | Sessions inactive for longer than this period are deleted at startup. Setting to `0` immediately deletes all sessions. (default: 30 days)                                                                                                                                             | `20`                                                                    |\n| `companyAnnouncements`       | Announcement to display to users at startup. If multiple announcements are provided, they will be cycled through at random.                                                                                                                                                           | `[\"Welcome to Acme Corp! Review our code guidelines at docs.acme.com\"]` |\n| `env`                        | Environment variables that will be applied to every session                                                                                                                                                                                                                           | `{\"FOO\": \"bar\"}`                                                        |\n| `attribution`                | Customize attribution for git commits and pull requests. See [Attribution settings](#attribution-settings)                                                                                                                                                                            | `{\"commit\": \"🤖 Generated with Claude Code\", \"pr\": \"\"}`                 |\n| `includeCoAuthoredBy`        | **Deprecated**: Use `attribution` instead. Whether to include the `co-authored-by Claude` byline in git commits and pull requests (default: `true`)                                                                                                                                   | `false`                                                                 |\n| `permissions`                | See table below for structure of permissions.                                                                                                                                                                                                                                         |                                                                         |\n| `hooks`                      | Configure custom commands to run before or after tool executions. See [hooks documentation](/en/hooks)                                                                                                                                                                                | `{\"PreToolUse\": {\"Bash\": \"echo 'Running command...'\"}}`                 |\n| `disableAllHooks`            | Disable all [hooks](/en/hooks)                                                                                                                                                                                                                                                        | `true`                                                                  |\n| `allowManagedHooksOnly`      | (Enterprise) Prevent loading of user, project, and plugin hooks. Only allows managed hooks and SDK hooks. See [Hook configuration](#hook-configuration)                                                                                                                               | `true`                                                                  |\n| `model`                      | Override the default model to use for Claude Code                                                                                                                                                                                                                                     | `\"claude-sonnet-4-5-20250929\"`                                          |\n| `otelHeadersHelper`          | Script to generate dynamic OpenTelemetry headers. Runs at startup and periodically (see [Dynamic headers](/en/monitoring-usage#dynamic-headers))                                                                                                                                      | `/bin/generate_otel_headers.sh`                                         |\n| `statusLine`                 | Configure a custom status line to display context. See [`statusLine` documentation](/en/statusline)                                                                                                                                                                                   | `{\"type\": \"command\", \"command\": \"~/.claude/statusline.sh\"}`             |\n| `fileSuggestion`             | Configure a custom script for `@` file autocomplete. See [File suggestion settings](#file-suggestion-settings)                                                                                                                                                                        | `{\"type\": \"command\", \"command\": \"~/.claude/file-suggestion.sh\"}`        |\n| `outputStyle`                | Configure an output style to adjust the system prompt. See [output styles documentation](/en/output-styles)                                                                                                                                                                           | `\"Explanatory\"`                                                         |\n| `forceLoginMethod`           | Use `claudeai` to restrict login to Claude.ai accounts, `console` to restrict login to Claude Console (API usage billing) accounts                                                                                                                                                    | `claudeai`                                                              |\n| `forceLoginOrgUUID`          | Specify the UUID of an organization to automatically select it during login, bypassing the organization selection step. Requires `forceLoginMethod` to be set                                                                                                                         | `\"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\"`                                |\n| `enableAllProjectMcpServers` | Automatically approve all MCP servers defined in project `.mcp.json` files                                                                                                                                                                                                            | `true`                                                                  |\n| `enabledMcpjsonServers`      | List of specific MCP servers from `.mcp.json` files to approve                                                                                                                                                                                                                        | `[\"memory\", \"github\"]`                                                  |\n| `disabledMcpjsonServers`     | List of specific MCP servers from `.mcp.json` files to reject                                                                                                                                                                                                                         | `[\"filesystem\"]`                                                        |\n| `allowedMcpServers`          | When set in managed-settings.json, allowlist of MCP servers users can configure. Undefined = no restrictions, empty array = lockdown. Applies to all scopes. Denylist takes precedence. See [Enterprise MCP configuration](/en/mcp#enterprise-mcp-configuration)                      | `[{ \"serverName\": \"github\" }]`                                          |\n| `deniedMcpServers`           | When set in managed-settings.json, denylist of MCP servers that are explicitly blocked. Applies to all scopes including enterprise servers. Denylist takes precedence over allowlist. See [Enterprise MCP configuration](/en/mcp#enterprise-mcp-configuration)                        | `[{ \"serverName\": \"filesystem\" }]`                                      |\n| `strictKnownMarketplaces`    | When set in managed-settings.json, allowlist of plugin marketplaces users can add. Undefined = no restrictions, empty array = lockdown. Applies to marketplace additions only. See [Enterprise marketplace restrictions](/en/plugin-marketplaces#enterprise-marketplace-restrictions) | `[{ \"source\": \"github\", \"repo\": \"acme-corp/plugins\" }]`                 |\n| `awsAuthRefresh`             | Custom script that modifies the `.aws` directory (see [advanced credential configuration](/en/amazon-bedrock#advanced-credential-configuration))                                                                                                                                      | `aws sso login --profile myprofile`                                     |\n| `awsCredentialExport`        | Custom script that outputs JSON with AWS credentials (see [advanced credential configuration](/en/amazon-bedrock#advanced-credential-configuration))                                                                                                                                  | `/bin/generate_aws_grant.sh`                                            |\n| `alwaysThinkingEnabled`      | Enable [extended thinking](/en/common-workflows#use-extended-thinking) by default for all sessions. Typically configured via the `/config` command rather than editing directly                                                                                                       | `true`                                                                  |\n\n### Permission settings\n\n| Keys                           | Description                                                                                                                                                                                                                                                                                 | Example                                                                |\n| :----------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :--------------------------------------------------------------------- |\n| `allow`                        | Array of [permission rules](/en/iam#configuring-permissions) to allow tool use. **Note:** Bash rules use prefix matching, not regex                                                                                                                                                         | `[ \"Bash(git diff:*)\" ]`                                               |\n| `ask`                          | Array of [permission rules](/en/iam#configuring-permissions) to ask for confirmation upon tool use.                                                                                                                                                                                         | `[ \"Bash(git push:*)\" ]`                                               |\n| `deny`                         | Array of [permission rules](/en/iam#configuring-permissions) to deny tool use. Use this to also exclude sensitive files from Claude Code access. **Note:** Bash patterns are prefix matches and can be bypassed (see [Bash permission limitations](/en/iam#tool-specific-permission-rules)) | `[ \"WebFetch\", \"Bash(curl:*)\", \"Read(./.env)\", \"Read(./secrets/**)\" ]` |\n| `additionalDirectories`        | Additional [working directories](/en/iam#working-directories) that Claude has access to                                                                                                                                                                                                     | `[ \"../docs/\" ]`                                                       |\n| `defaultMode`                  | Default [permission mode](/en/iam#permission-modes) when opening Claude Code                                                                                                                                                                                                                | `\"acceptEdits\"`                                                        |\n| `disableBypassPermissionsMode` | Set to `\"disable\"` to prevent `bypassPermissions` mode from being activated. This disables the `--dangerously-skip-permissions` command-line flag. See [managed settings](/en/iam#enterprise-managed-settings)                                                                              | `\"disable\"`                                                            |\n\n### Sandbox settings\n\nConfigure advanced sandboxing behavior. Sandboxing isolates bash commands from your filesystem and network. See [Sandboxing](/en/sandboxing) for details.\n\n**Filesystem and network restrictions** are configured via Read, Edit, and WebFetch permission rules, not via these sandbox settings.\n\n| Keys                        | Description                                                                                                                                                                                                                                                                                                                       | Example                   |\n| :-------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------ |\n| `enabled`                   | Enable bash sandboxing (macOS/Linux only). Default: false                                                                                                                                                                                                                                                                         | `true`                    |\n| `autoAllowBashIfSandboxed`  | Auto-approve bash commands when sandboxed. Default: true                                                                                                                                                                                                                                                                          | `true`                    |\n| `excludedCommands`          | Commands that should run outside of the sandbox                                                                                                                                                                                                                                                                                   | `[\"git\", \"docker\"]`       |\n| `allowUnsandboxedCommands`  | Allow commands to run outside the sandbox via the `dangerouslyDisableSandbox` parameter. When set to `false`, the `dangerouslyDisableSandbox` escape hatch is completely disabled and all commands must run sandboxed (or be in `excludedCommands`). Useful for enterprise policies that require strict sandboxing. Default: true | `false`                   |\n| `network.allowUnixSockets`  | Unix socket paths accessible in sandbox (for SSH agents, etc.)                                                                                                                                                                                                                                                                    | `[\"~/.ssh/agent-socket\"]` |\n| `network.allowLocalBinding` | Allow binding to localhost ports (macOS only). Default: false                                                                                                                                                                                                                                                                     | `true`                    |\n| `network.httpProxyPort`     | HTTP proxy port used if you wish to bring your own proxy. If not specified, Claude will run its own proxy.                                                                                                                                                                                                                        | `8080`                    |\n| `network.socksProxyPort`    | SOCKS5 proxy port used if you wish to bring your own proxy. If not specified, Claude will run its own proxy.                                                                                                                                                                                                                      | `8081`                    |\n| `enableWeakerNestedSandbox` | Enable weaker sandbox for unprivileged Docker environments (Linux only). **Reduces security.** Default: false                                                                                                                                                                                                                     | `true`                    |\n\n**Configuration example:**\n\n```json  theme={null}\n{\n  \"sandbox\": {\n    \"enabled\": true,\n    \"autoAllowBashIfSandboxed\": true,\n    \"excludedCommands\": [\"docker\"],\n    \"network\": {\n      \"allowUnixSockets\": [\n        \"/var/run/docker.sock\"\n      ],\n      \"allowLocalBinding\": true\n    }\n  },\n  \"permissions\": {\n    \"deny\": [\n      \"Read(.envrc)\",\n      \"Read(~/.aws/**)\"\n    ]\n  }\n}\n```\n\n**Filesystem and network restrictions** use standard permission rules:\n\n* Use `Read` deny rules to block Claude from reading specific files or directories\n* Use `Edit` allow rules to let Claude write to directories beyond the current working directory\n* Use `Edit` deny rules to block writes to specific paths\n* Use `WebFetch` allow/deny rules to control which network domains Claude can access\n\n### Attribution settings\n\nClaude Code adds attribution to git commits and pull requests. These are configured separately:\n\n* Commits use [git trailers](https://git-scm.com/docs/git-interpret-trailers) (like `Co-Authored-By`) by default,  which can be customized or disabled\n* Pull request descriptions are plain text\n\n| Keys     | Description                                                                                |\n| :------- | :----------------------------------------------------------------------------------------- |\n| `commit` | Attribution for git commits, including any trailers. Empty string hides commit attribution |\n| `pr`     | Attribution for pull request descriptions. Empty string hides pull request attribution     |\n\n**Default commit attribution:**\n\n```\n🤖 Generated with [Claude Code](https://claude.com/claude-code)\n\n   Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>\n```\n\n**Default pull request attribution:**\n\n```\n🤖 Generated with [Claude Code](https://claude.com/claude-code)\n```\n\n**Example:**\n\n```json  theme={null}\n{\n  \"attribution\": {\n    \"commit\": \"Generated with AI\\n\\nCo-Authored-By: AI <ai@example.com>\",\n    \"pr\": \"\"\n  }\n}\n```\n\n<Note>\n  The `attribution` setting takes precedence over the deprecated `includeCoAuthoredBy` setting. To hide all attribution, set `commit` and `pr` to empty strings.\n</Note>\n\n### File suggestion settings\n\nConfigure a custom command for `@` file path autocomplete. The built-in file suggestion uses fast filesystem traversal, but large monorepos may benefit from project-specific indexing such as a pre-built file index or custom tooling.\n\n```json  theme={null}\n{\n  \"fileSuggestion\": {\n    \"type\": \"command\",\n    \"command\": \"~/.claude/file-suggestion.sh\"\n  }\n}\n```\n\nThe command runs with the same environment variables as [hooks](/en/hooks), including `CLAUDE_PROJECT_DIR`. It receives JSON via stdin with a `query` field:\n\n```json  theme={null}\n{\"query\": \"src/comp\"}\n```\n\nOutput newline-separated file paths to stdout (currently limited to 15):\n\n```\nsrc/components/Button.tsx\nsrc/components/Modal.tsx\nsrc/components/Form.tsx\n```\n\n**Example:**\n\n```bash  theme={null}\n#!/bin/bash\nquery=$(cat | jq -r '.query')\nyour-repo-file-index --query \"$query\" | head -20\n```\n\n### Hook configuration\n\n**Enterprise-only setting**: Controls which hooks are allowed to run. This setting can only be configured in [managed settings](#settings-files) and provides enterprise administrators with strict control over hook execution.\n\n**Behavior when `allowManagedHooksOnly` is `true`:**\n\n* Managed hooks and SDK hooks are loaded\n* User hooks, project hooks, and plugin hooks are blocked\n\n**Configuration:**\n\n```json  theme={null}\n{\n  \"allowManagedHooksOnly\": true\n}\n```\n\n### Settings precedence\n\nSettings apply in order of precedence. From highest to lowest:\n\n1. **Managed settings** (Enterprise)\n   * Remote settings configured via the [Claude.ai admin console](https://claude.ai/admin-settings/claude-code)\n   * Fetched automatically when users authenticate\n   * Cannot be overridden\n\n2. **File-based managed settings** (`managed-settings.json`)\n   * Policies deployed by IT/DevOps to system directories\n   * Cannot be overridden by user or project settings\n   * Ignored when remote managed settings are configured\n\n3. **Command line arguments**\n   * Temporary overrides for a specific session\n\n4. **Local project settings** (`.claude/settings.local.json`)\n   * Personal project-specific settings\n\n5. **Shared project settings** (`.claude/settings.json`)\n   * Team-shared project settings in source control\n\n6. **User settings** (`~/.claude/settings.json`)\n   * Personal global settings\n\nThis hierarchy ensures that enterprise security policies are always enforced while still allowing teams and individuals to customize their experience.\n\nFor example, if your user settings allow `Bash(npm run:*)` but a project's shared settings deny it, the project setting takes precedence and the command is blocked.\n\n### Key points about the configuration system\n\n* **Memory files (`CLAUDE.md`)**: Contain instructions and context that Claude loads at startup\n* **Settings files (JSON)**: Configure permissions, environment variables, and tool behavior\n* **Slash commands**: Custom commands that can be invoked during a session with `/command-name`\n* **MCP servers**: Extend Claude Code with additional tools and integrations\n* **Precedence**: Higher-level configurations (Enterprise) override lower-level ones (User/Project)\n* **Inheritance**: Settings are merged, with more specific settings adding to or overriding broader ones\n\n### System prompt\n\nClaude Code's internal system prompt is not published. To add custom instructions, use `CLAUDE.md` files or the `--append-system-prompt` flag.\n\n### Excluding sensitive files\n\nTo prevent Claude Code from accessing files containing sensitive information like API keys, secrets, and environment files, use the `permissions.deny` setting in your `.claude/settings.json` file:\n\n```json  theme={null}\n{\n  \"permissions\": {\n    \"deny\": [\n      \"Read(./.env)\",\n      \"Read(./.env.*)\",\n      \"Read(./secrets/**)\",\n      \"Read(./config/credentials.json)\",\n      \"Read(./build)\"\n    ]\n  }\n}\n```\n\nThis replaces the deprecated `ignorePatterns` configuration. Files matching these patterns will be completely invisible to Claude Code, preventing any accidental exposure of sensitive data.\n\n## Subagent configuration\n\nClaude Code supports custom AI subagents that can be configured at both user and project levels. These subagents are stored as Markdown files with YAML frontmatter:\n\n* **User subagents**: `~/.claude/agents/` - Available across all your projects\n* **Project subagents**: `.claude/agents/` - Specific to your project and can be shared with your team\n\nSubagent files define specialized AI assistants with custom prompts and tool permissions. Learn more about creating and using subagents in the [subagents documentation](/en/sub-agents).\n\n## Plugin configuration\n\nClaude Code supports a plugin system that lets you extend functionality with custom commands, agents, hooks, and MCP servers. Plugins are distributed through marketplaces and can be configured at both user and repository levels.\n\n### Plugin settings\n\nPlugin-related settings in `settings.json`:\n\n```json  theme={null}\n{\n  \"enabledPlugins\": {\n    \"formatter@acme-tools\": true,\n    \"deployer@acme-tools\": true,\n    \"analyzer@security-plugins\": false\n  },\n  \"extraKnownMarketplaces\": {\n    \"acme-tools\": {\n      \"source\": \"github\",\n      \"repo\": \"acme-corp/claude-plugins\"\n    }\n  }\n}\n```\n\n#### `enabledPlugins`\n\nControls which plugins are enabled. Format: `\"plugin-name@marketplace-name\": true/false`\n\n**Scopes**:\n\n* **User settings** (`~/.claude/settings.json`): Personal plugin preferences\n* **Project settings** (`.claude/settings.json`): Project-specific plugins shared with team\n* **Local settings** (`.claude/settings.local.json`): Per-machine overrides (not committed)\n\n**Example**:\n\n```json  theme={null}\n{\n  \"enabledPlugins\": {\n    \"code-formatter@team-tools\": true,\n    \"deployment-tools@team-tools\": true,\n    \"experimental-features@personal\": false\n  }\n}\n```\n\n#### `extraKnownMarketplaces`\n\nDefines additional marketplaces that should be made available for the repository. Typically used in repository-level settings to ensure team members have access to required plugin sources.\n\n**When a repository includes `extraKnownMarketplaces`**:\n\n1. Team members are prompted to install the marketplace when they trust the folder\n2. Team members are then prompted to install plugins from that marketplace\n3. Users can skip unwanted marketplaces or plugins (stored in user settings)\n4. Installation respects trust boundaries and requires explicit consent\n\n**Example**:\n\n```json  theme={null}\n{\n  \"extraKnownMarketplaces\": {\n    \"acme-tools\": {\n      \"source\": {\n        \"source\": \"github\",\n        \"repo\": \"acme-corp/claude-plugins\"\n      }\n    },\n    \"security-plugins\": {\n      \"source\": {\n        \"source\": \"git\",\n        \"url\": \"https://git.example.com/security/plugins.git\"\n      }\n    }\n  }\n}\n```\n\n**Marketplace source types**:\n\n* `github`: GitHub repository (uses `repo`)\n* `git`: Any git URL (uses `url`)\n* `directory`: Local filesystem path (uses `path`, for development only)\n\n#### `strictKnownMarketplaces`\n\n**Enterprise-only setting**: Controls which plugin marketplaces users are allowed to add. This setting can only be configured in [`managed-settings.json`](/en/iam#enterprise-managed-settings) and provides enterprise administrators with strict control over marketplace sources.\n\n**Managed settings file locations**:\n\n* **macOS**: `/Library/Application Support/ClaudeCode/managed-settings.json`\n* **Linux and WSL**: `/etc/claude-code/managed-settings.json`\n* **Windows**: `C:\\ProgramData\\ClaudeCode\\managed-settings.json`\n\n**Key characteristics**:\n\n* Only available in enterprise managed settings (`managed-settings.json`)\n* Cannot be overridden by user or project settings (highest precedence)\n* Enforced BEFORE network/filesystem operations (blocked sources never execute)\n* Uses exact matching for source specifications (including `ref`, `path` for git sources)\n\n**Allowlist behavior**:\n\n* `undefined` (default): No restrictions - users can add any marketplace\n* Empty array `[]`: Complete lockdown - users cannot add any new marketplaces\n* List of sources: Users can only add marketplaces that match exactly\n\n**All supported source types**:\n\nThe allowlist supports six marketplace source types. Each source must match exactly for a user's marketplace addition to be allowed.\n\n1. **GitHub repositories**:\n\n```json  theme={null}\n{ \"source\": \"github\", \"repo\": \"acme-corp/approved-plugins\" }\n{ \"source\": \"github\", \"repo\": \"acme-corp/security-tools\", \"ref\": \"v2.0\" }\n{ \"source\": \"github\", \"repo\": \"acme-corp/plugins\", \"ref\": \"main\", \"path\": \"marketplace\" }\n```\n\nFields: `repo` (required), `ref` (optional: branch/tag/SHA), `path` (optional: subdirectory)\n\n2. **Git repositories**:\n\n```json  theme={null}\n{ \"source\": \"git\", \"url\": \"https://gitlab.example.com/tools/plugins.git\" }\n{ \"source\": \"git\", \"url\": \"https://bitbucket.org/acme-corp/plugins.git\", \"ref\": \"production\" }\n{ \"source\": \"git\", \"url\": \"ssh://git@git.example.com/plugins.git\", \"ref\": \"v3.1\", \"path\": \"approved\" }\n```\n\nFields: `url` (required), `ref` (optional: branch/tag/SHA), `path` (optional: subdirectory)\n\n3. **URL-based marketplaces**:\n\n```json  theme={null}\n{ \"source\": \"url\", \"url\": \"https://plugins.example.com/marketplace.json\" }\n{ \"source\": \"url\", \"url\": \"https://cdn.example.com/marketplace.json\", \"headers\": { \"Authorization\": \"Bearer ${TOKEN}\" } }\n```\n\nFields: `url` (required), `headers` (optional: HTTP headers for authenticated access)\n\n4. **NPM packages**:\n\n```json  theme={null}\n{ \"source\": \"npm\", \"package\": \"@acme-corp/claude-plugins\" }\n{ \"source\": \"npm\", \"package\": \"@acme-corp/approved-marketplace\" }\n```\n\nFields: `package` (required, supports scoped packages)\n\n5. **File paths**:\n\n```json  theme={null}\n{ \"source\": \"file\", \"path\": \"/usr/local/share/claude/acme-marketplace.json\" }\n{ \"source\": \"file\", \"path\": \"/opt/acme-corp/plugins/marketplace.json\" }\n```\n\nFields: `path` (required: absolute path to marketplace.json file)\n\n6. **Directory paths**:\n\n```json  theme={null}\n{ \"source\": \"directory\", \"path\": \"/usr/local/share/claude/acme-plugins\" }\n{ \"source\": \"directory\", \"path\": \"/opt/acme-corp/approved-marketplaces\" }\n```\n\nFields: `path` (required: absolute path to directory containing `.claude-plugin/marketplace.json`)\n\n**Configuration examples**:\n\nExample - Allow specific marketplaces only:\n\n```json  theme={null}\n{\n  \"strictKnownMarketplaces\": [\n    {\n      \"source\": \"github\",\n      \"repo\": \"acme-corp/approved-plugins\"\n    },\n    {\n      \"source\": \"github\",\n      \"repo\": \"acme-corp/security-tools\",\n      \"ref\": \"v2.0\"\n    },\n    {\n      \"source\": \"url\",\n      \"url\": \"https://plugins.example.com/marketplace.json\"\n    },\n    {\n      \"source\": \"npm\",\n      \"package\": \"@acme-corp/compliance-plugins\"\n    }\n  ]\n}\n```\n\nExample - Disable all marketplace additions:\n\n```json  theme={null}\n{\n  \"strictKnownMarketplaces\": []\n}\n```\n\n**Exact matching requirements**:\n\nMarketplace sources must match **exactly** for a user's addition to be allowed. For git-based sources (`github` and `git`), this includes all optional fields:\n\n* The `repo` or `url` must match exactly\n* The `ref` field must match exactly (or both be undefined)\n* The `path` field must match exactly (or both be undefined)\n\nExamples of sources that **do NOT match**:\n\n```json  theme={null}\n// These are DIFFERENT sources:\n{ \"source\": \"github\", \"repo\": \"acme-corp/plugins\" }\n{ \"source\": \"github\", \"repo\": \"acme-corp/plugins\", \"ref\": \"main\" }\n\n// These are also DIFFERENT:\n{ \"source\": \"github\", \"repo\": \"acme-corp/plugins\", \"path\": \"marketplace\" }\n{ \"source\": \"github\", \"repo\": \"acme-corp/plugins\" }\n```\n\n**Comparison with `extraKnownMarketplaces`**:\n\n| Aspect                | `strictKnownMarketplaces`            | `extraKnownMarketplaces`             |\n| --------------------- | ------------------------------------ | ------------------------------------ |\n| **Purpose**           | Enterprise policy enforcement        | Team convenience                     |\n| **Settings file**     | `managed-settings.json` only         | Any settings file                    |\n| **Behavior**          | Blocks non-allowlisted additions     | Auto-installs missing marketplaces   |\n| **When enforced**     | Before network/filesystem operations | After user trust prompt              |\n| **Can be overridden** | No (highest precedence)              | Yes (by higher precedence settings)  |\n| **Source format**     | Direct source object                 | Named marketplace with nested source |\n| **Use case**          | Compliance, security restrictions    | Onboarding, standardization          |\n\n**Format difference**:\n\n`strictKnownMarketplaces` uses direct source objects:\n\n```json  theme={null}\n{\n  \"strictKnownMarketplaces\": [\n    { \"source\": \"github\", \"repo\": \"acme-corp/plugins\" }\n  ]\n}\n```\n\n`extraKnownMarketplaces` requires named marketplaces:\n\n```json  theme={null}\n{\n  \"extraKnownMarketplaces\": {\n    \"acme-tools\": {\n      \"source\": { \"source\": \"github\", \"repo\": \"acme-corp/plugins\" }\n    }\n  }\n}\n```\n\n**Important notes**:\n\n* Restrictions are checked BEFORE any network requests or filesystem operations\n* When blocked, users see clear error messages indicating the source is blocked by enterprise policy\n* The restriction applies only to adding NEW marketplaces; previously installed marketplaces remain accessible\n* Enterprise managed settings have the highest precedence and cannot be overridden\n\nSee [Enterprise marketplace restrictions](/en/plugin-marketplaces#enterprise-marketplace-restrictions) for user-facing documentation.\n\n### Managing plugins\n\nUse the `/plugin` command to manage plugins interactively:\n\n* Browse available plugins from marketplaces\n* Install/uninstall plugins\n* Enable/disable plugins\n* View plugin details (commands, agents, hooks provided)\n* Add/remove marketplaces\n\nLearn more about the plugin system in the [plugins documentation](/en/plugins).\n\n## Environment variables\n\nClaude Code supports the following environment variables to control its behavior:\n\n<Note>\n  All environment variables can also be configured in [`settings.json`](#available-settings). This is useful as a way to automatically set environment variables for each session, or to roll out a set of environment variables for your whole team or organization.\n</Note>\n\n| Variable                                      | Purpose                                                                                                                                                                                                                                                                                                                                                                                      |\n| :-------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| `ANTHROPIC_API_KEY`                           | API key sent as `X-Api-Key` header, typically for the Claude SDK (for interactive usage, run `/login`)                                                                                                                                                                                                                                                                                       |\n| `ANTHROPIC_AUTH_TOKEN`                        | Custom value for the `Authorization` header (the value you set here will be prefixed with `Bearer `)                                                                                                                                                                                                                                                                                         |\n| `ANTHROPIC_CUSTOM_HEADERS`                    | Custom headers you want to add to the request (in `Name: Value` format)                                                                                                                                                                                                                                                                                                                      |\n| `ANTHROPIC_DEFAULT_HAIKU_MODEL`               | See [Model configuration](/en/model-config#environment-variables)                                                                                                                                                                                                                                                                                                                            |\n| `ANTHROPIC_DEFAULT_OPUS_MODEL`                | See [Model configuration](/en/model-config#environment-variables)                                                                                                                                                                                                                                                                                                                            |\n| `ANTHROPIC_DEFAULT_SONNET_MODEL`              | See [Model configuration](/en/model-config#environment-variables)                                                                                                                                                                                                                                                                                                                            |\n| `ANTHROPIC_FOUNDRY_API_KEY`                   | API key for Microsoft Foundry authentication (see [Microsoft Foundry](/en/microsoft-foundry))                                                                                                                                                                                                                                                                                                |\n| `ANTHROPIC_MODEL`                             | Name of the model setting to use (see [Model Configuration](/en/model-config#environment-variables))                                                                                                                                                                                                                                                                                         |\n| `ANTHROPIC_SMALL_FAST_MODEL`                  | \\[DEPRECATED] Name of [Haiku-class model for background tasks](/en/costs)                                                                                                                                                                                                                                                                                                                    |\n| `ANTHROPIC_SMALL_FAST_MODEL_AWS_REGION`       | Override AWS region for the Haiku-class model when using Bedrock                                                                                                                                                                                                                                                                                                                             |\n| `AWS_BEARER_TOKEN_BEDROCK`                    | Bedrock API key for authentication (see [Bedrock API keys](https://aws.amazon.com/blogs/machine-learning/accelerate-ai-development-with-amazon-bedrock-api-keys/))                                                                                                                                                                                                                           |\n| `BASH_DEFAULT_TIMEOUT_MS`                     | Default timeout for long-running bash commands                                                                                                                                                                                                                                                                                                                                               |\n| `BASH_MAX_OUTPUT_LENGTH`                      | Maximum number of characters in bash outputs before they are middle-truncated                                                                                                                                                                                                                                                                                                                |\n| `BASH_MAX_TIMEOUT_MS`                         | Maximum timeout the model can set for long-running bash commands                                                                                                                                                                                                                                                                                                                             |\n| `CLAUDE_BASH_MAINTAIN_PROJECT_WORKING_DIR`    | Return to the original working directory after each Bash command                                                                                                                                                                                                                                                                                                                             |\n| `CLAUDE_CODE_API_KEY_HELPER_TTL_MS`           | Interval in milliseconds at which credentials should be refreshed (when using `apiKeyHelper`)                                                                                                                                                                                                                                                                                                |\n| `CLAUDE_CODE_CLIENT_CERT`                     | Path to client certificate file for mTLS authentication                                                                                                                                                                                                                                                                                                                                      |\n| `CLAUDE_CODE_CLIENT_KEY_PASSPHRASE`           | Passphrase for encrypted CLAUDE\\_CODE\\_CLIENT\\_KEY (optional)                                                                                                                                                                                                                                                                                                                                |\n| `CLAUDE_CODE_CLIENT_KEY`                      | Path to client private key file for mTLS authentication                                                                                                                                                                                                                                                                                                                                      |\n| `CLAUDE_CODE_DISABLE_EXPERIMENTAL_BETAS`      | Set to `1` to disable Anthropic API-specific `anthropic-beta` headers. Use this if experiencing issues like \"Unexpected value(s) for the `anthropic-beta` header\" when using an LLM gateway with third-party providers                                                                                                                                                                       |\n| `CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC`    | Equivalent of setting `DISABLE_AUTOUPDATER`, `DISABLE_BUG_COMMAND`, `DISABLE_ERROR_REPORTING`, and `DISABLE_TELEMETRY`                                                                                                                                                                                                                                                                       |\n| `CLAUDE_CODE_DISABLE_TERMINAL_TITLE`          | Set to `1` to disable automatic terminal title updates based on conversation context                                                                                                                                                                                                                                                                                                         |\n| `CLAUDE_CODE_IDE_SKIP_AUTO_INSTALL`           | Skip auto-installation of IDE extensions                                                                                                                                                                                                                                                                                                                                                     |\n| `CLAUDE_CODE_MAX_OUTPUT_TOKENS`               | Set the maximum number of output tokens for most requests                                                                                                                                                                                                                                                                                                                                    |\n| `CLAUDE_CODE_OTEL_HEADERS_HELPER_DEBOUNCE_MS` | Interval for refreshing dynamic OpenTelemetry headers in milliseconds (default: 1740000 / 29 minutes). See [Dynamic headers](/en/monitoring-usage#dynamic-headers)                                                                                                                                                                                                                           |\n| `CLAUDE_CODE_SHELL_PREFIX`                    | Command prefix to wrap all bash commands (for example, for logging or auditing). Example: `/path/to/logger.sh` will execute `/path/to/logger.sh <command>`                                                                                                                                                                                                                                   |\n| `CLAUDE_CODE_SKIP_BEDROCK_AUTH`               | Skip AWS authentication for Bedrock (for example, when using an LLM gateway)                                                                                                                                                                                                                                                                                                                 |\n| `CLAUDE_CODE_SKIP_FOUNDRY_AUTH`               | Skip Azure authentication for Microsoft Foundry (for example, when using an LLM gateway)                                                                                                                                                                                                                                                                                                     |\n| `CLAUDE_CODE_SKIP_VERTEX_AUTH`                | Skip Google authentication for Vertex (for example, when using an LLM gateway)                                                                                                                                                                                                                                                                                                               |\n| `CLAUDE_CODE_SUBAGENT_MODEL`                  | See [Model configuration](/en/model-config)                                                                                                                                                                                                                                                                                                                                                  |\n| `CLAUDE_CODE_USE_BEDROCK`                     | Use [Bedrock](/en/amazon-bedrock)                                                                                                                                                                                                                                                                                                                                                            |\n| `CLAUDE_CODE_USE_FOUNDRY`                     | Use [Microsoft Foundry](/en/microsoft-foundry)                                                                                                                                                                                                                                                                                                                                               |\n| `CLAUDE_CODE_USE_VERTEX`                      | Use [Vertex](/en/google-vertex-ai)                                                                                                                                                                                                                                                                                                                                                           |\n| `CLAUDE_CONFIG_DIR`                           | Customize where Claude Code stores its configuration and data files                                                                                                                                                                                                                                                                                                                          |\n| `DISABLE_AUTOUPDATER`                         | Set to `1` to disable automatic updates.                                                                                                                                                                                                                                                                                                                                                     |\n| `DISABLE_BUG_COMMAND`                         | Set to `1` to disable the `/bug` command                                                                                                                                                                                                                                                                                                                                                     |\n| `DISABLE_COST_WARNINGS`                       | Set to `1` to disable cost warning messages                                                                                                                                                                                                                                                                                                                                                  |\n| `DISABLE_ERROR_REPORTING`                     | Set to `1` to opt out of Sentry error reporting                                                                                                                                                                                                                                                                                                                                              |\n| `DISABLE_NON_ESSENTIAL_MODEL_CALLS`           | Set to `1` to disable model calls for non-critical paths like flavor text                                                                                                                                                                                                                                                                                                                    |\n| `DISABLE_PROMPT_CACHING`                      | Set to `1` to disable prompt caching for all models (takes precedence over per-model settings)                                                                                                                                                                                                                                                                                               |\n| `DISABLE_PROMPT_CACHING_HAIKU`                | Set to `1` to disable prompt caching for Haiku models                                                                                                                                                                                                                                                                                                                                        |\n| `DISABLE_PROMPT_CACHING_OPUS`                 | Set to `1` to disable prompt caching for Opus models                                                                                                                                                                                                                                                                                                                                         |\n| `DISABLE_PROMPT_CACHING_SONNET`               | Set to `1` to disable prompt caching for Sonnet models                                                                                                                                                                                                                                                                                                                                       |\n| `DISABLE_TELEMETRY`                           | Set to `1` to opt out of Statsig telemetry (note that Statsig events do not include user data like code, file paths, or bash commands)                                                                                                                                                                                                                                                       |\n| `HTTP_PROXY`                                  | Specify HTTP proxy server for network connections                                                                                                                                                                                                                                                                                                                                            |\n| `HTTPS_PROXY`                                 | Specify HTTPS proxy server for network connections                                                                                                                                                                                                                                                                                                                                           |\n| `MAX_MCP_OUTPUT_TOKENS`                       | Maximum number of tokens allowed in MCP tool responses. Claude Code displays a warning when output exceeds 10,000 tokens (default: 25000)                                                                                                                                                                                                                                                    |\n| `MAX_THINKING_TOKENS`                         | Enable [extended thinking](https://docs.claude.com/en/docs/build-with-claude/extended-thinking) and set the token budget for the thinking process. Extended thinking improves performance on complex reasoning and coding tasks but impacts [prompt caching efficiency](https://docs.claude.com/en/docs/build-with-claude/prompt-caching#caching-with-thinking-blocks). Disabled by default. |\n| `MCP_TIMEOUT`                                 | Timeout in milliseconds for MCP server startup                                                                                                                                                                                                                                                                                                                                               |\n| `MCP_TOOL_TIMEOUT`                            | Timeout in milliseconds for MCP tool execution                                                                                                                                                                                                                                                                                                                                               |\n| `NO_PROXY`                                    | List of domains and IPs to which requests will be directly issued, bypassing proxy                                                                                                                                                                                                                                                                                                           |\n| `SLASH_COMMAND_TOOL_CHAR_BUDGET`              | Maximum number of characters for slash command metadata shown to [SlashCommand tool](/en/slash-commands#slashcommand-tool) (default: 15000)                                                                                                                                                                                                                                                  |\n| `USE_BUILTIN_RIPGREP`                         | Set to `0` to use system-installed `rg` instead of `rg` included with Claude Code                                                                                                                                                                                                                                                                                                            |\n| `VERTEX_REGION_CLAUDE_3_5_HAIKU`              | Override region for Claude 3.5 Haiku when using Vertex AI                                                                                                                                                                                                                                                                                                                                    |\n| `VERTEX_REGION_CLAUDE_3_7_SONNET`             | Override region for Claude 3.7 Sonnet when using Vertex AI                                                                                                                                                                                                                                                                                                                                   |\n| `VERTEX_REGION_CLAUDE_4_0_OPUS`               | Override region for Claude 4.0 Opus when using Vertex AI                                                                                                                                                                                                                                                                                                                                     |\n| `VERTEX_REGION_CLAUDE_4_0_SONNET`             | Override region for Claude 4.0 Sonnet when using Vertex AI                                                                                                                                                                                                                                                                                                                                   |\n| `VERTEX_REGION_CLAUDE_4_1_OPUS`               | Override region for Claude 4.1 Opus when using Vertex AI                                                                                                                                                                                                                                                                                                                                     |\n\n## Tools available to Claude\n\nClaude Code has access to a set of powerful tools that help it understand and modify your codebase:\n\n| Tool                | Description                                                                                       | Permission Required |\n| :------------------ | :------------------------------------------------------------------------------------------------ | :------------------ |\n| **AskUserQuestion** | Asks the user multiple choice questions to gather information or clarify ambiguity                | No                  |\n| **Bash**            | Executes shell commands in your environment (see [Bash tool behavior](#bash-tool-behavior) below) | Yes                 |\n| **BashOutput**      | Retrieves output from a background bash shell                                                     | No                  |\n| **Edit**            | Makes targeted edits to specific files                                                            | Yes                 |\n| **ExitPlanMode**    | Prompts the user to exit plan mode and start coding                                               | Yes                 |\n| **Glob**            | Finds files based on pattern matching                                                             | No                  |\n| **Grep**            | Searches for patterns in file contents                                                            | No                  |\n| **KillShell**       | Kills a running background bash shell by its ID                                                   | No                  |\n| **NotebookEdit**    | Modifies Jupyter notebook cells                                                                   | Yes                 |\n| **Read**            | Reads the contents of files                                                                       | No                  |\n| **Skill**           | Executes a skill within the main conversation                                                     | Yes                 |\n| **SlashCommand**    | Runs a [custom slash command](/en/slash-commands#slashcommand-tool)                               | Yes                 |\n| **Task**            | Runs a sub-agent to handle complex, multi-step tasks                                              | No                  |\n| **TodoWrite**       | Creates and manages structured task lists                                                         | No                  |\n| **WebFetch**        | Fetches content from a specified URL                                                              | Yes                 |\n| **WebSearch**       | Performs web searches with domain filtering                                                       | Yes                 |\n| **Write**           | Creates or overwrites files                                                                       | Yes                 |\n\nPermission rules can be configured using `/allowed-tools` or in [permission settings](/en/settings#available-settings). Also see [Tool-specific permission rules](/en/iam#tool-specific-permission-rules).\n\n### Bash tool behavior\n\nThe Bash tool executes shell commands with the following persistence behavior:\n\n* **Working directory persists**: When Claude changes the working directory (for example, `cd /path/to/dir`), subsequent Bash commands will execute in that directory. You can use `CLAUDE_BASH_MAINTAIN_PROJECT_WORKING_DIR=1` to reset to the project directory after each command.\n* **Environment variables do NOT persist**: Environment variables set in one Bash command (for example, `export MY_VAR=value`) are **not** available in subsequent Bash commands. Each Bash command runs in a fresh shell environment.\n\nTo make environment variables available in Bash commands, you have **three options**:\n\n**Option 1: Activate environment before starting Claude Code** (simplest approach)\n\nActivate your virtual environment in your terminal before launching Claude Code:\n\n```bash  theme={null}\nconda activate myenv\n# or: source /path/to/venv/bin/activate\nclaude\n```\n\nThis works for shell environments but environment variables set within Claude's Bash commands will not persist between commands.\n\n**Option 2: Set CLAUDE\\_ENV\\_FILE before starting Claude Code** (persistent environment setup)\n\nExport the path to a shell script containing your environment setup:\n\n```bash  theme={null}\nexport CLAUDE_ENV_FILE=/path/to/env-setup.sh\nclaude\n```\n\nWhere `/path/to/env-setup.sh` contains:\n\n```bash  theme={null}\nconda activate myenv\n# or: source /path/to/venv/bin/activate\n# or: export MY_VAR=value\n```\n\nClaude Code will source this file before each Bash command, making the environment persistent across all commands.\n\n**Option 3: Use a SessionStart hook** (project-specific configuration)\n\nConfigure in `.claude/settings.json`:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"SessionStart\": [{\n      \"matcher\": \"startup\",\n      \"hooks\": [{\n        \"type\": \"command\",\n        \"command\": \"echo 'conda activate myenv' >> \\\"$CLAUDE_ENV_FILE\\\"\"\n      }]\n    }]\n  }\n}\n```\n\nThe hook writes to `$CLAUDE_ENV_FILE`, which is then sourced before each Bash command. This is ideal for team-shared project configurations.\n\nSee [SessionStart hooks](/en/hooks#persisting-environment-variables) for more details on Option 3.\n\n### Extending tools with hooks\n\nYou can run custom commands before or after any tool executes using\n[Claude Code hooks](/en/hooks-guide).\n\nFor example, you could automatically run a Python formatter after Claude\nmodifies Python files, or prevent modifications to production configuration\nfiles by blocking Write operations to certain paths.\n\n## See also\n\n* [Identity and Access Management](/en/iam#configuring-permissions) - Learn about Claude Code's permission system\n* [IAM and access control](/en/iam#enterprise-managed-settings) - Enterprise policy management\n* [Troubleshooting](/en/troubleshooting#auto-updater-issues) - Solutions for common configuration issues\n\n\n---\n\n> To find navigation and other pages in this documentation, fetch the llms.txt file at: https://code.claude.com/docs/llms.txt"}]},"isSidechain":true,"agentId":"a93e318"}
{"type":"assistant","uuid":"1635d922-7ebe-4984-bf21-d4ed067509af","parentUuid":"21e76ea9-b00d-4b5a-91e5-9f53d96062b7","timestamp":"2025-12-24T18:49:38.197Z","sessionId":"f968233b-ebe5-4958-aa2d-69a2d8e7413c","message":{"role":"assistant","content":[{"type":"text","text":"Perfect! I now have comprehensive documentation. Let me compile a detailed research summary for you.\n\n## Research Summary: Claude Code Features for Memory Systems\n\nI've reviewed the official Claude Code documentation to understand hooks, skills vs commands, and persistent storage patterns. Here's what I found:\n\n---\n\n## 1. HOOKS - Powerful Event-Driven Capabilities\n\n### Hook Events for Memory System\n\n**SessionEnd Hook** - Your primary capture mechanism:\n- Fires when a Claude Code session ends\n- Input includes: `session_id`, `transcript_path`, `cwd`, `permission_mode`, `reason` (why session ended)\n- The `transcript_path` points to a JSONL file containing the entire conversation\n- Can execute scripts to parse and store session data\n- Perfect for: Extracting session data, logging, saving state to external storage\n\n**SessionStart Hook** - Load context at session start:\n- Fires when a session begins or resumes\n- Input includes: `session_id`, `transcript_path`, `permission_mode`, `source` (startup/resume/clear/compact)\n- Can inject context via `additionalContext` field\n- Perfect for: Loading previous memory, setting up environment\n- **Special capability**: Can write to `CLAUDE_ENV_FILE` to persist environment variables across bash commands\n\n**Stop Hook** - Intelligent session continuation:\n- Fires when Claude finishes responding\n- Supports **prompt-based hooks** using an LLM to evaluate if Claude should continue\n- Can block stoppage with custom reasoning\n- Could capture intent before session ends\n\n### Hook Capabilities\n\n**Command Hooks** (bash execution):\n- Run arbitrary scripts with JSON input via stdin\n- Output can be structured JSON for advanced control\n- Exit code 0 = success, exit code 2 = blocking error\n- **Timeout**: 60 seconds default, configurable per hook\n- **Parallelization**: Multiple matching hooks run in parallel\n- Access to environment variables: `CLAUDE_PROJECT_DIR`, `CLAUDE_ENV_FILE` (SessionStart only)\n\n**Prompt-Based Hooks** (LLM evaluation):\n- Send structured context to an LLM for decision-making\n- Supported for: Stop, SubagentStop, UserPromptSubmit, PreToolUse, PermissionRequest\n- Response schema: `{ \"decision\": \"approve\"/\"block\", \"reason\": \"...\", \"continue\": true/false, ... }`\n- Perfect for: Intelligent decisions about session continuation\n\n---\n\n## 2. SKILLS VS COMMANDS - Crucial Distinction\n\n### Skills (Model-Invoked)\n- **Discovery**: Claude autonomously discovers when to use them based on context\n- **Location**: `~/.claude/skills/` (personal) or `.claude/skills/` (project)\n- **Structure**: Directory with `SKILL.md` + optional supporting files (scripts, templates, reference docs)\n- **File references**: Can include multiple supporting files; Claude uses progressive disclosure\n- **Tool restrictions**: Can use `allowed-tools` frontmatter to restrict Claude's tool access\n- **Best for**: Complex workflows, team standardization, expertise packages\n\n**SKILL.md Format**:\n```yaml\n---\nname: your-skill-name\ndescription: Brief + when to use (critical for discovery)\nallowed-tools: Read, Grep, Glob  # Optional\n---\n\n# Your Skill Name\n## Instructions\nStep-by-step guidance\n```\n\n### Commands (User-Invoked)\n- **Discovery**: User explicitly types `/command`\n- **Location**: `~/.claude/commands/` (personal) or `.claude/commands/` (project)\n- **Structure**: Single `.md` file with frontmatter\n- **Arguments**: Support `$ARGUMENTS`, `$1`, `$2`, etc.\n- **Bash execution**: Can use `!` prefix for shell commands\n- **Best for**: Quick prompts, frequent workflows, explicit invocation\n\n**Key insight for memory**: A memory system would likely be a **Skill** (so Claude autonomously knows to use it) rather than a command (which requires user invocation).\n\n---\n\n## 3. PERSISTENT STORAGE PATTERNS\n\n### Option A: Plugin Configuration Files (Cleanest)\nEach plugin can store configuration in `.claude/<plugin-name>.local.md`:\n- YAML frontmatter + markdown content\n- Per-project, not committed to git\n- Claude Code has built-in support for reading these\n- Can be deleted by user on request\n\n**Pattern**: \n```yaml\n# .claude/memory-system.local.md\n---\nsessions:\n  - id: abc123\n    date: 2025-12-24\n    label: \"Feature implementation\"\n    key_insights: \"...\"\n---\n\n[Session data in markdown]\n```\n\n### Option B: SessionEnd Hook with External File\nUse a SessionEnd hook to capture and store:\n```bash\n#!/bin/bash\n# Extract data from transcript_path and store\njq '.[] | select(.type==\"text\")' \"$TRANSCRIPT_PATH\" > ~/.claude/memory/$SESSION_ID.json\n```\n\n**Advantages**: Flexible storage location, scriptable, doesn't need git tracking\n**Disadvantages**: Requires hook infrastructure\n\n### Option C: Monolithic Skill with Index\nSingle skill that maintains an index of past sessions:\n- Index file: List of all sessions (greppable format)\n- Data files: Individual session records\n- Location: `.claude/skills/memory-system/`\n\n**Pattern for index**:\n```markdown\n# Session Index\n- session-001: 2025-12-24 | Feature implementation | Key: implemented auth flow\n- session-002: 2025-12-23 | Bug fix sprint | Key: fixed race condition\n```\n\n### Option D: Hook-Based Real-Time Capture\nCombine hooks for complete lifecycle:\n- **SessionStart**: Load previous session index\n- **UserPromptSubmit**: Extract user intent, label\n- **PostToolUse**: Track tool usage patterns\n- **SessionEnd**: Save complete session record\n\n---\n\n## 4. Key Technical Constraints & Capabilities\n\n### Data Access\n- **SessionEnd hook** has access to `transcript_path` - a JSONL file containing the full conversation\n- **JSONL format**: Each line is a JSON object with message content, tool calls, results\n- **session_id**: Unique identifier available in all hook inputs\n- **cwd**: Current working directory when hook runs\n\n### Environment Persistence\nOnly `SessionStart` hooks can write to `CLAUDE_ENV_FILE` for persisting environment variables.\nOther hooks cannot do this - it's a special SessionStart-only capability.\n\n### File Storage Strategies\n1. **Gitignored files**: `.claude/memory/` directory (not in git)\n2. **Project settings pattern**: `.claude/memory-system.local.md` (YAML frontmatter)\n3. **User-level storage**: `~/.claude/memory/` (global, user-specific)\n4. **Plugin bundled**: Store with plugin, reference via `${CLAUDE_PLUGIN_ROOT}`\n\n### Hooks Don't Persist Between Commands\n- Each bash command runs in fresh environment (unless using SessionStart hook)\n- Hooks can write to files but cannot maintain in-memory state\n- Solution: Use file I/O for any state that must persist within a session\n\n---\n\n## 5. Recommended Architecture for Memory System\n\nBased on the documentation, here's what would work best:\n\n**Plugin-Based Approach**:\n1. **Create a plugin** with hooks + skill\n2. **SessionEnd hook** (bash command):\n   - Parse JSONL from `transcript_path`\n   - Extract key information (labels, descriptions, insights)\n   - Write to `.claude/memory-system.local.md`\n3. **SessionStart hook** (bash command):\n   - Read `.claude/memory-system.local.md`\n   - Extract session index\n   - Return via `additionalContext` to inject into session\n4. **Memory Skill**:\n   - Claude autonomously discovers it when relevant\n   - Can query/browse the memory index\n   - Has access to view/edit stored sessions\n   - Supports \"ask permission to submit\" pattern via `UserPromptSubmit` hook\n\n**Why this works**:\n- Hooks provide deterministic event capturing\n- Skill provides autonomy (Claude discovers it)\n- `.local.md` pattern allows configuration + data storage\n- SessionStart/SessionEnd hooks bookend each session\n- Transcript JSONL provides rich context for extraction\n- \"Yankable\" on request (user can delete `.local.md` file)\n\n---\n\n## 6. What the Documentation Does NOT Cover\n\nThese would require custom implementation:\n- How to parse JSONL transcript format (schema not documented)\n- Best practices for session labeling/tagging\n- Retrieval optimization (documentation says \"retrieval less important than storage\")\n- How to handle context window when loading memories\n\nThe documentation suggests: \"retrieval less important than storage\" - meaning focus on reliable capture, worry about efficient retrieval later.\n\n---\n\n**Key files to reference**:\n- `/Users/yoav/projects/alignment-hive/README.md` - Your project's memory design notes (already mentions this research direction)\n- `.mcp.json` - Shows you already have MCP integration configured\n- Custom skills available: `/plugin-dev:skill-development` can help build this\n\nThis research shows Claude Code has the primitives needed for a robust memory system. The SessionEnd/SessionStart hooks provide the event architecture, Skills provide the autonomy, and persistent files provide the storage - exactly what's needed for the \"ask permission to submit\" tier memory system you're designing."}],"model":"claude-haiku-4-5-20251001","stop_reason":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":21239,"cache_read_input_tokens":38175,"cache_creation":{"ephemeral_5m_input_tokens":21239,"ephemeral_1h_input_tokens":0},"output_tokens":2209,"service_tier":"standard"},"type":"message","stop_sequence":null},"isSidechain":true,"cwd":"/Users/yoav/projects/alignment-hive","version":"2.0.76","gitBranch":"main","agentId":"a93e318"}
